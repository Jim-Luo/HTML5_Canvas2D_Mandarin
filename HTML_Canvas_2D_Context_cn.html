<!DOCTYPE html>
<!-- saved from url=(0050)https://www.w3.org/TR/2015/REC-2dcontext-20151119/ -->
<html lang="en-US-x-Hixie">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>HTML Canvas 2D Context</title>
    <style type="text/css">

     .applies thead th > * { display: block; }
     .applies thead code { display: block; }
     .applies tbody th { white-space: nowrap; }
     .applies td { text-align: center; }
     .applies .yes { background: yellow; }

     .matrix, .matrix td { border: hidden; text-align: right; }
     .matrix { margin-left: 2em; }

     .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
     .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
     .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

     td.eg { border-width: thin; text-align: center; }

     .details-example img { vertical-align: top; }

     .glyph.control { color: red; }

     @font-face {
       font-family: 'Essays1743';
       src: url('fonts/Essays1743.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-weight: bold;
       src: url('fonts/Essays1743-Bold.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       src: url('fonts/Essays1743-Italic.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       font-weight: bold;
       src: url('fonts/Essays1743-BoldItalic.ttf');
     }

    </style>
    <style type="text/css">
       pre { margin-left: 2em; white-space: pre-wrap; }
       h2 { margin: 3em 0 1em 0; }
       h3 { margin: 2.5em 0 1em 0; }
       h4 { margin: 2.5em 0 0.75em 0; }
       h5, h6 { margin: 2.5em 0 1em; }
       h1 + h2, h1 + h2 + h2, h1 + p, h1 + p + h2 { margin: 0.75em 0 0.75em; }
       h2 + h3, h3 + h4, h4 + h5, h5 + h6 { margin-top: 0.5em; }
       p { margin: 1em 0; }
       hr:not(.top) { display: block; background: none; border: none; padding: 0; margin: 2em 0; height: auto; }
       .element dd,  .element dl { margin-top: 0em; margin-bottom: 0.25em;}
       dt { margin-top: 0.75em; margin-bottom: 0.5em; clear: left; }
        .element dt { margin-top: 0.5em; margin-bottom: 0.5em;  }
       dt + dt { margin-top: 0; }
       dd dt { margin-top: 0.25em; margin-bottom: 0; }
       dd p { margin-top: 0; }
       dd dl + p { margin-top: 1em; }
       dd table + p { margin-top: 1em; }
       p + * > li, dd li { margin: 1em 0; }
       dt, dfn { font-weight: bold; font-style: normal; }
       i, em { font-style: italic; }
       dt dfn { font-style: italic; }
       pre, code { font-size: inherit; font-family: monospace; font-variant: normal; }
       pre strong { color: black; font: inherit; font-weight: bold; background: yellow; }
       pre em { font-weight: bolder; font-style: normal; }
       @media screen { code { color: #D93B00; } code :link, code :visited { color: inherit; } }
       var { background-color: #f9f9f9; border: 1px solid #eee; padding: 0 2px; }
       var sub { vertical-align: bottom; font-size: smaller; position: relative; top: 0.1em; }
       table { border-collapse: collapse; border-style: hidden hidden none hidden; }
       table thead, table tbody { border-bottom: solid; }
       table tbody th:first-child { border-left: solid; }
       table tbody th { text-align: left; }
       table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
       blockquote { margin: 0 0 0 2em; border: 0; padding: 0; font-style: italic; }

       .bad, .bad *:not(.XXX) { color: #5F6D7A; border-color: gray; background: transparent; }
       .matrix, .matrix td { border: none; text-align: right; }
       .matrix { margin-left: 2em; }
       .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
       .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
       .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

       .toc dfn, h1 dfn, h2 dfn, h3 dfn, h4 dfn, h5 dfn, h6 dfn { font: inherit; }
       img.extra, p.overview { float: right; }
       pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
       pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
       pre.idl::before { content: "IDL"; font: bold small sans-serif; padding: 0.5em; background: white; position: absolute; top: 0; margin: -1px 0 0 -4em; width: 1.5em; border: thin solid; border-radius: 0 0 0 0.5em }
       pre.css { border: solid thin; background: #FFFFEE; color: black; padding: 0.5em 1em; }
       pre.css:first-line { color: #AAAA50; }
       dl.domintro {padding: 0.5em 1em; border: none; background:#E9FBE9; border: 1px solid lightgray; }
       hr + dl.domintro, div.impl + dl.domintro { margin-top: 2.5em; margin-bottom: 1.5em; }
       dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
       dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
       dl.domintro dd p { margin: 0.5em 0; }
       dl.domintro:before { display: block; content: 'Note:'; font-weight: bold;padding-bottom: 1em;}
       dl.switch { padding-left: 2em; }
       dl.switch > dt { text-indent: -1.5em; }
       dl.switch > dt:before { content: '\21AA'; padding: 0 0.5em 0 0; display: inline-block; width: 1em; text-align: right; line-height: 0.5em; }
       dl.triple { padding: 0 0 0 1em; }
       dl.triple dt, dl.triple dd { margin: 0; display: inline }
       dl.triple dt:after { content: ':'; }
       dl.triple dd:after { content: '\A'; white-space: pre; }
       .diff-old { text-decoration: line-through; color: silver; background: transparent; }
       .diff-chg, .diff-new { text-decoration: underline; color: green; background: transparent; }
       a .diff-new { border-bottom: 1px blue solid; }

       figure.diagrams { border: double black; background: white; padding: 1em; }
       figure.diagrams img { display: block; margin: 1em auto; }

       h2 { page-break-before: always; }
       h1, h2, h3, h4, h5, h6 { page-break-after: avoid; }
       h1 + h2, hr + h2.no-toc { page-break-before: auto; }

       p  > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang]),
       li > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang])
       { border-bottom: solid #9999CC; }

       div.head { margin: 0 0 1em; padding: 1em 0 0 0; }
       div.head p { margin: 0; }
       div.head h1 { margin: 0; }
       div.head .logo { float: right; margin: 0 1em; }
       div.head .logo img { border: none } /* remove border from top image */
       div.head dl { margin: 1em 0; }
       div.head p.copyright, div.head p.alt { font-size: x-small; font-style: oblique; margin: 0; }

       body > .toc > li { margin-top: 1em; margin-bottom: 1em; }
       body > .toc.brief > li { margin-top: 0.35em; margin-bottom: 0.35em; }
       body > .toc > li > * { margin-bottom: 0.5em; }
       body > .toc > li > * > li > * { margin-bottom: 0.25em; }
       .toc, .toc li { list-style: none; }

       .brief { margin-top: 1em; margin-bottom: 1em; line-height: 1.1; }
       .brief li { margin: 0; padding: 0; }
       .brief li p { margin: 0; padding: 0; }

       .category-list { margin-top: -0.75em; margin-bottom: 1em; line-height: 1.5; }
       .category-list::before { content: '\21D2\A0'; font-size: 1.2em; font-weight: 900; }
       .category-list li { display: inline; }
       .category-list li:not(:last-child)::after { content: ', '; }
       .category-list li > span, .category-list li > a { text-transform: lowercase; }
       .category-list li * { text-transform: none; } /* don't affect <code> nested in <a> */

       .XXX { color: #E50000; background: white; border: solid red; padding: 0.5em; margin: 1em 0; }
       .XXX > :first-child { margin-top: 0; }
       p .XXX { line-height: 3em; }
       .annotation { border: solid thin black; background: #0C479D; color: white; position: relative; margin: 8px 0 20px 0; }
       .annotation:before { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 6px -6px -6px 6px; background: #333333; z-index: -1; content: ''; }
       .annotation :link, .annotation :visited { color: inherit; }
       .annotation :link:hover, .annotation :visited:hover { background: transparent; }
       .annotation span { border: none ! important; }
       .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
       .warning { background-color: #F9F0D4; border: medium double #FF0000; margin: 1em; padding: 1em; }
       .note em, .warning em, .note i, .warning i { font-style: normal; }
       p.note, div.note { padding: 0.5em 2em; }
       span.note { padding: 0 2em; }
       .note p:first-child, .warning p:first-child { margin-top: 0; }
       .note p:last-child, .warning p:last-child { margin-bottom: 0; }
       .warning:before { font-style: normal; }
       p.note:before { content: 'Note: '; font-weight: bolder;}
       p.warning:before { content: '\26A0 Warning! '; font-weight:bolder;}
       .critical {margin:1em; border:double red; padding:1em; background-color:#F9F0D4;}

       .bookkeeping:before { display: block; content: 'Bookkeeping details'; font-weight: bolder; font-style: italic; }
       .bookkeeping { font-size: 0.8em; margin: 2em 0; }
       .bookkeeping p { margin: 0.5em 2em; display: list-item; list-style: square; }
       .bookkeeping dt { margin: 0.5em 2em 0; }
       .bookkeeping dd { margin: 0 3em 0.5em; }

       h4 { position: relative; z-index: 3; }
       h4 + .element, h4 + div + .element { margin-top: -2.5em; padding-top: 2em; }
       .element {
         background: #F4F4FA;
         color: black;
         margin: 0 0 1em 0.15em;
         padding: 0 1em 0.25em 0.75em;
         border-left: solid #9999FF 0.25em;
         position: relative;
         z-index: 1;
       }
       .element:before {
         position: absolute;
         z-index: 2;
         top: 0;
         left: -1.15em;
         height: 2em;
         width: 0.9em;
         background: #F4F4FA;
         content: ' ';
         border-style: none none solid solid;
         border-color: #9999FF;
         border-width: 0.25em;
       }

       .example { display: block; color: #222222; background: #FCFCFC; border-left-style: solid;border-color:#c0c0c0; border-left-width: 0.25em; margin-left: 1em; padding-left: 1em;padding-bottom: 0.5em;}
       div.example:before { content: 'Code Example: '; font-weight: bolder;}
       td > .example:only-child { margin: 0 0 0 0.1em; }

       ul.domTree, ul.domTree ul { padding: 0 0 0 1em; margin: 0; }
       ul.domTree li { padding: 0; margin: 0; list-style: none; position: relative; }
       ul.domTree li li { list-style: none; }
       ul.domTree li:first-child::before { position: absolute; top: 0; height: 0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree li:not(:last-child)::after { position: absolute; top: 0; bottom: -0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree span { font-style: italic; font-family: serif; }
       ul.domTree .t1 code { color: purple; font-weight: bold; }
       ul.domTree .t2 { font-style: normal; font-family: monospace; }
       ul.domTree .t2 .name { color: black; font-weight: bold; }
       ul.domTree .t2 .value { color: blue; font-weight: normal; }
       ul.domTree .t3 code, .domTree .t4 code, .domTree .t5 code { color: gray; }
       ul.domTree .t7 code, .domTree .t8 code { color: green; }
       ul.domTree .t10 code { color: teal; }

       body.dfnEnabled dfn { cursor: pointer; }
       .dfnPanel {
         display: inline;
         position: absolute;
         z-index: 10;
         height: auto;
         width: auto;
         padding: 0.5em 0.75em;
         font: small sans-serif, Droid Sans Fallback;
         background: #DDDDDD;
         color: black;
         border: outset 0.2em;
       }
       .dfnPanel * { margin: 0; padding: 0; font: inherit; text-indent: 0; }
       .dfnPanel :link, .dfnPanel :visited { color: black; }
       .dfnPanel p { font-weight: bolder; }
       .dfnPanel * + p { margin-top: 0.25em; }
       .dfnPanel li { list-style-position: inside; }

       #configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
       #configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
       #configUI p label { display: block; }
       #configUI #updateUI, #configUI .loginUI { text-align: center; }
       #configUI input[type=button] { display: block; margin: auto; }

       fieldset { margin: 1em; padding: 0.5em 1em; }
       fieldset > legend + * { margin-top: 0; }
       fieldset > :last-child { margin-bottom: 0; }
       fieldset p { margin: 0.5em 0; }
       header p.subline {color:#005A9C; font: 140% sans-serif;margin: 0.75em 0;}
       #authorButton {overflow: visible; padding: 0.1em 0.3em; position: fixed; right: 2em; top: 6em; width: auto;}

       @media print {#authorButton { display:none;}}

  </style>
  <link href="./HTML Canvas 2D Context_files/W3C-REC" rel="stylesheet" type="text/css">

   </head>
 <body>
  <div class="head" id="head">
    <p>免责申明：本文档为W3C规范的HTML5 Canvas 2D Context的中文（简体）志愿者翻译，该文档英文原文在 https://www.w3.org/TR/2015/REC-2dcontext-20151119/。W3C不对翻译的内容负责，且翻译的内容为翻译者本人所有。</p>
    <p>关于翻译：本文档内仍有部分算法、实现部分未被翻译，因此希望有更多的志愿者参与该文档的翻译。若有意愿，可以通过pull requests的方式联系我，谢谢。</p>
<header>

   <p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="http://www.w3.org/Icons/w3c_home" width="72"></a></p>

    <h1>HTML Canvas 2D context</h1>
   <h2 class="no-num no-toc subline">W3C 推荐内容 2015年11月19日</h2>
   </header>
<dl>
    <dt>当前版本:</dt>
    <dd><a href="http://www.w3.org/TR/2015/REC-2dcontext-20151119/">http://www.w3.org/TR/2015/REC-2dcontext-20151119/</a></dd>
    <dt>最新发布版本:</dt>
    <dd><a href="http://www.w3.org/TR/2dcontext/">http://www.w3.org/TR/2dcontext/</a></dd>
    <dt>历史版本:</dt>
    <dd><a href="http://www.w3.org/TR/2015/PR-2dcontext-20150924/">http://www.w3.org/TR/2015/PR-2dcontext-20150924/</a></dd>
    <dt>
      </dt><dt id="specification-editors">编辑:</dt>
      <dd>W3C:</dd>
      <dd><a href="mailto:cabanier@adobe.com">Rik Cabanier</a>, Adobe Systems, Inc.</dd>
      <dd><a href="mailto:jmann@microsoft.com">Jatinder Mann</a>, Microsoft Corporation</dd>
      <dd><a href="mailto:jaymunro@microsoft.com">Jay Munro</a>, Microsoft Corporation</dd>
      <dd><a href="mailto:wiltzius@google.com">Tom Wiltzius</a>, Google, Inc.</dd>
      <dd>WHATWG:</dd>
      <dd><a href="mailto:ian@hixie.ch">Ian Hickson</a>, Google, Inc.</dd>
   </dl>
   <p>发表后发现任何错误或反馈请访问 <a href="http://www.w3.org/2015/11/2dcontext-errata.html"><strong>勘误表</strong></a>。</p>

   <p>同样可参照<a href="http://www.w3.org/2003/03/Translations/byTechnology?technology=2dcontext"> <strong>翻译</strong></a>。</p>

   <p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">北航</a>)。 请遵守W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">职责</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">商标</a> 和 <a href="http://www.w3.org/Consortium/Legal/copyright-documents">文档使用</a> 规则。</p>
      <p><i>本文档中文译文为志愿者翻译，具体内容以该文档的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119">官方英文版本</a>为准。</i></p>
</div>


  <hr class="top">


  <h2 class="no-num no-toc" id="abstract">摘要</h2>

  <p>本规范定义了HTML的2D context
  <a href="http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element"><code>canvas</code></a>元素。
      该2D context提供了在<code>canvas</code>上绘制和操作图形的
      对象，方法和属性。</p>
  <h2 class="no-num no-toc" id="status-of-this-document">文档状态</h2>

<p><em>这部分内容描述了文档发布时的状态，可能会被其它文档取代。查看当前的W3C发布的文档和最新的技术报告列表可以访问http://www.w3.org/TR/<a href="http://www.w3.org/TR/">W3C技术报告索引</a>。</em></p>

    <p>
      本文是关于HTML canvas 元素的2D context规范，由<a href="http://www.w3.org/html/wg/">HTML工作组</a>发布。
    </p>


    <p>如果你想关于本文发表评论并且被W3C持续关注，请通过使用<a href="https://github.com/w3c/2dcontext/issues">我们的问题列表</a>提交。如果你不能这么做还可以通过电子邮件<a href="mailto:public-canvas-api@w3.org">public-canvas-api@w3.org</a>给我们反馈。
    (<a href="mailto:public-canvas-api-request@w3.org?subject=subscribe">订阅</a>，<a href="http://lists.w3.org/Archives/Public/public-canvas-api/">存档</a>)，
    同时我们会按顺序处理公开错误数据库的评论。我们欢迎任何反馈。</p>
    <p>
      通过发布本推荐内容，W3C期望推荐内容内的特定功能不会被Web IDL，CSS Object模型，CSS Images值，或CSS Fonts的改变影响，因为这些规范是本文的扩展。
    </p>
    <p>
        通过<a href="http://www.w3.org/html/wg/wiki/ExtensionSpecifications">扩展规范</a>
        继续跟踪本规范的扩展，该文档可以在浏览新特性时被访问。
    </p>
               <!-- UNDER NO CIRCUMSTANCES IS THE FOLLOWING PARAGRAPH TO BE REMOVED OR EDITED WITHOUT TALKING TO IAN FIRST -->
       <p class="alt">在拥有重用本规范许可情况下，本规范的大量内容同样可以在WHATWG <a href="https://html.spec.whatwg.org/#2dcontext">HTML living standard</a>获得。</p>
       <!-- UNDER NO CIRCUMSTANCES IS THE PRECEDING PARAGRAPH TO BE REMOVED OR EDITED WITHOUT TALKING TO IAN FIRST -->

  <!-- UNDER NO CIRCUMSTANCES IS THE FOLLOWING PARAGRAPH TO BE REMOVED OR EDITED WITHOUT TALKING TO IAN FIRST -->

  <!-- relationship to other work (required) -->

    <p>本规范同样可以在<a href="https://whatwg.org/">WHATWG</a>获得。W3C HTML工作组致力于在WHATWG living standard中囊括所有HTML规范，这由<a href="http://www.w3.org/2013/09/html-charter.html">W3C 工作组
  特许</a>规定。你有多种途径访问WHATWG：</p>
  <ul>
      <li>Commit-Watchers mailing list (complete source diffs): <a href="http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org">http://lists.whatwg.org/listinfo.cgi/commit-watchers-whatwg.org</a></li>
      <li>Github commits: <a href="https://github.com/whatwg/html/commits">https://github.com/whatwg/html/commits</a></li>
  </ul>


  <p>本文档已被W3C成员、软件开发者和其它W3C小组及兴趣团体重审，并且得到W3C推荐内容主管的认可。这是稳定的文档，并且可以被用作参考资料或被其它文档引用。W3C的职责是让这个推荐内容成为规范并提升使用程度。这增强了网络的功能性和互用性。</p>

  <p>
    <a href="https://www.w3.org/Bugs/Public/buglist.cgi?bug_status=UNCONFIRMED&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;bug_status=RESOLVED&amp;bug_status=VERIFIED&amp;bug_status=CLOSED&amp;component=CR%20HTML%20Canvas%202D%20Context&amp;list_id=57536&amp;product=HTML%20WG&amp;query_format=advanced">过往错误列表</a>仍然可以被访问。自之前发布后列表没有产生变动。
  </p>

 <p>
    在评选推荐内容阶段，小组发布了<a href="http://w3c.github.io/test-results/2dcontext/all.html">实现报告</a>和它的<a href="https://www.w3.org/wiki/HTML/Canvas_Task_Force/CR-Test"><code>drawFocusIfNeeded</code>和<code>addHitRegion</code>的伴随报告</a>。
  </p>

  <p>本规范是HTML5语言的拓展。所有HTML5规范中的正规内容（除非特定被本规范覆盖）都为本规范阐述的基础。</p>

<p>本文档由工作组在<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">2014年2月5日 W3C 版权规定</a>下制定的. W3C 维护着 <a href="http://www.w3.org/2004/01/pp-impl/40318/status" rel="disclosure">公共版权列表
</a> 并与小组交付保持联系；该页同样包含公开版权的步骤。认为实际版权包含了<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">必要声明</a>中的内容的个人可以根据<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">
   W3C 版权规定 第六章</a>公开信息。</p>

<p>本文档由<a id="w3c_process_revision" href="http://www.w3.org/2005/10/Process-20051014/">2005年10月14日 W3C Process Document</a>管理。 </p>

  <h2 class="no-num no-toc" id="contents">内容列表</h2>

<!--begin-toc-->
<ol class="toc">
 <li><a href="#conformance-requirements"><span class="secno">1 </span>一致性要求</a></li>
 <li><a href="#the-canvas-state"><span class="secno">2 </span>canvas状态</a></li>
 <li><a href="#line-styles"><span class="secno">3 </span>线条样式</a></li>
 <li><a href="#text-styles"><span class="secno">4 </span>文本样式</a></li>
 <li><a href="#building-paths"><span class="secno">5 </span>创建路径</a></li>
 <li><a href="#transformations"><span class="secno">6 </span>变换</a></li>
 <li><a href="#image-sources-for-2d-rendering-contexts"><span class="secno">7 </span>2D渲染环境的图像源</a></li>
 <li><a href="#fill-and-stroke-styles"><span class="secno">8 </span>填充和描边样式</a></li>
 <li><a href="#drawing-rectangles-to-the-canvas"><span class="secno">9 </span>在canvas上绘制矩形</a></li>
 <li><a href="#drawing-text-to-the-canvas"><span class="secno">10 </span>在canvas上绘制文字</a></li>
 <li><a href="#drawing-paths-to-the-canvas"><span class="secno">11 </span>在canvas上绘制路径</a></li>
 <li><a href="#drawing-images-to-the-canvas"><span class="secno">12 </span>在canvas上绘制图像</a></li>
 <li><a href="#hit-regions"><span class="secno">13 </span>点击区域</a></li>
 <li><a href="#pixel-manipulation"><span class="secno">14 </span>像素的操作</a></li>
 <li><a href="#compositing"><span class="secno">15 </span>合成</a></li>
 <li><a href="#shadows"><span class="secno">16 </span>阴影</a></li>
 <li><a href="#drawing-model"><span class="secno">17 </span>模型绘制</a></li>
 <li><a href="#best-practices"><span class="secno">18 </span>最佳实践</a></li>
 <li><a href="#examples"><span class="secno">19 </span>举例</a></li>
 <li><a class="no-num" href="#references">参考资料</a></li></ol>
<!--end-toc-->
  <hr>


  <h2 id="conformance-requirements"><span class="secno">1 </span>一致性要求</h2>

  <p>本规范是HTML规范。所有在HTML5核心规范中描述的一致性要求、类、定义、依赖、术语和排版约定都适用于本规范。 <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsHTML">[HTML]</a></p>

  <p>Web IDL用来定义接口。 <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsWEBIDL">[WEBIDL]</a></p>

  <p>本规范定义了 <dfn id="canvas-context-2d" title="canvas-context-2d"><code>2d</code></dfn>context类型，其
  API通过<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
  接口实现。</p>

  <div class="impl">

  <p><a href="http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element"><code>canvas</code></a>元素中的<a href="http://www.w3.org/TR/html5/scripting-1.html#dom-canvas-getcontext"><code title="dom-canvas-getContext">getContext()</code></a>
  方法是<span title="getContext-return">返回一个<var>contextId</var>对象</span> <code title="canvas-context-2d"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvas-context-2d">2d</a></code>，用户可以得到一个
  新的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象。任何额外的参数都会被忽略。</p>

  </div>

  <p>2D context展现了一个笛卡尔平面，其原点(0,0)位于左上角，并且<var>x</var>轴的正方向向右<var>y</var>轴正方向向下。</p>

  <pre class="idl">typedef (<span>HTMLImageElement</span> or
         <span>HTMLVideoElement</span> or
         <span>HTMLCanvasElement</span>) <dfn id="canvasimagesource">CanvasImageSource</dfn>;

interface <dfn id="canvasrenderingcontext2d">CanvasRenderingContext2D</dfn> {

  // back-reference to the canvas
  readonly attribute <a href="http://www.w3.org/TR/html5/scripting-1.html#htmlcanvaselement"><span>HTMLCanvasElement</span></a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-canvas" title="dom-context-2d-canvas">canvas</a>;

  // state
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-save" title="dom-context-2d-save">save</a>(); // push state on state stack
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-restore" title="dom-context-2d-restore">restore</a>(); // pop state stack and restore state
<!--
  // v7 we've also received requests for:
          attribute boolean <span title="dom-context-2d-forceHighQuality">forceHighQuality</span> // (default false)
  // when enabled, it would prevent the UA from falling back on lower-quality but faster rendering routines
  // useful e.g. for when an image manipulation app uses <canvas> both for UI previews and the actual work

-->
  // transformations (default: transform is the identity matrix)
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-scale" title="dom-context-2d-scale">scale</a>(unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-rotate" title="dom-context-2d-rotate">rotate</a>(unrestricted double angle);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-translate" title="dom-context-2d-translate">translate</a>(unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-transform" title="dom-context-2d-transform">transform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-settransform" title="dom-context-2d-setTransform">setTransform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
<!--
  // v7 we've also received requests (though not many so far) for:
  void skew(...);                             // is this common enough that one can't just use setTransform()?
  void reflect(...);  and  void mirror(...);  // aren't negative values in scale() sufficient for these?

-->
  // compositing
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">globalAlpha</a>; // (default: 1.0)
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">globalCompositeOperation</a>; // (default: "source-over")
<!--
  // v7 we've also received requests for:
  - turning off antialiasing to avoid seams when patterns are painted next to each other
    - might be better to overdraw?
    - might be better to just draw at a higher res then downsample, like for 3d?
  - nested layers
    - the ability to composite an entire set of drawing operations with one shadow all at once
      http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2008-August/015567.html

-->
  // colors and styles (see also the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a> interface)
           attribute (DOMString or CanvasGradient or CanvasPattern) <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle" title="dom-context-2d-strokeStyle">strokeStyle</a>; // (default: "black")
           attribute (DOMString or CanvasGradient or CanvasPattern) <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle" title="dom-context-2d-fillStyle">fillStyle</a>; // (default: "black")
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createlineargradient" title="dom-context-2d-createLinearGradient">createLinearGradient</a>(double x0, double y0, double x1, double y1);
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createradialgradient" title="dom-context-2d-createRadialGradient">createRadialGradient</a>(double x0, double y0, double r0, double x1, double y1, double r1);
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createpattern" title="dom-context-2d-createPattern">createPattern</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a> image, [TreatNullAs=EmptyString] DOMString repetition);

  // shadows
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsetx" title="dom-context-2d-shadowOffsetX">shadowOffsetX</a>; // (default: 0)
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsety" title="dom-context-2d-shadowOffsetY">shadowOffsetY</a>; // (default: 0)
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur" title="dom-context-2d-shadowBlur">shadowBlur</a>; // (default: 0)
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor" title="dom-context-2d-shadowColor">shadowColor</a>; // (default: "transparent black")

  // rects
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearrect" title="dom-context-2d-clearRect">clearRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillrect" title="dom-context-2d-fillRect">fillRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokerect" title="dom-context-2d-strokeRect">strokeRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);

  // path API (see also <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspathmethods">CanvasPathMethods</a>)
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-beginpath" title="dom-context-2d-beginPath">beginPath</a>();
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fill" title="dom-context-2d-fill">fill</a>();
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroke" title="dom-context-2d-stroke">stroke</a>();
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawfocusifneeded" title="dom-context-2d-drawFocusIfNeeded">drawFocusIfNeeded</a>(<span>Element</span> element);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clip" title="dom-context-2d-clip">clip</a>();
  boolean <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-ispointinpath" title="dom-context-2d-isPointInPath">isPointInPath</a>(unrestricted double x, unrestricted double y);

  // text (see also the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a> interface)
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-filltext" title="dom-context-2d-fillText">fillText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroketext" title="dom-context-2d-strokeText">strokeText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);<!-- v6DVT
  void <span title="dom-context-2d-fillVerticalText">fillVerticalText</span>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxHeight);
  void <span title="dom-context-2d-strokeVerticalText">strokeVerticalText</span>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxHeight); -->
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#textmetrics">TextMetrics</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext" title="dom-context-2d-measureText">measureText</a>(DOMString text);

  // drawing images
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage" title="dom-context-2d-drawImage">drawImage</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a> image, unrestricted double sx, unrestricted double sy, unrestricted double sw, unrestricted double sh, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);

  // hit regions
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-addhitregion" title="dom-context-2d-addHitRegion">addHitRegion</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hitregionoptions">HitRegionOptions</a> options);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-removehitregion" title="dom-context-2d-removeHitRegion">removeHitRegion</a>(DOMString id);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearhitregions" title="dom-context-2d-clearHitRegions">clearHitRegions</a>();

  // pixel manipulation
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createimagedata" title="dom-context-2d-createImageData">createImageData</a>(unrestricted double sw, unrestricted double sh);
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createimagedata" title="dom-context-2d-createImageData">createImageData</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> imagedata);
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata" title="dom-context-2d-getImageData">getImageData</a>(double sx, double sy, double sw, double sh);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata" title="dom-context-2d-putImageData">putImageData</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> imagedata, double dx, double dy);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata" title="dom-context-2d-putImageData">putImageData</a>(<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a> imagedata, double dx, double dy, double dirtyX, double dirtyY, double dirtyWidth, double dirtyHeight);
};
<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a> implements <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a>;
<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a> implements <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspathmethods">CanvasPathMethods</a>;

[NoInterfaceObject]
interface <dfn id="canvasdrawingstyles">CanvasDrawingStyles</dfn> {
  // line caps/joins
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth" title="dom-context-2d-lineWidth">lineWidth</a>; // (default: 1)
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap" title="dom-context-2d-lineCap">lineCap</a>; // "butt", "round", "square" (default: "butt")
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin" title="dom-context-2d-lineJoin">lineJoin</a>; // "round", "bevel", "miter" (default: "miter")
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-miterlimit" title="dom-context-2d-miterLimit">miterLimit</a>; // (default: 10)

  // dashed lines
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-setlinedash" title="dom-context-2d-setLineDash">setLineDash</a>(sequence&lt;unrestricted double&gt; segments); // (default: empty)
  sequence&lt;unrestricted double&gt; <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getlinedash" title="dom-context-2d-getLineDash">getLineDash</a>();
           attribute unrestricted double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linedashoffset" title="dom-context-2d-lineDashOffset">lineDashOffset</a>;


  // text
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font" title="dom-context-2d-font">font</a>; // (default: "10px sans-serif")
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign" title="dom-context-2d-textAlign">textAlign</a>; // "start", "end", "left", "right", "center" (default: "start")
           attribute DOMString <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline" title="dom-context-2d-textBaseline">textBaseline</a>; // "top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (default: "alphabetic")
};

[NoInterfaceObject]
interface <dfn id="canvaspathmethods">CanvasPathMethods</dfn> {
  // shared path API methods
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-closepath" title="dom-context-2d-closePath">closePath</a>();
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-moveto" title="dom-context-2d-moveTo">moveTo</a>(unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-lineto" title="dom-context-2d-lineTo">lineTo</a>(unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-quadraticcurveto" title="dom-context-2d-quadraticCurveTo">quadraticCurveTo</a>(unrestricted double cpx, unrestricted double cpy, unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-beziercurveto" title="dom-context-2d-bezierCurveTo">bezierCurveTo</a>(unrestricted double cp1x, unrestricted double cp1y, unrestricted double cp2x, unrestricted double cp2y, unrestricted double x, unrestricted double y);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-arcto" title="dom-context-2d-arcTo">arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radius); <!-- see ARC-ORDER note below -->
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-rect" title="dom-context-2d-rect">rect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-arc" title="dom-context-2d-arc">arc</a>(unrestricted double x, unrestricted double y, unrestricted double radius, unrestricted double startAngle, unrestricted double endAngle, optional boolean counterclockwise = false); <!-- see ARC-ORDER note below -->

  };

interface <dfn id="canvasgradient">CanvasGradient</dfn> {
  // opaque object
  void <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-canvasgradient-addcolorstop" title="dom-canvasgradient-addColorStop">addColorStop</a>(double offset, DOMString color);
};

interface <dfn id="canvaspattern">CanvasPattern</dfn> {
  // opaque object
};

interface <dfn id="textmetrics">TextMetrics</dfn> {
  readonly attribute double <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-textmetrics-width-0" title="dom-textmetrics-width">width</a>;
};

dictionary <dfn id="hitregionoptions">HitRegionOptions</dfn> {
  // dictionary to allow expansion on Hit Regions in Canvas Context 2D Level 2
  <span>DOMString</span> <span title="dom-HitRegionOptions-id">id</span> = "";
  // for control-backed regions:
  <span>Element?</span> <span title="dom-HitRegionOptions-control">control</span> = null;
};

interface <dfn id="imagedata">ImageData</dfn> {
  readonly attribute unsigned long <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-width" title="dom-imagedata-width">width</a>;
  readonly attribute unsigned long <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-height" title="dom-imagedata-height">height</a>;
  readonly attribute <span>Uint8ClampedArray</span> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-data" title="dom-imagedata-data">data</a>;
};

</pre>

 <!-- ARC-ORDER note (see above):
      some demos rely on the precise order of the arc() and arcTo()
      methods, see https://bugzilla.mozilla.org/show_bug.cgi?id=623437
      for an example, and its duplicates for more -->

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-canvas"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-canvas">canvas</a></code></dt>

   <dd>

    <p>返回该<code>canvas</code>元素。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><dfn id="dom-context-2d-canvas" title="dom-context-2d-canvas"><code>canvas</code></dfn>
  属性必定返回当前context下的<code>canvas</code>元素。</p>

  <p>除非特殊规定，在2D context下,
  <strong>通过传入infinite或者NaN值的数字类型参数调用的方法都会被忽略</strong>。</p>

  <!--
   Philip Taylor wrote:
   > My experience with some 3d canvas code is that infinities come up in
   > naturally harmless places, e.g. having a function that scales by x then
   > translates by 1/x and wanting it to work when x=0 (which ought to draw
   > nothing, since anything it draws is zero pixels wide), and it's a bit
   > annoying to track down and fix those issues, so I'd probably like it if
   > they were harmless in canvas methods. Opera appears to silently not draw
   > anything if the transformation matrix is not finite, but Firefox <a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">throws</a>
   > exceptions when passing in non-finite arguments.
  -->
 <!--the "computed value of the 'color' property" for the purposes of determining the computed value of the currentColor keyword is the computed value of the 'color' property on the element in question at the time that the color is specified -->
  <p>在此API中，无论CSS值<code>currentColor</code>是否描述了颜色,在颜色被指定时（例如：正确的设置属性，调用函数，该颜色未被渲染或以其它方式使用），决定关键字<code>currentColor</code>的计算值的"'color'属性的计算值"
  是该元素的'color'属性的计算值。如果'color'属性的计算值由于某些原因是undefined（例如：该元素并<span>不在<code>Document</code>内</span>）
   那么被用来决定关键字<code>currentColor</code>的计算值的"'color'属性的计算值"完全是黑色的。<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSCOLOR">[CSSCOLOR]</a></p>

  <p>在<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>的<code title="dom-canvasgradient-addColorStop"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-canvasgradient-addcolorstop">addColorStop()</a></code>中，决定关键字<code>currentColor</code>的计算值的"'color'属性的计算值"总是黑色的
  （没有其它元素影响下）<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSCOLOR">[CSSCOLOR]</a></p>

  <p class="note">由于<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>对象是<code>canvas</code>-neutral的——一个由<code>canvas</code>创建的
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>对象可以被其它对象使用
  ，当指定颜色后用户也没办法得知具体的元素对象。</p>

  <p class="note">与字体有关的属性同样存在相似的状况，在后面相关部分中会详尽阐述这些规则。</p>

  </div>



<!--FIXUP 2dcontext +4-->
  <h2 id="the-canvas-state"><span class="secno">2 </span>canvas状态</h2>

  <p>每个context都保留了一个绘图状态的堆栈。<dfn id="drawing-state" title="drawing state">绘图状态</dfn>包含：</p>

  <ul class="brief">
   <li>当前的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">变换矩阵</a>。</li>
   <li>当前的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region">剪贴板</a>。</li>
   <li>以下属性的当前值<code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code>，<code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code>，<code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code>，<code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code>，<code title="dom-context-2d-lineCap"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap">lineCap</a></code>，<code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code>，<code title="dom-context-2d-miterLimit"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-miterlimit">miterLimit</a></code>，<code title="dom-context-2d-shadowOffsetX"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code>，<code title="dom-context-2d-shadowOffsetY"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsety">shadowOffsetY</a></code>，<code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code>，<code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code>，<code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>，<code title="dom-context-2d-font"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font">font</a></code>，<code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code>，<code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code>。</li>
  </ul>

  <p class="note">当前路径和位图不包括在绘图状态内。<span>当前路径</span>是持久的，并且只能被
  <code title="dom-context-2d-beginPath"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-beginpath">beginPath()</a></code>方法重置。
  当前位图是canvas的属性，而不是context的属性。</p>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-save"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-save">save</a></code>()</dt>

   <dd>

    <p>将当前状态压入堆栈。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-restore"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-restore">restore</a></code>()</dt>

   <dd>

    <p>将顶部状态弹出堆栈作为当前状态。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><dfn id="dom-context-2d-save" title="dom-context-2d-save"><code>save()</code></dfn>
  方法将当前的绘图状态的拷贝压入绘图状态堆栈。</p>

  <p><dfn id="dom-context-2d-restore" title="dom-context-2d-restore"><code>restore()</code></dfn>
      方法将绘图状态堆栈顶部的状态弹出，并依此重置绘图状态。如果没有保存任何状态，此方法将不作任何操作。
  </p>

  <!-- v7
idea from Mihai:
> 5. Drawing states should be saveable with IDs, and for easier restoring.
>
> save(id)
> restore(id)
>
> If id is not provided, then save() works as defined now. The same for
> restore().
>
> Currently, it's not trivial to save and restore a specific state.
...and from Philip:
> I think a more convenient syntax would be:
>   var state = ctx.save();
>   ctx.restore(state);
> But how would it interact with normal calls to ctx.restore()?
  -->

  </div>


  <h2 id="line-styles"><span class="secno">3 </span>线条样式</h2>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前线宽</p>

    <p>可以用来设置线宽。大于0的无穷值作为参数会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-lineCap"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap">lineCap</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前线帽样式。</p>

    <p>可以用来设置线帽样式。</p>

    <p>可能的线帽样式有 "<code>butt</code>"，
    "<code>round</code>" 和 "<code>square</code>"。其它参数会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前的线连接样式。</p>

    <p>可以用来设置线连接样式。</p>

    <p>可能的线连接样式有 "<code>bevel</code>"，
    "<code>round</code>"，和"<code>miter</code>"。其它参数会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-miterLimit"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-miterlimit">miterLimit</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前最大斜接长度。</p>

    <p>可以用来设置最大斜接长度。大于0的无穷值作为参数会被忽略。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-setLineDash"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-setlinedash">setLineDash</a></code>(<var>segments</var>)</dt>

   <dd>

    <p>可以用来设置当前线条虚实（当描边时）。
        其参数是表示线条虚实的数组。</p>

   </dd>


   <dt><var>segments</var> = <var>context</var> . <code title="dom-context-2d-getLineDash"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getlinedash">getLineDash</a></code>()</dt>

   <dd>

    <p>返回当前线条虚实。总是返回偶数个数组元素（线条虚实是规范化的）。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-lineDashOffset"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linedashoffset">lineDashOffset</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回偏移量（与线条虚实中的单位相同）。</p>

    <p>可以用来设置偏移量。大于0的无穷值作为参数会被忽略。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>对象的接口（本节描述的）包含了控制线条的属性和方法。</p>

  <p><dfn id="dom-context-2d-linewidth" title="dom-context-2d-lineWidth"><code>lineWidth</code></dfn>
  属性给出了坐标空间单位的线条宽度。获取时返回当前值，设置时0、负数、Infinite和NaN值会被忽略，并保持原值不变；其它数值会更新当前数值。</p>

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后
  ，<code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code>属性必定会初始化为<code>1.0</code>。</p>
  <hr>

  <p><dfn id="dom-context-2d-linecap" title="dom-context-2d-lineCap"><code>lineCap</code></dfn>属性定义了线条两端的样式。
  合法的三个值为"<code>butt</code>"，"<code>round</code>"
  和"<code>square</code>"。</p>

  <p>获取时它会返回当前值，设置时如果值是字符串"<code>butt</code>"，
  "<code>round</code>"和"<code>square</code>"，那么当前值会被更新；其它值会被忽略，并保持原值不变。</p>

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后
  ，<code title="dom-context-2d-lineCap"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap">lineCap</a></code>属性必定会初始化为
  "<code>butt</code>"。</p>

  <hr>

  <p><dfn id="dom-context-2d-linejoin" title="dom-context-2d-lineJoin"><code>lineJoin</code></dfn>
  属性定义了两条线条相交的拐角类型。有三个合法值"<code>bevel</code>"，
  "<code>round</code>"和"<code>miter</code>"。</p>

  <p>获取时它会返回当前值，设置时如果值是字符串"<code>bevel</code>"，
  "<code>round</code>"和"<code>miter</code>"，那么当前值会被更新；其它值会被忽略，并保持原值不变。</p>

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后
  ，<code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code>属性必定会初始化为
  "<code>miter</code>"。</p>

  <hr>

  <p>当<code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code>
  属性包含"<code>miter</code>"描边会根据最大斜接长度来渲染连接点。最大斜接长度可以通过<dfn id="dom-context-2d-miterlimit" title="dom-context-2d-miterLimit"><code>miterLimit</code></dfn>
  属性设置。获取时它会返回当前值，设置时0、负数、Infinite和NaN值会被忽略，并保持原值不变；其它值会更新当前值。</p>
  <!-- values less than 1.0 are equivalent to 1.0, since it's compared
       against a ratio that can't be less than 1.0 -->

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后
  ，<code title="dom-context-2d-miterLimit"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-miterlimit">miterLimit</a></code>属性必定会初始化为
  <code>10.0</code>。</p>

  <hr>

  <hr><p>每个<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>对象都包含<dfn id="dash-list">dash
  list</dfn>。它要么是空值要么是偶数个数的非0数组。初始化时<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>
  是空值。</p>

  <p>当<dfn id="dom-context-2d-setlinedash" title="dom-context-2d-setLineDash"><code>setLineDash()</code></dfn>
  方法被调用时，它会进行以下步骤：</p>

      <ol>

          <li><p>Let <var>a</var> be a copy of the array provided as
              the argument.</p></li>

          <li><p>If any value in the array is not finite (e.g. an Infinity or
              a NaN value), or if any value is negative (less than zero), then
              abort these steps (without throwing an exception; user agents could
              show a message on a developer console, though, as that would be
              helpful for debugging).</p></li>

          <li><p>If the number of elements in <var>a</var> is odd,
              then let <var>a</var> be the concatenation of two copies
              of <var>a</var>.</p></li>

          <li><p>Let the object's <a href="#dash-list">dash list</a> be <var>a</var>.</p></li>

      </ol>
  <!--
  <ol>

   <li><p>将<var>a</var>赋值为数组的拷贝，并作为参数。</p></li>

   <li><p>如果数组中的数值都是无穷的（例如：Infinity或者NaN）或者为负数（小于0），那么跳过这些步骤
       （不抛出异常；但是用户可以看到开发者控制台的消息，这有利于调试错误）。</p></li>

   <li><p>如果<var>a</var>中的元素数目已过时，
   那么将<var>a</var>赋值为两份<var>a</var>数组的拷贝的拼接。</p></li>

   <li><p>将对象的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>赋值为<var>a</var>。</p></li>

  </ol>
  -->
  <p>当<dfn id="dom-context-2d-getlinedash" title="dom-context-2d-getLineDash"><code>getLineDash()</code></dfn>
  方法被调用，它会返回一个值为<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>对象值的新建数组。
  </p>

  <p>有时更改线条虚实的"相（phase）"很有用，例如获得"marching ants"效果。通过<dfn id="dom-context-2d-linedashoffset" title="dom-context-2d-lineDashOffset"><code>lineDashOffset</code></dfn>
  属性可以设置相。获取时它返回当前值，设置时Infinite和NaN值会被忽略，并保持原值不变；其它值会更新当前值。</p>

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后
  ，<code title="dom-context-2d-lineDashOffset"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linedashoffset">lineDashOffset</a></code>
  属性必定会初始化为<code>0.0</code>。</p>

   <hr>

  <p>当客户端<dfn id="trace-a-path">trace a <span title="concept-path">path</span></dfn>时， <!-- <dfn>trace a path</dfn> -->
  如果对象的<var data-anolis-xref="">style</var>实现了<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>
  接口，它会按照以下算法计算并返回一个新的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>。</p>



      <ol>

          <li><p>Let <var data-anolis-xref="">path</var> be a copy of the path being traced.</p></li>

          <!-- PATH SANITIZATION -->

          <li><p>Prune all zero-length line segments from <var data-anolis-xref="">path</var>.</p></li>

          <li><p>Remove from <var data-anolis-xref="">path</var> any subpaths containing no lines (i.e. subpaths with
              just one point).</p></li>

          <li><p>Replace each point in each subpath of <var data-anolis-xref="">path</var> other than the first point
              and the last point of each subpath by a <i>join</i> that joins the line leading to that point to
              the line leading out of that point, such that the subpaths all consist of two points (a starting
              point with a line leading out of it, and an ending point with a line leading into it), one or
              more lines (connecting the points and the joins), and zero or more joins (each connecting one
              line to another), connected together such that each subpath is a series of one or more lines with
              a join between each one and a point on each end.</p></li>

          <li><p>Add a straight closing line to each closed subpath in <var data-anolis-xref="">path</var> connecting
              the last point and the first point of that subpath; change the last point to a join (from the
              previously last line to the newly added closing line), and change the first point to a join (from
              the newly added closing line to the first line).</p>

          </li><li><p>If the <var data-anolis-xref="">styles</var> <a href="#dash-list">dash list</a> is empty, jump to the step
          labeled <i>convert</i>.</p></li>

          <!-- DASHING -->

          <li><p>Let <var data-anolis-xref="">pattern width</var> be the concatenation of all the entries of the <var data-anolis-xref="">styles</var> <a href="#dash-list">dash list</a>, in coordinate space units.</p>

          </li><li><p>For each subpath <var data-anolis-xref="">subpath</var> in <var data-anolis-xref="">path</var>, run the
          following substeps. These substeps mutate the subpaths in <var data-anolis-xref="">path</var> <i>in
              vivo</i>.</p>

          <ol>

              <li><p>Let <var data-anolis-xref="">subpath width</var> be the length of all the lines of <var data-anolis-xref="">subpath</var>, in coordinate space units.</p>

              </li><li><p>Let <var data-anolis-xref="">offset</var> be the value of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineDashOffset"><a href="#dom-context-2d-linedashoffset">lineDashOffset</a></code>, in coordinate space
              units.</p></li>

              <li>

                  <p>While <var data-anolis-xref="">offset</var> is greater than <var data-anolis-xref="">pattern width</var>,
                      decrement it by <var data-anolis-xref="">pattern width</var>.</p>

                  <p>While <var data-anolis-xref="">offset</var> is less than zero, increment it by <var data-anolis-xref="">pattern
                      width</var>.</p>

              </li>

              <li><p>Define <var data-anolis-xref="">L</var> to be a linear coordinate line defined along all lines in
                  <var data-anolis-xref="">subpath</var>, such that the start of the first line in the subpath is defined
                  as coordinate 0, and the end of the last line in the subpath is defined as coordinate <var data-anolis-xref="">subpath width</var>.</p></li>

              <li><p>Let <var data-anolis-xref="">position</var> be zero minus <var data-anolis-xref="">offset</var>.</p></li>

              <li><p>Let <var data-anolis-xref="">index</var> be 0.</p></li>

              <li><p>Let <var data-anolis-xref="">current state</var> be <i>off</i> (the other states being <i>on</i>
                  and <i>zero-on</i>).</p></li>

              <li><p><i id='step-dash-on'>Dash on</i>: Let <var data-anolis-xref="">segment length</var> be
                  the value of the <var data-anolis-xref="">styles</var> <a href="#dash-list">dash
                      list</a>'s <var data-anolis-xref="">index</var>th entry.</p></li>

              <li><p>Increment <var data-anolis-xref="">position</var> by <var data-anolis-xref="">segment length</var>.</p></li>

              <li><p>If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then
                  end these substeps for this subpath and start them again for the next subpath; if there are no
                  more subpaths, then jump to the step labeled <i>convert</i> instead.</p></li>

              <li><p>If <var data-anolis-xref="">segment length</var> is non-zero, let <var data-anolis-xref="">current state</var> be <i>on</i>.</p></li>

              <li><p>Increment <var data-anolis-xref="">index</var> by one.</p></li>

              <li><p><i>Dash off<!-- labeled for consistency only --></i>: Let <var data-anolis-xref="">segment
                  length</var> be the value of the <var data-anolis-xref="">styles</var> <a href="#dash-list">dash list</a>'s <var data-anolis-xref="">index</var>th entry.</p></li>

              <li><p>Let <var data-anolis-xref="">start</var> be the offset <var data-anolis-xref="">position</var> on <var data-anolis-xref="">L</var>.</p></li>

              <li><p>Increment <var data-anolis-xref="">position</var> by <var data-anolis-xref="">segment length</var>.</p></li>

              <li><p>If <var data-anolis-xref="">position</var> is less than zero, then jump to the step labeled
                  <i>post-cut</i>.</p></li> <!-- start and end both before zero -->

              <li><p>If <var data-anolis-xref="">start</var> is less than zero, then let <var data-anolis-xref="">start</var> be
                  zero.</p></li> <!-- end will be (at or) after zero -->

              <li><p>If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then
                  let <var data-anolis-xref="">end</var> be the offset <var data-anolis-xref="">subpath width</var> on <var data-anolis-xref="">L</var>. Otherwise, let <var data-anolis-xref="">end</var> be the offset <var data-anolis-xref="">position</var> on <var data-anolis-xref="">L</var>.</p></li>

              <li>

                  <p>Run one of the following substeps, as appropriate:</p>

                  <dl class="switch">

                      <dt>If <var data-anolis-xref="">segment length</var> is zero and <var data-anolis-xref="">current state</var> is <i>off</i></dt>

                      <dd>

                          <p>Do nothing, just continue to the next step.</p>

                      </dd>


                      <dt>If <var data-anolis-xref="">current state</var> is <i>off</i></dt>

                      <dd>

                          <p>Cut the line on which <var data-anolis-xref="">end</var> finds itself short at <var data-anolis-xref="">end</var> and place a point there, cutting its containing subpath in two;
                              remove all line segments, joins, points, and subpaths that are between <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var>; and finally place a single point at <var data-anolis-xref="">start</var> with no lines connecting to it.</p>

                          <p>The point has a <i>directionality</i> for the purposes of drawing line caps (see below).
                              The directionality is the direction that the original line had at that point (i.e. when <var data-anolis-xref="">L</var> was defined above).</p>
                      </dd>


                      <dt>Otherwise</dt>

                      <dd>

                          <p>Cut the line on which <var data-anolis-xref="">start</var> finds itself into two at <var data-anolis-xref="">start</var> and place a point there, cutting the subpath that it was in in two, and
                              similarly cut the line on which <var data-anolis-xref="">end</var> finds itself short at <var data-anolis-xref="">end</var> and place a point there, cutting the subpath that <em>it</em> was in in
                              two, and then remove all line segments, joins, points, and subpaths that are between <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var>.</p>

                          <p>If <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var> are the same point, then this
                              results in just the line being cut in two and two points being inserted there, with nothing
                              being removed, unless a join also happens to be at that point, in which case the join must
                              be removed.</p>
                      </dd>

                  </dl>

              </li>

              <li><p><i>Post-cut</i>: If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then jump to the step labeled <i>convert</i>.</p></li>

              <li><p>If <var data-anolis-xref="">segment length</var> is greater than zero, let <var data-anolis-xref="">positioned-at-on-dash</var> be false.</p></li>

              <li><p>Increment <var data-anolis-xref="">index</var> by one. If it is equal to the number of entries in
                  the <var data-anolis-xref="">styles</var> <a href="#dash-list">dash list</a>, then let <var data-anolis-xref="">index</var> be
                  0.</p></li>

              <li><p>Jump to the step labeled <i><a href='#step-dash-on'>dash on</a></i>.</p></li>

          </ol>

      </li>

          <!-- STROKING -->

          <li>

              <p><i>Convert</i>: This is the step that converts the path to a new path that represents its
                  stroke.</p>

              <p>Create a new <a href="#concept-path" title="concept-path">path</a> that describes the edge of the areas that
                  would be covered if a straight line of length equal to the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> was swept along each path in <var data-anolis-xref="">path</var> while being kept at an angle such that the line is orthogonal to the path
                  being swept, replacing each point with the end cap necessary to satisfy the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code> attribute as described
                  previously and elaborated below, and replacing each join with the join necessary to satisfy the
                  <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> type, as
                  defined below.</p>

              <p><strong>Caps</strong>: Each point has a flat edge perpendicular to the direction of the line
                  coming out of it. This is them augmented according to the value of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineCap"><a href="#dom-context-2d-linecap">lineCap</a></code>. The "<code>butt</code>"
                  value means that no additional line cap is added. The "<code>round</code>" value means that a
                  semi-circle with the diameter equal to the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> width must additionally be placed onto the
                  line coming out of each point. The "<code>square</code>" value means that a rectangle with the
                  length of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code>
                  width and the width of half the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="#dom-context-2d-linewidth">lineWidth</a></code> width, placed flat against the edge
                  perpendicular to the direction of the line coming out of the point, must be added at each
                  point.</p>

              <p>Points with no lines coming out of them must have two caps placed back-to-back as if it was
                  really two points connected to each other by an infinitesimally short straight line in the
                  direction of the point's <i>directionality</i> (as defined above).</p>

              <p><strong>Joins</strong>: In addition to the point where a join occurs, two additional points
                  are relevant to each join, one for each line: the two corners found half the line width away
                  from the join point, one perpendicular to each line, each on the side furthest from the other
                  line.</p>

              <p>A filled triangle connecting these two opposite corners with a straight line, with the third
                  point of the triangle being the join point, must be added at all joins. The <code title="dom-context-2d-lineJoin"><a href="#dom-context-2d-linejoin">lineJoin</a></code> attribute controls whether anything else is
                  rendered. The three aforementioned values have the following meanings:</p>

              <p>The "<code>bevel</code>" value means that this is all that is rendered at joins.</p>

              <p>The "<code>round</code>" value means that a filled arc connecting the two aforementioned
                  corners of the join, abutting (and not overlapping) the aforementioned triangle, with the
                  diameter equal to the line width and the origin at the point of the join, must be added at
                  joins.</p>

              <p>The "<code>miter</code>" value means that a second filled triangle must (if it can given the
                  miter length) be added at the join, with one line being the line between the two aforementioned
                  corners, abutting the first triangle, and the other two being continuations of the outside edges
                  of the two joining lines, as long as required to intersect without going over the miter
                  length.</p>

              <p>The miter length is the distance from the point where the join occurs to the intersection of
                  the line edges on the outside of the join. The miter limit ratio is the maximum allowed ratio of
                  the miter length to half the line width. If the miter length would cause the miter limit ratio
                  (as set by the <var data-anolis-xref="">style</var> <code title="dom-context-2d-miterLimit"><a href="#dom-context-2d-miterlimit">miterLimit</a></code> attribute) to be exceeded, this second
                  triangle must not be added.</p> <!-- the actual ratio can't possibly be less than 1.0 -->

              <!-- here's a nice demo of the miter:
                c.clearRect(0, 0, 640, 480);
                c.beginPath();

                c.moveTo((new Date()/100) % 600, 100);
                c.lineTo(300, 300);
                c.lineTo(500, 300);

                c.lineWidth = 50;
                c.miterLimit = 10000;
                c.strokeStyle = 'silver'
                c.stroke();

                c.miterLimit = 0.0001;
                c.strokeStyle = 'black'
                c.stroke();

                c.lineWidth = 1;
                c.strokeStyle = 'red'
                c.stroke();
              -->


              <p>Subpaths in the newly created path must wind clockwise, regardless of the direction of paths
                  in <var data-anolis-xref="">path</var>.</p>

              <!-- ...because both of these examples result in two lines (assuming non-zero winding rules,
              things are different under even/odd), there's no "hole" where the lines overlap:

                      c.beginPath();
                      c.lineWidth=30;
                      c.moveTo(200,200); // subpath 1
                      c.lineTo(400,200);
                      c.moveTo(400,210); // subpath 2
                      c.lineTo(200,190);
                      c.stroke();

                      c.beginPath();
                      c.lineWidth=30;
                      c.moveTo(200,200); // subpath 1
                      c.lineTo(400,200);
                      c.lineTo(300,300);
                      c.closePath();
                      c.moveTo(400,210); // subpath 2
                      c.lineTo(200,190);
                      c.lineTo(300,300);
                      c.closePath();
                      c.stroke();

               ...and we want the same result when you create the two subpaths in each example above as two
               Paths, stroke them onto a third Path, and then fill that Path on the context.
              -->

          </li>

          <li><p>Return the newly created path.</p></li>

      </ol>
  <!--<ol>-->

   <!--<li><p>跟踪<var data-anolis-xref="">path</var>的一份拷贝。</p></li>-->

   <!--&lt;!&ndash; PATH SANITIZATION &ndash;&gt;-->

   <!--<li><p>从<var data-anolis-xref="">path</var>中减掉无长度的线条片段.</p></li>-->

   <!--<li><p>从<var data-anolis-xref="">path</var>去掉所有不包含线条的子路径（例如：只有一个连接点的子路径）。</p></li>-->

   <!--<li><p>将除了第一个和最后一个<var data-anolis-xref="">path</var>的子路径中的连接点替换为一个有入度和出度的<i>连接点</i>，这样所有子路径包含两个点（出度起点和入度终点）-->
   <!--，一条或多条线条（连接各点），0个或更多的连接点（连接各线），使得每个子路径都是一系列的拥有连接点和终点的一条或多条的线条。-->
   <!--</p></li>-->

   <!--<li><p>Add a straight closing line to each closed subpath in <var data-anolis-xref="">path</var> connecting-->
   <!--the last point and the first point of that subpath; change the last point to a join (from the-->
   <!--previously last line to the newly added closing line), and change the first point to a join (from-->
   <!--the newly added closing line to the first line).</p>-->

   <!--</li><li><p>If the <var data-anolis-xref="">styles</var> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a> is empty, jump to the step-->
   <!--labeled <i>convert</i>.</p></li>-->

   <!--&lt;!&ndash; DASHING &ndash;&gt;-->

   <!--<li><p>Let <var data-anolis-xref="">pattern width</var> be the concatenation of all the entries of the <var data-anolis-xref="">styles</var> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>, in coordinate space units.</p>-->

   <!--</li><li><p>For each subpath <var data-anolis-xref="">subpath</var> in <var data-anolis-xref="">path</var>, run the-->
   <!--following substeps. These substeps mutate the subpaths in <var data-anolis-xref="">path</var> <i>in-->
   <!--vivo</i>.</p>-->

    <!--<ol>-->

     <!--<li><p>Let <var data-anolis-xref="">subpath width</var> be the length of all the lines of <var data-anolis-xref="">subpath</var>, in coordinate space units.</p>-->

     <!--</li><li><p>Let <var data-anolis-xref="">offset</var> be the value of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineDashOffset"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linedashoffset">lineDashOffset</a></code>, in coordinate space-->
     <!--units.</p></li>-->

     <!--<li>-->

      <!--<p>While <var data-anolis-xref="">offset</var> is greater than <var data-anolis-xref="">pattern width</var>,-->
      <!--decrement it by <var data-anolis-xref="">pattern width</var>.</p>-->

      <!--<p>While <var data-anolis-xref="">offset</var> is less than zero, increment it by <var data-anolis-xref="">pattern-->
      <!--width</var>.</p>-->

     <!--</li>-->

     <!--<li><p>Define <var data-anolis-xref="">L</var> to be a linear coordinate line defined along all lines in-->
     <!--<var data-anolis-xref="">subpath</var>, such that the start of the first line in the subpath is defined-->
     <!--as coordinate 0, and the end of the last line in the subpath is defined as coordinate <var data-anolis-xref="">subpath width</var>.</p></li>-->

     <!--<li><p>Let <var data-anolis-xref="">position</var> be zero minus <var data-anolis-xref="">offset</var>.</p></li>-->

     <!--<li><p>Let <var data-anolis-xref="">index</var> be 0.</p></li>-->

     <!--<li><p>Let <var data-anolis-xref="">current state</var> be <i>off</i> (the other states being <i>on</i>-->
     <!--and <i>zero-on</i>).</p></li>-->

     <!--<li><p><i id="step-dash-on">Dash on</i>: Let <var data-anolis-xref="">segment length</var> be-->
     <!--the value of the <var data-anolis-xref="">styles</var> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash-->
     <!--list</a>'s <var data-anolis-xref="">index</var>th entry.</p></li>-->

     <!--<li><p>Increment <var data-anolis-xref="">position</var> by <var data-anolis-xref="">segment length</var>.</p></li>-->

     <!--<li><p>If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then-->
     <!--end these substeps for this subpath and start them again for the next subpath; if there are no-->
     <!--more subpaths, then jump to the step labeled <i>convert</i> instead.</p></li>-->

     <!--<li><p>If <var data-anolis-xref="">segment length</var> is non-zero, let <var data-anolis-xref="">current state</var> be <i>on</i>.</p></li>-->

     <!--<li><p>Increment <var data-anolis-xref="">index</var> by one.</p></li>-->

     <!--<li><p><i>Dash off&lt;!&ndash; labeled for consistency only &ndash;&gt;</i>: Let <var data-anolis-xref="">segment-->
     <!--length</var> be the value of the <var data-anolis-xref="">styles</var> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>'s <var data-anolis-xref="">index</var>th entry.</p></li>-->

     <!--<li><p>Let <var data-anolis-xref="">start</var> be the offset <var data-anolis-xref="">position</var> on <var data-anolis-xref="">L</var>.</p></li>-->

     <!--<li><p>Increment <var data-anolis-xref="">position</var> by <var data-anolis-xref="">segment length</var>.</p></li>-->

     <!--<li><p>If <var data-anolis-xref="">position</var> is less than zero, then jump to the step labeled-->
     <!--<i>post-cut</i>.</p></li> &lt;!&ndash; start and end both before zero &ndash;&gt;-->

     <!--<li><p>If <var data-anolis-xref="">start</var> is less than zero, then let <var data-anolis-xref="">start</var> be-->
     <!--zero.</p></li> &lt;!&ndash; end will be (at or) after zero &ndash;&gt;-->

     <!--<li><p>If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then-->
     <!--let <var data-anolis-xref="">end</var> be the offset <var data-anolis-xref="">subpath width</var> on <var data-anolis-xref="">L</var>. Otherwise, let <var data-anolis-xref="">end</var> be the offset <var data-anolis-xref="">position</var> on <var data-anolis-xref="">L</var>.</p></li>-->

     <!--<li>-->

      <!--<p>Run one of the following substeps, as appropriate:</p>-->

      <!--<dl class="switch">-->

       <!--<dt>If <var data-anolis-xref="">segment length</var> is zero and <var data-anolis-xref="">current state</var> is <i>off</i></dt>-->

       <!--<dd>-->

        <!--<p>Do nothing, just continue to the next step.</p>-->

       <!--</dd>-->


       <!--<dt>If <var data-anolis-xref="">current state</var> is <i>off</i></dt>-->

       <!--<dd>-->

        <!--<p>Cut the line on which <var data-anolis-xref="">end</var> finds itself short at <var data-anolis-xref="">end</var> and place a point there, cutting its containing subpath in two;-->
        <!--remove all line segments, joins, points, and subpaths that are between <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var>; and finally place a single point at <var data-anolis-xref="">start</var> with no lines connecting to it.</p>-->

        <!--<p>The point has a <i>directionality</i> for the purposes of drawing line caps (see below).-->
        <!--The directionality is the direction that the original line had at that point (i.e. when <var data-anolis-xref="">L</var> was defined above).</p>-->
       <!--</dd>-->


       <!--<dt>Otherwise</dt>-->

       <!--<dd>-->

        <!--<p>Cut the line on which <var data-anolis-xref="">start</var> finds itself into two at <var data-anolis-xref="">start</var> and place a point there, cutting the subpath that it was in in two, and-->
        <!--similarly cut the line on which <var data-anolis-xref="">end</var> finds itself short at <var data-anolis-xref="">end</var> and place a point there, cutting the subpath that <em>it</em> was in in-->
        <!--two, and then remove all line segments, joins, points, and subpaths that are between <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var>.</p>-->

        <!--<p>If <var data-anolis-xref="">start</var> and <var data-anolis-xref="">end</var> are the same point, then this-->
        <!--results in just the line being cut in two and two points being inserted there, with nothing-->
        <!--being removed, unless a join also happens to be at that point, in which case the join must-->
        <!--be removed.</p>-->
       <!--</dd>-->

      <!--</dl>-->

     <!--</li>-->

     <!--<li><p><i>Post-cut</i>: If <var data-anolis-xref="">position</var> is greater than <var data-anolis-xref="">subpath width</var>, then jump to the step labeled <i>convert</i>.</p></li>-->

     <!--<li><p>If <var data-anolis-xref="">segment length</var> is greater than zero, let <var data-anolis-xref="">positioned-at-on-dash</var> be false.</p></li>-->

     <!--<li><p>Increment <var data-anolis-xref="">index</var> by one. If it is equal to the number of entries in-->
     <!--the <var data-anolis-xref="">styles</var> <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dash-list">dash list</a>, then let <var data-anolis-xref="">index</var> be-->
     <!--0.</p></li>-->

     <!--<li><p>Jump to the step labeled <i><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#step-dash-on">dash on</a></i>.</p></li>-->

    <!--</ol>-->

   <!--</li>-->

   <!--&lt;!&ndash; STROKING &ndash;&gt;-->

   <!--<li>-->

    <!--<p><i>Convert</i>: This is the step that converts the path to a new path that represents its-->
    <!--stroke.</p>-->

    <!--<p>Create a new <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a> that describes the edge of the areas that-->
    <!--would be covered if a straight line of length equal to the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code> was swept along each path in <var data-anolis-xref="">path</var> while being kept at an angle such that the line is orthogonal to the path-->
    <!--being swept, replacing each point with the end cap necessary to satisfy the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineCap"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap">lineCap</a></code> attribute as described-->
    <!--previously and elaborated below, and replacing each join with the join necessary to satisfy the-->
    <!--<var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code> type, as-->
    <!--defined below.</p>-->

    <!--<p><strong>Caps</strong>: Each point has a flat edge perpendicular to the direction of the line-->
    <!--coming out of it. This is them augmented according to the value of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineCap"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linecap">lineCap</a></code>. The "<code>butt</code>"-->
    <!--value means that no additional line cap is added. The "<code>round</code>" value means that a-->
    <!--semi-circle with the diameter equal to the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code> width must additionally be placed onto the-->
    <!--line coming out of each point. The "<code>square</code>" value means that a rectangle with the-->
    <!--length of the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code>-->
    <!--width and the width of half the <var data-anolis-xref="">styles</var> <code title="dom-context-2d-lineWidth"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linewidth">lineWidth</a></code> width, placed flat against the edge-->
    <!--perpendicular to the direction of the line coming out of the point, must be added at each-->
    <!--point.</p>-->

    <!--<p>Points with no lines coming out of them must have two caps placed back-to-back as if it was-->
    <!--really two points connected to each other by an infinitesimally short straight line in the-->
    <!--direction of the point's <i>directionality</i> (as defined above).</p>-->

    <!--<p><strong>Joins</strong>: In addition to the point where a join occurs, two additional points-->
    <!--are relevant to each join, one for each line: the two corners found half the line width away-->
    <!--from the join point, one perpendicular to each line, each on the side furthest from the other-->
    <!--line.</p>-->

    <!--<p>A filled triangle connecting these two opposite corners with a straight line, with the third-->
    <!--point of the triangle being the join point, must be added at all joins. The <code title="dom-context-2d-lineJoin"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-linejoin">lineJoin</a></code> attribute controls whether anything else is-->
    <!--rendered. The three aforementioned values have the following meanings:</p>-->

    <!--<p>The "<code>bevel</code>" value means that this is all that is rendered at joins.</p>-->

    <!--<p>The "<code>round</code>" value means that a filled arc connecting the two aforementioned-->
    <!--corners of the join, abutting (and not overlapping) the aforementioned triangle, with the-->
    <!--diameter equal to the line width and the origin at the point of the join, must be added at-->
    <!--joins.</p>-->

    <!--<p>The "<code>miter</code>" value means that a second filled triangle must (if it can given the-->
    <!--miter length) be added at the join, with one line being the line between the two aforementioned-->
    <!--corners, abutting the first triangle, and the other two being continuations of the outside edges-->
    <!--of the two joining lines, as long as required to intersect without going over the miter-->
    <!--length.</p>-->

    <!--<p>The miter length is the distance from the point where the join occurs to the intersection of-->
    <!--the line edges on the outside of the join. The miter limit ratio is the maximum allowed ratio of-->
    <!--the miter length to half the line width. If the miter length would cause the miter limit ratio-->
    <!--(as set by the <var data-anolis-xref="">style</var> <code title="dom-context-2d-miterLimit"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-miterlimit">miterLimit</a></code> attribute) to be exceeded, this second-->
    <!--triangle must not be added.</p> &lt;!&ndash; the actual ratio can't possibly be less than 1.0 &ndash;&gt;-->

<!--&lt;!&ndash; here's a nice demo of the miter:-->
  <!--c.clearRect(0, 0, 640, 480);-->
  <!--c.beginPath();-->

  <!--c.moveTo((new Date()/100) % 600, 100);-->
  <!--c.lineTo(300, 300);-->
  <!--c.lineTo(500, 300);-->

  <!--c.lineWidth = 50;-->
  <!--c.miterLimit = 10000;-->
  <!--c.strokeStyle = 'silver'-->
  <!--c.stroke();-->

  <!--c.miterLimit = 0.0001;-->
  <!--c.strokeStyle = 'black'-->
  <!--c.stroke();-->

  <!--c.lineWidth = 1;-->
  <!--c.strokeStyle = 'red'-->
  <!--c.stroke();-->
<!--&ndash;&gt;-->


    <!--<p>Subpaths in the newly created path must wind clockwise, regardless of the direction of paths-->
    <!--in <var data-anolis-xref="">path</var>.</p>-->

    <!--&lt;!&ndash; ...because both of these examples result in two lines (assuming non-zero winding rules,-->
    <!--things are different under even/odd), there's no "hole" where the lines overlap:-->

            <!--c.beginPath();-->
            <!--c.lineWidth=30;-->
            <!--c.moveTo(200,200); // subpath 1-->
            <!--c.lineTo(400,200);-->
            <!--c.moveTo(400,210); // subpath 2-->
            <!--c.lineTo(200,190);-->
            <!--c.stroke();-->

            <!--c.beginPath();-->
            <!--c.lineWidth=30;-->
            <!--c.moveTo(200,200); // subpath 1-->
            <!--c.lineTo(400,200);-->
            <!--c.lineTo(300,300);-->
            <!--c.closePath();-->
            <!--c.moveTo(400,210); // subpath 2-->
            <!--c.lineTo(200,190);-->
            <!--c.lineTo(300,300);-->
            <!--c.closePath();-->
            <!--c.stroke();-->

     <!--...and we want the same result when you create the two subpaths in each example above as two-->
     <!--Paths, stroke them onto a third Path, and then fill that Path on the context.-->
    <!--&ndash;&gt;-->

   <!--</li>-->

   <!--<li><p>Return the newly created path.</p></li>-->

  <!--</ol>-->

<!--v6: Another request has been for hairline width lines, that remain hairline width with
transform. ack Shaun Morris. -->


  </div>


  <h2 id="text-styles"><span class="secno">4 </span>文本样式</h2>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-font"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font">font</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前字体。</p>

    <p>可以用来设置字体。语法同CSS的'font'属性一样；不能被CSS字体解析的值会被忽略。</p>

    <p>相关关键字和长度会各自被<code>canvas</code>元素的字体计算。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前对齐方式。</p>

    <p>可以用来设置对齐方式。可能的值包括
    "<code>start</code>"，"<code>end</code>"，"<code>left</code>"，"<code>right</code>"和"<code>center</code>"。其它值会被忽略。默认值是
    "<code>start</code>"。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前基线对齐方式。</p>

    <p>可以用来设置基线对齐方式。可能的值及其含义在后文展示。其它的值会被忽略。默认值是"<code>alphabetic</code>"。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>设置<dfn id="dom-context-2d-font" title="dom-context-2d-font"><code>font</code></dfn> IDL
  属性是按照CSS的'font'属性解析的（但不支持类似'inherit'的property-independent样式表语法），同时结果会影响context。
  'line-height' 属性会被强制转换成
  'normal'，'font-size'属性会被转换为CSS像素，系统字体会被转换成精确的值。如果新值不正确则会被忽略，原值也不受影响。 <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSS">[CSS]</a></p>

  <p>使用时，字体名会被解释到<span>font
  style source node</span>样式表的context中。一旦被加载任何通过<code>@font-face</code>嵌入的可见元素都可以被获取。
  （如果参考字体在它被加载之前使用，或者当前<span>font style source node</span>中没有这种字体，那么都会被认为是未知字体并会按照相关CSS规范被解释成相类似字体。）
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSFONTS">[CSSFONTS]</a></p>

  <p>客户端只能使用矢量字体，使用位图字体会被转换并且看起来很丑陋。</p>

  <p>获取时<code title="dom-context-2d-font"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font">font</a></code>
  属性会返回当前字体的<span title="serializing a CSS
  value">serialized form</span>（没有'line-height'属性）。<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSOM">[CSSOM]</a></p>

  <div class="example">

   <p>例如：</p>

   <pre>context.font = 'italic 400 12px/2 Unknown Font, sans-serif';</pre>

   <p>表达式<code>context.font</code>会被执行为"<code>italic 12px "Unknown Font", sans-serif</code>"。
   "400" font-weight 不会显示，因为这是默认值。line-height不会显示，因为被强制转换成"normal"这是默认值。</p>

  </div>

  <p>当context被创建后，字体会被设置成10px sans-serif。当'font-size'属性被设置成百分数、'em'或'ex'为单位、'larger'或'smaller'关键字的形式时，<span>font style source
  node</span>的'font-size'属性会被解释成相对的值。当'font-weight'属性被设置成'bolder'或'lighter'时，<span>font style source
  node</span>的'font-weight'属性会被解释成相对的值。如果因为特殊原因计算值被设置成undefined，那么相对的关键字会被解释成normal-weight 10px sans-serif。</p>

  <p><dfn id="dom-context-2d-textalign" title="dom-context-2d-textAlign"><code>textAlign</code></dfn> IDL
  属性在获取时会返回当前值。设置时如果值是"<code>start</code>"、"<code>end</code>"、"<code>left</code>"、"<code>right</code>"或"<code>center</code>"其中之一，那么值会被改变。否则新值会被忽略。
  当context被创建后，<code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code>属性会被初始化为
  "<code>start</code>"。</p>

  <p><dfn id="dom-context-2d-textbaseline" title="dom-context-2d-textBaseline"><code>textBaseline</code></dfn>
  IDL属性在获取时会返回当前值。设置时如果值是"<code title="dom-context-2d-textBaseline-top"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-top">top</a></code>"，"<code title="dom-context-2d-textBaseline-hanging"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-hanging">hanging</a></code>"，"<code title="dom-context-2d-textBaseline-middle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-middle">middle</a></code>"，"<code title="dom-context-2d-textBaseline-alphabetic"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-alphabetic">alphabetic</a></code>"，
  "<code title="dom-context-2d-textBaseline-ideographic"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-ideographic">ideographic</a></code>"
  或"<code title="dom-context-2d-textBaseline-bottom"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-bottom">bottom</a></code>"其中之一，那么会改变原始值。否则新值会被忽略。
  当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>接口的对象被创建后，<code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code>属性会被初始化为
  "<code>alphabetic</code>"。</p>

  </div>

  <p><code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code>
  属性允许被设置成与对齐点相关的关键字：</p>

  <!-- this is filler to make sure the TCP packet boundary doesn't fall in the middle of one of the NCRs below -->
  <!-- (because otherwise the parser in anolis screws it up) -->
  <p><img alt="The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like आ are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like Á, ÿ, f, and Ω are anchored, the ideographic baseline is where glyphs like 私 and 達 are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square." height="300" src="https://www.w3.org/TR/2015/REC-2dcontext-20151119/images/baselines.png" width="738"></p>

  <p>与对齐点相关的关键字有：</p>

  <dl>

   <dt><dfn id="dom-context-2d-textbaseline-top" title="dom-context-2d-textBaseline-top"><code>top</code></dfn>
   </dt><dd>The top of the em square</dd>

   <dt><dfn id="dom-context-2d-textbaseline-hanging" title="dom-context-2d-textBaseline-hanging"><code>hanging</code></dfn>
   </dt><dd>The hanging baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-middle" title="dom-context-2d-textBaseline-middle"><code>middle</code></dfn>
   </dt><dd>The middle of the em square</dd>

   <dt><dfn id="dom-context-2d-textbaseline-alphabetic" title="dom-context-2d-textBaseline-alphabetic"><code>alphabetic</code></dfn>
   </dt><dd>The alphabetic baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-ideographic" title="dom-context-2d-textBaseline-ideographic"><code>ideographic</code></dfn>
   </dt><dd>The ideographic baseline</dd>

   <dt><dfn id="dom-context-2d-textbaseline-bottom" title="dom-context-2d-textBaseline-bottom"><code>bottom</code></dfn>
   </dt><dd>The bottom of the em square</dd>

  </dl>

  <p>以下展示了<dfn id="text-preparation-algorithm">text preparation algorithm</dfn>。
  它以<var>text</var>字符串、<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasdrawingstyles">CanvasDrawingStyles</a></code>对象的<var>target</var>和一个可选的<var>maxWidth</var>作为输入。
  它返回一个象形图形数组，并且每个都以一个坐标空间和一个值为<i>left</i>，<i>right</i>或<i title="">center</i>的<var>physical alignment</var>表示。（大部分情况会忽略<var>physical alignment</var>）</p>

  <ol>

   <li><p>If <var>maxWidth</var> was provided but is less
   than or equal to zero, return an empty array.</p></li>

   <li><p>Replace all the <span title="space character">space
   characters</span> in <var>text</var> with U+0020 SPACE
   characters.</p></li>

   <li><p>Let <var>font</var> be the current font of <var>target</var>, as given by that object's <code title="dom-context-2d-font"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font">font</a></code> attribute.</p></li>

   <li>

    <p>Apply the appropriate step from the following list to determine
    the value of <var>direction</var>:</p>

    <dl class="switch">

     <dt>If the <var>target</var> object's <span>font style
     source node</span> is an element</dt>

     <dd>Let <var>direction</var> be <span>the
     directionality</span> of the <var>target</var> object's
     <span>font style source node</span>.</dd>

     <dt>If the <var>target</var> object's <span>font style
     source node</span> is a <code>Document</code> and that
     <code>Document</code> has a root element child</dt>

     <dd>Let <var>direction</var> be <span>the
     directionality</span> of the <var>target</var> object's
     <span>font style source node</span>'s root element child.</dd>

     <dt>If the <var>target</var> object's <span>font style
     source node</span> is a <code>Document</code> and that
     <code>Document</code> has no root element child</dt>

     <dd>Let <var>direction</var> be '<span title="concept-ltr">ltr</span>'.</dd>

    </dl>

   </li>

   <li><p>Form a hypothetical infinitely-wide CSS line box containing
   a single inline box containing the text <var>text</var>,
   with all the properties at their initial values except the 'font'
   property of the inline box set to <var>font</var>, the
   'direction' property of the inline box set to <var>direction</var>, and the 'white-space' property set to
   'pre'. <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSS">[CSS]</a></p></li>

   <!-- if you insert a step here, make sure to adjust the next step's
   final words -->

   <li><p>If <var>maxWidth</var> was provided and the
   hypothetical width of the inline box in the hypothetical line box
   is greater than <var>maxWidth</var> CSS pixels, then
   change <var>font</var> to have a more condensed font (if
   one is available or if a reasonably readable one can be synthesized
   by applying a horizontal scale factor to the font) or a smaller
   font, and return to the previous step.</p></li>

   <li>

    <p>The <var>anchor point</var> is a point on the inline
    box, and the <var>physical alignment</var> is one of the
    values <i>left</i>, <i>right</i>, and <i title="">center</i>. These
    variables are determined by the <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> and <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> values as
    follows:</p>

    <p>Horizontal position:</p>

    <dl>

     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>left</code></dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>start</code> and <var>direction</var> is
     'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>end</code> and <var>direction</var> is
     'rtl'</dt>

     <dd>Let the <var>anchor point</var>'s horizontal
     position be the left edge of the inline box, and let <var>physical alignment</var> be <i>left</i>.</dd>


     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>right</code></dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>end</code> and <var>direction</var> is
     'ltr'</dt>

     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>start</code> and <var>direction</var> is
     'rtl'</dt>

     <dd>Let the <var>anchor point</var>'s horizontal
     position be the right edge of the inline box, and let <var>physical alignment</var> be <i>right</i>.</dd>


     <dt>If <code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code> is
     <code>center</code></dt>

     <dd>Let the <var>anchor point</var>'s horizontal
     position be halfway between the left and right edges of the
     inline box, and let <var>physical alignment</var> be
     <i title="">center</i>.</dd>

    </dl>

    <p>Vertical position:</p>

    <dl>

     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-top"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-top">top</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be the top of the em box of the first available font of the
     inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-hanging"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-hanging">hanging</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be the hanging baseline of the first available font of the inline
     box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-middle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-middle">middle</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be halfway between the bottom and the top of the em box of the
     first available font of the inline box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-alphabetic"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-alphabetic">alphabetic</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be the alphabetic baseline of the first available font of the inline
     box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-ideographic"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-ideographic">ideographic</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be the ideographic baseline of the first available font of the inline
     box.</dd>


     <dt>If <code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code> is <code title="dom-context-2d-textBaseline-bottom"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline-bottom">bottom</a></code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be the bottom of the em box of the first available font of the
     inline box.</dd>

    </dl>

   </li>

   <li>

    <p>Let <var>result</var> be an array constructed by
    iterating over each glyph in the inline box from left to right (if
    any), adding to the array, for each glyph, the shape of the glyph
    as it is in the inline box, positioned on a coordinate space using
    CSS pixels with its origin is at the <var>anchor
    point</var>.</p>

   </li>

   <li><p>Return <var>result</var>, and, for callers that
   need it, <var>physical alignment</var> as the alignment
   value.</p></li>

  </ol>


  <h2 id="building-paths"><span class="secno">5 </span>绘制路径</h2>

  <p>所有实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspathmethods">CanvasPathMethods</a></code>接口的对象都有
  一个<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>。<dfn id="concept-path" title="concept-path">path</dfn>包含了一个0或更多条子路径的列表。
  每个子路径由一个包含1或更多个被直线或曲线连接的点的列表和表明该子路径是否闭合的flag。
  一个闭合的子路径是起点和终点被直线相连接的子路径。在绘制路径时，包含少于两个点的子路径会被忽略。</p>

  <p>当实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspathmethods">CanvasPathMethods</a></code>接口的对象被创建时
  ，它的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>
  会被初始化为0个子路径。</p>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-moveTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-moveto">moveTo</a></code>(<var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>根据给定点创建新的子路径。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-closePath"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-closepath">closePath</a></code>()</dt>

   <dd>

    <p>标记当前子路径为闭合路径，并且使之闭合。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-lineTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-lineto">lineTo</a></code>(<var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>将给定的点加入当前子路径，并且与之前的点连成直线。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-quadraticCurveTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-quadraticcurveto">quadraticCurveTo</a></code>(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>将给定的点加入当前子路径，并且与之前的点通过控制点连成二次贝塞尔曲线。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-bezierCurveTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-beziercurveto">bezierCurveTo</a></code>(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>将给定的点加入当前子路径，并且与之前的点通过控制点连成三次贝塞尔曲线。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-arcTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-arcto">arcTo</a></code>(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radius</var>)</dt>

   <dd>

    <p>通过给定的控制点和半径将一段弧加入当前子路径，并与之前的点连成直线。</p>

    <p>如果给定的半径为负数则抛出<code>IndexSizeError</code>异常。</p>

    <figure class="diagrams">
     <!-- if anyone wants to try writing alternative text for this, be my guest. I can't work out how to describe it. -->
     <img alt="" src="https://www.w3.org/TR/2015/REC-2dcontext-20151119/images/arc1.png">
    </figure>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-arc"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-arc">arc</a></code>(<var>x</var>, <var>y</var>, <var>radius</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>counterclockwise</var> ] )</dt>

   <dd>

    <p>将给定的点加入子路径使得通过各种参数描述的圆弧加入到路径，这些参数有通过点描述的周长、起始角度、结束角度和方向（默认为顺时针），并与之前的点连成直线。</p>

    <p>如果给定的半径为负数则抛出<code>IndexSizeError</code>异常。</p>

<!--
c.clearRect(0, 0, 640, 480);
c.save();
try {
  var x0 = 50;
  var y0 = 200;
  var x = 255;
  var y = 150;
  var radius = 100;
  var startAngle = 2.4
  var endAngle = 0.7;
  var direction = false;

  var bottom = 280;
  var center = 50;

  var fontSize = 16;
  var margin = 50;
  var dotHalfSize = 5;
  var arrowHead = 5;

  // (also update the label positions at the bottom)

  // ========

  function dot(x,y,s) {
    c.beginPath();
    c.arc(x,y,dotHalfSize,0,Math.PI*2);
    c.fill();
    c.textAlign = 'center';
    c.textBaseline = 'top';
    c.fillText(s,x,y+dotHalfSize);
  }

  function arc(x, y, r, sA, eA, d, fr, s) {
    c.lineWidth = 1;
    c.strokeStyle = 'red';
    c.beginPath();
    c.arc(x, y, r, sA, eA, d);
    c.stroke();

    c.save();
    c.translate(x, y);
    c.rotate(eA);
    c.beginPath();
    c.moveTo(r-arrowHead, arrowHead);
    c.lineTo(r, 0);
    c.lineTo(r+arrowHead, arrowHead);
    c.stroke();

    c.strokeStyle = 'silver';
    c.beginPath();
    c.moveTo(0, 0);
    c.lineTo(fr, 0);
    c.stroke();
    c.restore();

    c.textAlign = 'right';
    c.textBaseline = 'middle';
    c.fillStyle = 'black';
    c.fillText(s + ' ',x-r,y);
  }

  function radial(x, y, length, rotation, s) {
    c.lineWidth = 1;
    c.strokeStyle = 'blue';
    c.save();
    c.translate(x, y);
    c.rotate(rotation);
    c.beginPath();
    c.moveTo(0, 0);
    c.lineTo(length, 0);
    c.stroke();
    c.textAlign = 'center';
    c.textBaseline = 'top';
    c.fillStyle = 'black';
    c.fillText(s,length/2,0);
    c.restore();
  }

  c.font = fontSize + 'px Gill Sans';

  // construction lines
  c.lineWidth = 1;
  c.strokeStyle = 'silver';
  // circle
  c.beginPath();
  c.arc(x, y, radius, 0, 2*Math.PI);
  c.stroke();
  // angles
  arc(x, y, 2*radius/3, 0, startAngle, true, radius, '\u03B1');
  arc(x, y, radius/3, 0, endAngle, true, radius, '\u03B2');
  // radii
  radial(x, y, radius, 0, 'radius');

  // the line
  c.lineWidth = 15;
  c.lineCap = 'round';
  c.strokeStyle = 'rgba(20,200,40,0.8)';
  c.beginPath();
  c.moveTo(x0,y0);
  c.arc(x,y,radius,startAngle,endAngle,direction);
  c.stroke();

  dot(x0,y0, "x\u2080,y\u2080");
  dot(x,y, "x,y");

  c.textAlign = 'left';
  c.textBaseline = 'alphabetic';
  var L = 0;

  function print(s) {
    c.fillText(s, center, bottom+L*fontSize*1.3);
    L += 1;
  }
  print('// the thick line corresponds to:');
  print('context.moveTo(x\u2080, y\u2080)');
  print('context.arc(x, y, radius, \u03B1, \u03B2)');
  print('context.stroke()');

  c.fillStyle = 'green';
  c.fillText("\u25be initial line", x0, y0-fontSize);
  c.textAlign = 'center';
  c.fillText("\u25be arc", x, y-radius-fontSize);

} finally {
  c.restore();
}
-->

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-rect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-rect">rect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</dt>

   <dd>

    <p>将代表矩形的新建闭合子路径加入路径中。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>以下方法允许作者操作实现<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspathmethods">CanvasPathMethods</a></code>接口的对象的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">paths</a>。</p>

  <p>在<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象中，通过这些方法将点和线添加到<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#current-default-path">current default path</a>内必须在添加之前根据<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current transformation
      matrix</a>转换。</p>


  <p>用<dfn id="dom-context-2d-moveto" title="dom-context-2d-moveTo"><code>moveTo(<var>x</var>, <var>y</var>)</code></dfn>方法创建子路径时必须指明它第一个（唯一的）点。</p>

  <p>当客户端在<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>中为坐标(<var>x</var>, <var>y</var>)<dfn id="ensure-there-is-a-subpath">确保有子路径</dfn>时，
  客户端会检查在<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>中是否存在任何子路径。
  如果不存在，那么客户端会创建一个点(<var>x</var>, <var>y</var>)作为第一个点的子路径，这时<code title="dom-context-2d-moveTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-moveto">moveTo()</a></code>方法会被调用。
  </p>


  <p>如果对象的路径内没有子路径，那么<dfn id="dom-context-2d-closepath" title="dom-context-2d-closePath"><code>closePath()</code></dfn>方法不会作任何操作。
  否则它会将最后一条子路径标记为闭合，并创建一条新的子路径使它的起点与之前子路径的起点重合，最后添加到路径中。
  </p>

  <p class="note">如果最后一条子路径有不止一个点，那么它相当于用直线连接首尾来闭合图形，又调用上一个<code title="dom-context-2d-moveTo"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-moveto">moveTo()</a></code>方法。
  </p>


  <p>我们用以下的方法将新的点和线添加到子路径中去。在所有情况下，这些方法只修改路径中的最后一条子路径。</p>


  <p>如果对象的路径内没有子路径，<dfn id="dom-context-2d-lineto" title="dom-context-2d-lineTo"><code>lineTo(<var>x</var>, <var>y</var>)</code></dfn>方法会为点<span>(<var>x</var>, <var>y</var>)</span>
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#ensure-there-is-a-subpath">确保有子路径</a>。否则它会用直线将最后一个点与给定的点(<var>x</var>, <var>y</var>)连接起来，并把给定的点(<var>x</var>, <var>y</var>)加入到子路径中。
  </p>


  <p><dfn id="dom-context-2d-quadraticcurveto" title="dom-context-2d-quadraticCurveTo"><code>quadraticCurveTo(<var>cpx</var>, <var>cpy</var>, <var>x</var>,
  <var>y</var>)</code></dfn>方法会为点<span>(<var>cpx</var>,
  <var>cpy</var>)</span><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#ensure-there-is-a-subpath">确保有子路径</a>，然后通过控制点(<var>cpx</var>, <var>cpy</var>)利用二次贝塞尔曲线将子路径的最后一个点和给定点(<var>x</var>, <var>y</var>)连接起来，最后将给定点加入到子路径中。
   <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsBEZIER">[BEZIER]</a></p>


  <p><dfn id="dom-context-2d-beziercurveto" title="dom-context-2d-bezierCurveTo"><code>bezierCurveTo(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)</code></dfn>方法会为点<span>(<var>cp1x</var>, <var>cp1y</var>)</span>
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#ensure-there-is-a-subpath">确保有子路径</a>，然后通过控制点(<var>cp1x</var>, <var>cp1y</var>)和(<var>cp2x</var>, <var>cp2y</var>)利用三次贝塞尔曲线将子路径的最后一个点和给定点(<var>x</var>, <var>y</var>)连接起来，最后将给定点加入到子路径中。
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsBEZIER">[BEZIER]</a></p>

  <hr>

  <p><dfn id="dom-context-2d-arcto" title="dom-context-2d-arcTo"><code>arcTo(<var>x1</var>, <var>y1</var>, <var>x2</var>,
  <var>y2</var>, <var>radius</var>)</code></dfn>方法会为点<span>(<var>x1</var>, <var>y1</var>)</span>
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#ensure-there-is-a-subpath">确保有子路径</a>。
  然后根据以下步骤绘制图形。</p>

      <p>如果<var>radius</var>值为负数则会导致接口抛出
          <code>IndexSizeError</code>异常。

  </p><p>Let the point (<var>x0</var>, <var>y0</var>) be
  the last point in the subpath.</p>

  <p>If the point (<var>x0</var>, <var>y0</var>) is
  equal to the point (<var>x1</var>, <var>y1</var>),
  or if the point (<var>x1</var>, <var>y1</var>) is
  equal to the point (<var>x2</var>, <var>y2</var>),
  or if the radius <var>radius</var> is zero, then the method
  must add the point (<var>x1</var>, <var>y1</var>)
  to the subpath, and connect that point to the previous point (<var>x0</var>, <var>y0</var>) by a straight line.</p>

  <p>Otherwise, if the points (<var>x0</var>, <var>y0</var>), (<var>x1</var>, <var>y1</var>), and (<var>x2</var>, <var>y2</var>) all lie on a single straight line, then the
  method must add the point (<var>x1</var>, <var>y1</var>) to the subpath, and connect that point to the
  previous point (<var>x0</var>, <var>y0</var>) by a
  straight line.</p>

  <p>Otherwise, let <var>The Arc</var> be the shortest arc
  given by circumference of the circle that has radius <var>radius</var>, and that has one point tangent to the half-infinite
  line that crosses the point (<var>x0</var>, <var>y0</var>) and ends at the point (<var>x1</var>,
  <var>y1</var>), and that has a different point tangent to
  the half-infinite line that ends at the point (<var>x1</var>, <var>y1</var>), and crosses the point
  (<var>x2</var>, <var>y2</var>). The points at
  which this circle touches these two lines are called the start and
  end tangent points respectively. The method must connect the point
  (<var>x0</var>, <var>y0</var>) to the start
  tangent point by a straight line, adding the start tangent point to
  the subpath, and then must connect the start tangent point to the
  end tangent point by <var>The Arc</var>, adding the end
  tangent point to the subpath.</p>

  <hr>

  <p><dfn id="dom-context-2d-arc" title="dom-context-2d-arc"><code>arc(<var>x</var>, <var>y</var>, <var>radius</var>,
  <var>startAngle</var>, <var>endAngle</var>, <var>counterclockwise</var>)</code></dfn>方法绘制一个弧。</p>

  <p>如果在context中有任何子路径，那么这个方法会将子路径的最后一个点和弧用直线连接起来。
  在任何情况下，它会在起点和终点之间画一条弧，并将它们加入到子路径中去。弧和它的起点与终点如以下定义：</p>

  <p>Consider a circle that has its origin at (<var>x</var>, <var>y</var>),
  and that has radius <var>radius</var>.
  The points at <var>startAngle</var> and <var>endAngle</var> this circle's circumference, measured
  in radians clockwise from the positive x-axis, are the start and end points respectively.</p>

  <p>If the <var>counterclockwise</var> argument false and <span><var>endAngle</var>-<var>startAngle</var></span> is equal to or greater than <span>2π</span>, or if the <var>counterclockwise</var>
  argument is <em>true</em> and <span><var>startAngle</var>-<var>endAngle</var></span> is
  equal to or greater than <span>2π</span>, then the arc
  is the whole circumference of this circle.</p>

  <p>Otherwise, the arc is the path along the circumference of this
  circle from the start point to the end point, going anti-clockwise
  if the <var>counterclockwise</var> argument is true, and
  clockwise otherwise. Since the points are on the circle, as opposed
  to being simply angles from zero, the arc can never cover an angle
  greater than <span>2π</span> radians. If the two points are the
  same, or if the radius is zero, then the arc is defined as being of
  zero length in both directions.</p>

  <p>如果<var>radius</var>值为负数则会导致接口抛出
  <code>IndexSizeError</code>异常。</p>

  <hr>



  <p><dfn id="dom-context-2d-rect" title="dom-context-2d-rect"><code>rect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn>方法新建一个被标记为闭合的子路径。
  该子路径包含四个点(<var>x</var>，<var>y</var>)，(<var>x</var>+<var>w</var>，<var>y</var>)，(<var>x</var>+<var>w</var>，<var>y</var>+<var>h</var>)，(<var>x</var>，<var>y</var>+<var>h</var>)且这四个点分别用直线连接。
  然后它会创建一个只有一个点(<var>x</var>, <var>y</var>)的子路径。</p>


  <!-- v6 feature request:
        * points as a primitive shape
          http://home.comcast.net/~urbanjost/canvas/vogle4.html
  -->

  </div>


  <h2 id="transformations"><span class="secno">6 </span><dfn title="dom-context-2d-transformation">变换</dfn></h2>

  <p>每个<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象都有一个
  <i>current transformation matrix</i>和相应的操作它的方法（本节讲述）。
  当<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象被创建后，它的变换矩阵会被初始化为恒等变换矩阵。</p>

  <p>当创建路径，在<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象内绘制文本、图形和路径时，变换矩阵会被应用到坐标系中。</p> <!-- conformance
  criteria for actual drawing are described in the various sections
  below -->

  <p class="note">大部分API都使用<code>SVGMatrix</code>而不是本API。本API因为历史原因被保留。</p>

  <div class="impl">

  <p>这部分变换必须被逆序执行。</p>

  <p class="note">例如，如果有一个放大2倍宽度的变换需要被应用到canvas中，然后又要执行旋转90度的旋转变换，并且这是一个高是宽2倍的矩形，那么执行结果是一个正方形。
  </p> <!-- q.v.
  http://goo.gl/5RLrN -->

  </div>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-scale"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-scale">scale</a></code>(<var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>改变变换矩阵，并根据给定的参数进行缩放变换。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-rotate"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-rotate">rotate</a></code>(<var>angle</var>)</dt>

   <dd>

    <p>改变变换矩阵，并根据给定的参数进行旋转变换。角度以弧度制表示。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-translate"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-translate">translate</a></code>(<var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>改变变换矩阵，并根据给定的参数进行平移变换。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-transform"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-transform">transform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</dt>

   <dd>

    <p>改变变换矩阵，并根据给定的参数进行后文描述的变换。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-setTransform"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-settransform">setTransform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</dt>

   <dd>

    <p>将变换矩阵变<em>为</em>给定的矩阵，参数后文描述。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><dfn id="dom-context-2d-scale" title="dom-context-2d-scale"><code>scale(<var>x</var>, <var>y</var>)</code></dfn>方法会新增缩放变换到矩阵中。
  <var>x</var>代表水平方向的缩放系数，<var>y</var>代表垂直方向的缩放系数。</p>

  <p><dfn id="dom-context-2d-rotate" title="dom-context-2d-rotate"><code>rotate(<var>angle</var>)</code></dfn>方法会新增旋转变换到矩阵中。
  <var>angle</var>代表顺时针方向旋转的弧度制表示的角度。</p>

  <p><dfn id="dom-context-2d-translate" title="dom-context-2d-translate"><code>translate(<var>x</var>, <var>y</var>)</code></dfn>方法会新增缩放变换到矩阵中。
  <var>x</var>代表水平方向的平移距离<var>y</var>代表垂直方向的平移距离。它们都是用坐标空间单位表示的。</p>

  <p><dfn id="dom-context-2d-transform" title="dom-context-2d-transform"><code>transform(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</code></dfn>方法会将以下矩阵与当前变换矩阵的乘积作为当前的变换矩阵：
  </p>

  </div>

  <table class="matrix">
   <tbody><tr>
    <td><var>a</var></td>
    <td><var>c</var></td>
    <td><var>e</var></td>
   </tr>
   <tr>
    <td><var>b</var></td>
    <td><var>d</var></td>
    <td><var>f</var></td>
   </tr>
   <tr>
    <td>0</td>
    <td>0</td>
    <td>1</td>
   </tr>
  </tbody></table>

  <p class="note">变量<var>a</var>，<var>b</var>，<var>c</var>，<var>d</var>，<var>e</var>和<var>f</var>有时被叫做
  <var>m11</var>，<var>m12</var>，<var>m21</var>，<var>m22</var>，<var>dx</var>和<var>dy</var>或<var>m11</var>，<var>m21</var>，<var>m12</var>，<var>m22</var>，<var>dx</var>和<var>dy</var>。
  在处理第二个和第三个变量(<var>b</var>和<var>c</var>)时要格外小心，因为它们和其它API的变量顺序不一样，有的会用<var>m12</var>/<var>m21</var>表示，而有的用<var>m21</var>/<var>m12</var>表示。
  </p>

  <div class="impl">

  <p><dfn id="dom-context-2d-settransform" title="dom-context-2d-setTransform"><code>setTransform(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>,
  <var>f</var>)</code></dfn>会重置当前变换矩阵为恒等变换矩阵，并且以相同的参数调用<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-transform" title="dom-context-2d-transform">transform</a>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>,
  <var>f</var>)</code>方法。</p>

  </div>

  <h2 id="image-sources-for-2d-rendering-contexts"><span class="secno">7 </span>2D渲染环境的图像源</h2>

<p>这个集合允许任何实现以下接口的对象被用作图像源：</p>

  <ul><li><code id="image-sources-for-2d-rendering-contexts:htmlimageelement"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code> (<code id="image-sources-for-2d-rendering-contexts:the-img-element"><a href="http://www.w3.org/TR/html/embedded-content-0.html#the-img-element">img</a></code> elements)</li><li><code id="image-sources-for-2d-rendering-contexts:htmlvideoelement"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlvideoelement">HTMLVideoElement</a></code> (<code id="image-sources-for-2d-rendering-contexts:the-video-element"><a href="http://www.w3.org/TR/html/embedded-content-0.html#the-video-element">video</a></code> elements)</li><li><code id="image-sources-for-2d-rendering-contexts:htmlcanvaselement"><a href="http://www.w3.org/TR/html5/scripting-1.html#htmlcanvaselement">HTMLCanvasElement</a></code> (<code id="image-sources-for-2d-rendering-contexts:the-canvas-element"><a href="http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element">canvas</a></code> elements)</li></ul>

  <p>当客户端被用来<dfn id="check-the-usability-of-the-image-argument">检查<var>image</var>
  参数可用性</dfn>，其中<var>image</var>是<code id="image-sources-for-2d-rendering-contexts:canvasimagesource-2"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a></code>对象，客户端会按照以下步骤运行，其返回结果为
  <i>good</i>，<i>bad</i>或
  <i>aborted</i>：</p>

  <ol><li><p>If the <var>image</var> argument is an <code id="image-sources-for-2d-rendering-contexts:htmlimageelement-2"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code> object that
   is in the <a href="http://www.w3.org/TR/html/embedded-content-0.html#img-error" id="image-sources-for-2d-rendering-contexts:img-error">broken</a> state, then throw an
   <code id="image-sources-for-2d-rendering-contexts:invalidstateerror"><a href="http://www.w3.org/TR/WebIDL-1/#invalidstateerror">InvalidStateError</a></code> exception, return <i>aborted</i>, and abort these steps.</p>

  </li><li><p>If the <var>image</var> argument is an <code id="image-sources-for-2d-rendering-contexts:htmlimageelement-3"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code> object that
      is not <a href="http://www.w3.org/TR/html/embedded-content-0.html#img-good" id="image-sources-for-2d-rendering-contexts:img-good">fully decodable</a>, or if the <var>image</var>
      argument is an <code id="image-sources-for-2d-rendering-contexts:htmlvideoelement-2"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlvideoelement">HTMLVideoElement</a></code> object whose <code id="image-sources-for-2d-rendering-contexts:dom-media-readystate"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-readystate">readyState</a></code> attribute is either <code id="image-sources-for-2d-rendering-contexts:dom-media-have_nothing"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-have_nothing">HAVE_NOTHING</a></code> or <code id="image-sources-for-2d-rendering-contexts:dom-media-have_metadata"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-have_metadata">HAVE_METADATA</a></code>, then return <i>bad</i> and abort these
      steps.</p></li><li><p>If the <var>image</var> argument is an <code id="image-sources-for-2d-rendering-contexts:htmlimageelement-4"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code> object with
      an intrinsic width or intrinsic height (or both) equal to zero, then return <i>bad</i> and abort
      these steps.</p>
   <!--</li><li><p>如果<var>image</var>参数是一个<code id="image-sources-for-2d-rendering-contexts:htmlimageelement-3"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code>对象，且该对象不是-->
   <!--<a href="http://www.w3.org/TR/html/embedded-content-0.html#img-good" id="image-sources-for-2d-rendering-contexts:img-good">fully decodable</a>，或者如果<var>image</var>-->
   <!--参数是一个<code id="image-sources-for-2d-rendering-contexts:htmlvideoelement-2"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlvideoelement">HTMLVideoElement</a></code>对象，且其<code id="image-sources-for-2d-rendering-contexts:dom-media-readystate"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-readystate">readyState</a></code>属性是<code id="image-sources-for-2d-rendering-contexts:dom-media-have_nothing"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-have_nothing">HAVE_NOTHING</a></code>或<code id="image-sources-for-2d-rendering-contexts:dom-media-have_metadata"><a href="http://www.w3.org/TR/html/embedded-content-0.html#dom-media-have_metadata">HAVE_METADATA</a></code>，那么返回<i>bad</i>并丢弃-->
   <!--steps.</p></li><li><p>If the <var>image</var> argument is an <code id="image-sources-for-2d-rendering-contexts:htmlimageelement-4"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code> object with-->
   <!--an intrinsic width or intrinsic height (or both) equal to zero, then return <i>bad</i> and abort-->
   <!--these steps.</p>-->

   </li><li><p>If the <var>image</var> argument is an <code id="image-sources-for-2d-rendering-contexts:htmlcanvaselement-2"><a href="http://www.w3.org/TR/html5/scripting-1.html#htmlcanvaselement">HTMLCanvasElement</a></code> object with
   either a horizontal dimension or a vertical dimension equal to zero, then return <i>bad</i> and
   abort these steps.</p>

   </li><li><p>Return <i>good</i>.</p></li></ol>

  <p>当<code id="image-sources-for-2d-rendering-contexts:canvasimagesource-3"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a></code>对象表示<code id="image-sources-for-2d-rendering-contexts:htmlimageelement-5"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code>，
  元素的图片会被用作图像源。</p>

  <p>特定的，当<code id="image-sources-for-2d-rendering-contexts:canvasimagesource-4"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a></code>代表一个<code id="image-sources-for-2d-rendering-contexts:htmlimageelement-6"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code>内的动态图时，
  客户端会使用默认的动态图（即当动画不支持或失效的图）或者如果没有图片，客户端会使用<code id="image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-3"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>API渲染的动画的第一帧
  。</p>

  <p>当<code id="image-sources-for-2d-rendering-contexts:canvasimagesource-5"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a></code>对象代表<code id="image-sources-for-2d-rendering-contexts:htmlvideoelement-3"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlvideoelement">HTMLVideoElement</a></code>
  那么当方法被调用时的<a id="image-sources-for-2d-rendering-contexts:current-playback-position" href="http://www.w3.org/TR/html/embedded-content-0.html#current-playback-position">current playback position</a>的那一帧会被用来<code id="image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-4"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>API渲染图片的图像源，
   其图像源的维度是<a id="image-sources-for-2d-rendering-contexts:media-resource" href="http://www.w3.org/TR/html/embedded-content-0.html#media-resource">media resource</a>的<a href="http://www.w3.org/TR/html/embedded-content-0.html#concept-video-intrinsic-width" id="image-sources-for-2d-rendering-contexts:concept-video-intrinsic-width">intrinsic width</a>和<a href="http://www.w3.org/TR/html/embedded-content-0.html#concept-video-intrinsic-height" id="image-sources-for-2d-rendering-contexts:concept-video-intrinsic-height">intrinsic height</a>
  。</p>

  <p>当<code id="image-sources-for-2d-rendering-contexts:canvasimagesource-6"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasimagesource">CanvasImageSource</a></code>对象代表<code id="image-sources-for-2d-rendering-contexts:htmlcanvaselement-3"><a href="http://www.w3.org/TR/html5/scripting-1.html#htmlcanvaselement">HTMLCanvasElement</a></code>
  ，元素的位图会被用作图像源。</p>

  <p>如果<var>image argument</var>是
  <code id="image-sources-for-2d-rendering-contexts:htmlimageelement-7"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlimageelement">HTMLImageElement</a></code>或<code id="image-sources-for-2d-rendering-contexts:htmlvideoelement-4"><a href="http://www.w3.org/TR/html/embedded-content-0.html#htmlvideoelement">HTMLVideoElement</a></code>，且其<a id="image-sources-for-2d-rendering-contexts:origin-2" href="http://www.w3.org/TR/html/browsers.html#origin-0">origin</a>不是
  与<a id="image-sources-for-2d-rendering-contexts:origin-2-2" href="http://www.w3.org/TR/html/browsers.html#origin-0">origin</a>由<a id="image-sources-for-2d-rendering-contexts:entry-settings-object" href="http://www.w3.org/TR/html/webappapis.html#entry-settings-object">entry
          settings object</a>规定的<a href="http://www.w3.org/TR/html/browsers.html#same-origin" id="image-sources-for-2d-rendering-contexts:same-origin">一样</a>或者它是<a href="http://www.w3.org/TR/html/scripting-1.html#concept-canvas-origin-clean" id="image-sources-for-2d-rendering-contexts:concept-canvas-origin-clean">origin-clean</a>的位图flag为假的<code id="image-sources-for-2d-rendering-contexts:htmlcanvaselement-4"><a href="http://www.w3.org/TR/html5/scripting-1.html#htmlcanvaselement">HTMLCanvasElement</a></code>，或者它是位图的<a href="http://www.w3.org/TR/html/scripting-1.html#concept-canvas-origin-clean" id="image-sources-for-2d-rendering-contexts:concept-canvas-origin-clean-2">origin-clean</a>flag为假的<code id="image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-7"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象，
  <dfn id="the-image-argument-is-not-origin-clean">那么它不是origin-clean的</dfn>。
  </p>

  <h2 id="fill-and-stroke-styles"><span class="secno">8 </span>填充和描边样式</h2>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前填充图形的样式。</p>

    <p>可以用来设置填充样式。</p>

    <p>样式可以是一个CSS颜色的字符串，也可以是<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>或<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象。
     非法值会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前描边图形样式。</p>

    <p>可以用来设置描边样式。</p>

    <p>样式可以是一个CSS颜色的字符串，也可以是<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>或<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象。
     非法值会被忽略。</p>

   </dd>

  </dl>

  <div class="impl">

  <!-- v6 feature requests:

   * Getting and setting colours by component to bypass the CSS value parsing.

     Either:
        context.fillStyle.red += 1;

     Or:
        var array = context.fillStyle;
        array[1] += 1;
        context.fillStyle = array;

   * A more performant way of setting colours in general, e.g.:

       context.setFillColor(r,g,b,a) // already supported by webkit

     Or:

       context.fillStyle = 0xRRGGBBAA; // set a 32bit int directly

   * fill rule for deciding between winding and even-odd algorithms.
     SVG has fill-rule: nonzero | evenodd
       http://www.w3.org/TR/SVG/painting.html#FillProperties
     see also mozFillRule: http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-June/032002.html

  -->

  <p><dfn id="dom-context-2d-fillstyle" title="dom-context-2d-fillStyle"><code>fillStyle</code></dfn>
  属性代表图形内的颜色或样式，<dfn id="dom-context-2d-strokestyle" title="dom-context-2d-strokeStyle"><code>strokeStyle</code></dfn>
  属性代表图形边的颜色或样式。</p>

  <p>两属性可以是字符串，
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>或<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>
  设置时字符串会<span title="parsed as a CSS &lt;color&gt;
  value">parsed as CSS &lt;color&gt; values</span>并指定颜色。<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>和
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象会被相应设置。<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSCOLOR">[CSSCOLOR]</a>如果值是字符串但不能
  <span>parsed as a CSS &lt;color&gt; value</span>或者不是
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>和
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象，那么它会被忽略并且属性保留之前的值。
  如果新值是<code id="fill-and-stroke-styles:canvaspattern-5"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象并且被标记为<a style="" href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-canvas-pattern-not-origin-clean" id="fill-and-stroke-styles:concept-canvas-pattern-not-origin-clean">not origin-clean</a>，那么位图的<a href="http://www.w3.org/TR/html/scripting-1.html#concept-canvas-origin-clean" id="fill-and-stroke-styles:concept-canvas-origin-clean">origin-clean</a>flag会被设置为假。
  </p>

  <p>当被设置为<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>或
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>对象时，此时操作是
  <span>live</span>的，意思是对该对象的更改会影响后续的描边或填充图形。</p>

  <p>获取时，如果值是颜色的话，那么<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#serialization-of-a-color" title="serialization of a color">serialization of the color</a>
  会被返回。否则如果它不是颜色而是
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>或<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>，那么相应的对象会被返回。
  （这些对象是透明的，因此只被用来设置其他属性或与之比较）</p>

  <p>颜色值的<dfn id="serialization-of-a-color">serialization of a color</dfn>是一个字符串，且通过以下方法计算得出：if it has alpha equal to 1.0, then the
  string is a lowercase six-digit hex value, prefixed with a "#"
  character (U+0023 NUMBER SIGN), with the first two digits
  representing the red component, the next two digits representing the
  green component, and the last two digits representing the blue
  component, the digits being in the range 0-9 a-f (U+0030 to U+0039
  and U+0061 to U+0066). Otherwise, the color value has alpha less
  than 1.0, and the string is the color value in the CSS <code>rgba()</code> functional-notation format: the literal
  string <code>rgba</code> (U+0072 U+0067 U+0062 U+0061)
  followed by a U+0028 LEFT PARENTHESIS, a base-ten integer in the
  range 0-255 representing the red component (using digits 0-9, U+0030
  to U+0039, in the shortest form possible), a literal U+002C COMMA
  and U+0020 SPACE, an integer for the green component, a comma and a
  space, an integer for the blue component, another comma and space, a
  U+0030 DIGIT ZERO, if the alpha value is greater than zero then a
  U+002E FULL STOP (representing the decimal point), if the alpha
  value is greater than zero then one or more digits in the range 0-9
  (U+0030 to U+0039) representing the fractional part of the alpha<!--
  value with no trailing zeros (implied by next sentence)-->, and
  finally a U+0029 RIGHT PARENTHESIS. User agents must express the
  fractional part of the alpha value, if any, with the level of
  precision necessary for the alpha value, when reparsed, to be
  interpreted as the same alpha value.</p> <!-- if people complain
  this is unreadable, expand it into a <dl> with two nested <ol>s -->

  <p>当context被创建后，<code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code>和<code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code>属性
  会被初始化为<code>#000000</code>。</p>

  <p>当值为颜色时，渲染时它不会被变换矩阵影响。</p> <!-- so
  singular matrices don't affect solid color fillStyles -->

  </div>

  <hr>

  <p>有两种渐变方式，线性渐变和辐射渐变。两者都可以用实现透明<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>接口的对象表示。
   </p>

  <p id="interpolation">一旦渐变被创建，节点就会沿着颜色变化方向被放置来表示颜色的分配情况。<span class="impl">每个节点里的渐变色是指明当前节点的颜色。
  而在节点之间，颜色和alpha值会被线性的插入RGBA颜色空间中，并且不会经过提前处理找到相应的偏移位置。
  第一个节点之前的颜色都是第一个节点的颜色，而最后一个节点之后的颜色都是最后一个节点的颜色。如果没有节点，那么渐变是透明的黑色。</span></p>

  <dl class="domintro">

   <dt><var>gradient</var> . <code title="dom-canvasgradient-addColorStop"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-canvasgradient-addcolorstop">addColorStop</a></code>(<var>offset</var>, <var>color</var>)</dt>

   <dd>

    <p>添加指定颜色节点到指定的渐变的偏移量中。0.0是渐变的偏移量的一端，1.0是另一端。 </p>

    <p>如果偏移量超出范围则抛出<code>IndexSizeError</code>异常。如果颜色不能被解析则抛出<code>SyntaxError</code>异常。</p>

   </dd>

   <dt><var>gradient</var> = <var>context</var> . <code title="dom-context-2d-createLinearGradient"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createlineargradient">createLinearGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>x1</var>, <var>y1</var>)</dt>

   <dd>

    <p>返回代表延直线绘制的线性渐变的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>对象。</p>

   </dd>

   <dt><var>gradient</var> = <var>context</var> . <code title="dom-context-2d-createRadialGradient"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createradialgradient">createRadialGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>r0</var>, <var>x1</var>, <var>y1</var>, <var>r1</var>)</dt>

   <dd>

    <p>返回代表延直线绘制的辐射渐变的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>对象。
    </p>

    <p>如果弧度都是负数则<a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a>
    <code>IndexSizeError</code>异常。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>在<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>接口上的<dfn id="dom-canvasgradient-addcolorstop" title="dom-canvasgradient-addColorStop"><code>addColorStop(<var>offset</var>, <var>color</var>)</code></dfn>方法可以为渐变添加节点。
  。如果<var>offset</var>小于0或大于1，那么<code>IndexSizeError</code>异常会被抛出。
  如果<var>color</var>不能被<span>parsed as a
  CSS &lt;color&gt; value</span> ，那么<code>SyntaxError</code>异常会被抛出。
  否则，渐变会有一个新的节点在相对于整个渐变的<var>offset</var>处，且其颜色为<var>color</var>。如果在偏移处有多个节点，那么它会按顺序被添加。第一个最靠近开头，其余依此往后添加直到结尾点。</p>

  <p><dfn id="dom-context-2d-createlineargradient" title="dom-context-2d-createLinearGradient"><code>createLinearGradient(<var>x0</var>, <var>y0</var>, <var>x1</var>,
      <var>y1</var>)</code></dfn>方法有四个参数，分别代表渐变的起点(<var>x0</var>, <var>y0</var>)和终点(<var>x1</var>, <var>y1</var>)。该方法会返回一个经过特殊直线初始化的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>。
   </p>

  <p>Linear gradients must be rendered such that all points on a line
  perpendicular to the line that crosses the start and end points have
  the color at the point where those two lines cross (with the colors
  coming from the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#interpolation">interpolation and
  extrapolation</a> described above). The points in the linear
  gradient must be transformed as described by the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current transformation
  matrix</a> when rendering.</p>

  <p>If <span><var>x0</var>&nbsp;=&nbsp;<var>x1</var></span> and <span><var>y0</var>&nbsp;=&nbsp;<var>y1</var></span>, then
  the linear gradient must paint nothing.</p>

  <p><dfn id="dom-context-2d-createradialgradient" title="dom-context-2d-createRadialGradient"><code>createRadialGradient(<var>x0</var>, <var>y0</var>, <var>r0</var>,
      <var>x1</var>, <var>y1</var>, <var>r1</var>)</code></dfn>方法有六个参数，前三个参数代表起始圆的圆点(<var>x0</var>, <var>y0</var>)和半径<var>r0</var>，后三个参数代表结尾圆的圆点(<var>x1</var>, <var>y1</var>)和半径<var>r1</var>。
  所有值都是坐标空间单位的。如果<var>r0</var>或者<var>r1</var>是负数，那么会抛出<code>IndexSizeError</code>异常。否则该方法返回一个经过两个特定的圆初始化的辐射<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasgradient">CanvasGradient</a></code>。
  </p>

  <p>辐射渐变会通过以下步骤渲染：</p>

  <ol>

   <li><p>If <span><var>x<sub>0</sub></var>&nbsp;=&nbsp;<var>x<sub>1</sub></var></span> and <span><var>y<sub>0</sub></var>&nbsp;=&nbsp;<var>y<sub>1</sub></var></span> and <span><var>r<sub>0</sub></var>&nbsp;=&nbsp;<var>r<sub>1</sub></var></span>, then the radial gradient must
   paint nothing. Abort these steps.</p></li>

   <li>

    <p>Let <span>x(<var>ω</var>)&nbsp;=&nbsp;(<var>x<sub>1</sub></var>-<var>x<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>x<sub>0</sub></var></span></p>

    <p>Let <span>y(<var>ω</var>)&nbsp;=&nbsp;(<var>y<sub>1</sub></var>-<var>y<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>y<sub>0</sub></var></span></p>

    <p>Let <span>r(<var>ω</var>)&nbsp;=&nbsp;(<var>r<sub>1</sub></var>-<var>r<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>r<sub>0</sub></var></span></p>

    <p>Let the color at <var>ω</var> be the color at
    that position on the gradient (with the colors coming from the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#interpolation">interpolation and extrapolation</a>
    described above).</p>

   </li>

   <li><p>For all values of <var>ω</var> where <span>r(<var>ω</var>)&nbsp;&gt;&nbsp;0</span>,
   starting with the value of <var>ω</var> nearest to
   positive infinity and ending with the value of <var>ω</var> nearest to negative infinity, draw the
   circumference of the circle with radius <span>r(<var>ω</var>)</span> at position (<span>x(<var>ω</var>)</span>, <span>y(<var>ω</var>)</span>), with the color at <var>ω</var>, but only painting on the parts of the
   canvas that have not yet been painted on by earlier circles in this
   step for this rendering of the gradient.</p></li>

  </ol>

  <p class="note">This effectively creates a cone, touched by the two
  circles defined in the creation of the gradient, with the part of
  the cone before the start circle (0.0) using the color of the first
  offset, the part of the cone after the end circle (1.0) using the
  color of the last offset, and areas outside the cone untouched by
  the gradient (transparent black).</p>

  <p>The resulting radial gradient must then be transformed as
  described by the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current
  transformation matrix</a> when rendering.</p>

  <p>Gradients must be painted only where the relevant stroking or
  filling effects requires that they be drawn.</p>

  </div>

  <hr>

  <p>Patterns are represented by objects implementing the opaque
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code> interface.</p>

  <dl class="domintro">

   <dt><var>pattern</var> = <var>context</var> . <code title="dom-context-2d-createPattern"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createpattern">createPattern</a></code>(<var>image</var>, <var>repetition</var>)</dt>

   <dd>

    <p>返回<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code>对象，且其通过给定的<var>repetition</var>参数和图像重复绘制图像。
    </p>

    <p><var>repetition</var>可允许的值有"<code>repeat</code>"（两方向）、"<code>repeat-x</code>"（水平方向）、"<code>repeat-y</code>"（垂直方向）和"<code>no-repeat</code>"（没有方向）。如果<var>repetition</var>参数为空那么使用<code>repeat</code>作为默认值。</p>

    <p>如果图像没有数据，则<a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a>
    <code>InvalidStateError</code>异常。如果第二个参数不是合法参数之一，则
    <a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a><code>SyntaxError</code>异常。如果图像没有完全解码，则返回null。
    </p>

   </dd>

  </dl>

  <div class="impl">

  <p>如果创建该类型对象，我们会调用<dfn id="dom-context-2d-createpattern" title="dom-context-2d-createPattern"><code>createPattern(<var>image</var>, <var>repetition</var>)</code></dfn>方法。此时，客户端会进行以下步骤：
  </p>

  <ol>
  <li>Let <var>image</var> be the first argument and <var>repetition</var> be the second argument.</li>
  <li><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#check-the-usability-of-the-image-argument">Check the usability of the image argument</a>. If this returns <var>aborted</var>, then an exception has been thrown and the method doesn't return anything; abort these steps. If it returns <var>bad</var>, then return null and abort these steps. Otherwise it returns <var>good</var>; continue with these steps.</li>
  <li>If <var>repetition</var> is the empty string, let it be "<code>repeat</code>".</li>
  <li>If <var>repetition</var> is not a case-sensitive match for one of "<code>repeat</code>", "<code>repeat-x</code>", "<code>repeat-y</code>", or "<code>no-repeat</code>", throw a <var>SyntaxError</var> exception and abort these steps.</li>
  <li>Create a new <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code> object with the image <var>image</var> and the repetition behavior given by <var>repetition</var>.</li>
  <li>If <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-image-argument-is-not-origin-clean">the image argument is not origin-clean</a>, then mark the <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code> object as <dfn id="concept-canvas-pattern-not-origin-clean"><i>not origin-clean</i></dfn>.</li>
  <li>Return the <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvaspattern">CanvasPattern</a></code> object.</li>
  </ol>
  <p>
  Modifying this <var>image</var> after calling the <code title="dom-context-2d-createPattern"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createpattern">createPattern()</a></code> method
  must not affect the pattern. </p>

  <p>Patterns must be painted so that the top left of the first image
  is anchored at the origin of the coordinate space, and images are
  then repeated horizontally to the left and right, if the
  <code>repeat-x</code> string was specified, or vertically up and
  down, if the <code>repeat-y</code> string was specified, or in all
  four directions all over the canvas, if the <code>repeat</code>
  string was specified, to create the repeated pattern that is used
  for rendering. The images are not scaled by this process; one CSS
  pixel of the image must be painted on one coordinate space unit in
  generating the repeated pattern. When rendered, however, patterns
  must actually be painted only where the stroking or filling effect
  requires that they be drawn, and the repeated pattern must be
  affected by the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current
  transformation matrix</a>. Pixels not covered by the repeating
  pattern (if the <code>repeat</code> string was not specified) must
  be transparent black.</p>

  <p>If the original image data is a bitmap image, the value painted
  at a point in the area of the repetitions is computed by filtering
  the original image data. The user agent may use any filtering
  algorithm (for example bilinear interpolation or nearest-neighbor).
  When the filtering algorithm requires a pixel value from outside the
  original image data, it must instead use the value from wrapping the
  pixel's coordinates to the original image's dimensions. (That is,
  the filter uses 'repeat' behavior, regardless of the value of
  <var>repetition</var>.)
  <!-- drawImage() has a similar paragraph with different rules -->

  </p>

  <!--
   Requests for v5 features:
    * apply transforms to patterns, so you don't have to create
      transformed patterns manually by rendering them to an off-screen
      canvas then using that canvas as the pattern.
  -->

  </div>

  <div class="impl">

  <hr>

  <p>If a radial gradient or repeated pattern is used when the
  transformation matrix is singular, the resulting style must be
  transparent black (otherwise the gradient or pattern would be
  collapsed to a point or line, leaving the other pixels undefined).
  Linear gradients and solid colors always define all points even with
  singular transformation matrices.</p>

  </div>




  <h2 id="drawing-rectangles-to-the-canvas"><span class="secno">9 </span>在canvas上绘制矩形</h2>

  <p>在位图上画矩形有三种方法。每个方法有四个参数；前两个分别是<var>x</var>坐标和<var>y</var>坐标，后两个分别是矩形的宽<var>w</var>和高<var>h</var>。</p>

  <div class="impl">

  <p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current
  transformation matrix</a>会被用在以下四个坐标，其可以指明一个闭合的矩形：<span>(<var>x</var>, <var>y</var>)</span>, <span>(<span><var>x</var>+<var>w</var></span>, <var>y</var>)</span>，
  <span>(<span><var>x</var>+<var>w</var></span>，
  <span><var>y</var>+<var>h</var></span>)</span>，
  <span>(<var>x</var>, <span><var>y</var>+<var>h</var></span>)</span>。</p>

  <p>绘制图形不会影响<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#current-default-path">current default
  path</a>，但会受<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping
  region">clipping region</a>影响，包括<code title="dom-context-2d-clearRect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearrect">clearRect()</a></code>，<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow effects</a>，<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>和<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
  operators</a>。</p>

  </div>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-clearRect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearrect">clearRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</dt>

   <dd>

    <p>清除给定区域内的所有像素。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-fillRect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillrect">fillRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</dt>

   <dd>

    <p>用当前填充样式在canvas上绘制矩形。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-strokeRect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokerect">strokeRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</dt>

   <dd>

    <p>用当前描边样式在canvas上绘制矩形。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><dfn id="dom-context-2d-clearrect" title="dom-context-2d-clearRect"><code>clearRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn>方法会进行以下步骤：</p>

  <ol>

   <li><p>Let <var>pixels</var> be the set of pixels in
   the specified rectangle that also intersect the current clipping
   region.</p></li>

   <li><p>Clear the pixels in <var>pixels</var> to fully
   transparent black, erasing any previous image.</p></li>

   <li><p><span>Clear regions that cover the pixels</span> in <var>pixels</var> in the <code>canvas</code> element.</p></li>

  </ol>

  <p class="note">如果高或宽是0，那么该方法不会产生影响，因为像素集是空的。</p>

  <p><dfn id="dom-context-2d-fillrect" title="dom-context-2d-fillRect"><code>fillRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn>方法会使用<code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code>绘制给定的矩形。
  </p>

  <p><dfn id="dom-context-2d-strokerect" title="dom-context-2d-strokeRect"><code>strokeRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn>方法根据<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#trace-a-path" title="trace a path">tracing the path</a>使用<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象的线条样式和<code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code>填充它。
  </p>

  <p>如果<var>w</var>和<var>h</var>都为0，那么该路径包含了一个点(<var>x</var>, <var>y</var>)的子路径，该方法也不会产生影响。</p>

  <p>如果<var>w</var>和<var>h</var>其中一个为0，那么该路径包含了两个点(<span><var>x</var></span>, <span><var>y</var></span>)和(<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>+<var>h</var>)的子路径，这样两个点会连成一个线段。
  </p>

  <p>否则，该路径就包含了四个点(<span><var>x</var></span>, <span><var>y</var></span>)，(<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>)，(<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>+<var>h</var>)和(<span><var>x</var></span>, <span><var>y</var>+<var>h</var></span>)的子路径，这样会根据顺序互相连接形成矩形。</p>

  </div>



  <h2 id="drawing-text-to-the-canvas"><span class="secno">10 </span>在canvas上绘制文本</h2>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-fillText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-filltext">fillText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )</dt>
   <dt><var>context</var> . <code title="dom-context-2d-strokeText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroketext">strokeText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )</dt>

   <dd>

    <p>在给定的坐标对文本填充和描边。如果提供了最大宽度，那么文本就会缩放到相应的长度。</p>

   </dd>

   <dt><var>metrics</var> = <var>context</var> . <code title="dom-context-2d-measureText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext">measureText</a></code>(<var>text</var>)</dt>

   <dd>

    <p>返回包含在给定字体下文本的metric的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#textmetrics">TextMetrics</a></code>对象。</p>

   </dd>

   <dt><var>metrics</var> . <code title="dom-textmetrics-width"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-textmetrics-width-0">width</a></code></dt>

   <dd>

    <p>返回传给<code title="dom-context-2d-measureText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext">measureText()</a></code>方法的文本的超前宽度。
    </p>

   </dd>

  </dl>

  <div class="impl">

  <p><code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>接口提供了以下方法在canvas上直接渲染文本。</p>

  <p><dfn id="dom-context-2d-filltext" title="dom-context-2d-fillText"><code>fillText()</code></dfn>和
  <dfn id="dom-context-2d-stroketext" title="dom-context-2d-strokeText"><code>strokeText()</code></dfn>
  方法有3到4个参数<var>text</var>，<var>x</var>，<var>y</var>和可选的<var>maxWidth</var>。在给定的位置(<var>x</var>, <var>y</var>)渲染给定的文本<var>text</var>。同时，保证文本长度不会超过<var>maxWidth</var>。
  如果有指明还会用当前的
  <code title="dom-context-2d-font"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-font">font</a></code>，<code title="dom-context-2d-textAlign"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textalign">textAlign</a></code>和<code title="dom-context-2d-textBaseline"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-textbaseline">textBaseline</a></code>
  值渲染。当该方法被调用，客户端会进行以下步骤：</p>

  <ol>

   <li><p>Run the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#text-preparation-algorithm">text preparation algorithm</a>, passing it
   <var>text</var>, the <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
   object, and, if the <var>maxWidth</var> argument was
   provided, that argument. Let <var>glyphs</var> be the
   result.</p>

   </li><li><p>Move all the shapes in <var>glyphs</var> to the
   right by <var>x</var> CSS pixels and down by <var>y</var> CSS pixels.</p></li>

   <li>

    <p>Paint the shapes given in <var>glyphs</var>, as
    transformed by the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">current transformation
    matrix</a>, with each CSS pixel in the coordinate space of <var>glyphs</var> mapped to one coordinate space unit.</p>

    <p>For <code title="dom-context-2d-fillText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-filltext">fillText()</a></code>,
    <code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code> must be
    applied to the shapes and <code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code> must be
    ignored. For <code title="dom-context-2d-strokeText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroketext">strokeText()</a></code>, the reverse
    holds: <code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code>
    must be applied to the result of <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#trace-a-path" title="trace a
    path">tracing</a> the shapes using the
    <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object for the line styles,
    and <code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code> must
    be ignored.</p>

    <p>These shapes are painted without affecting the current path,
    and are subject to <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow effects</a>,
    <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the
    <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping region">clipping region</a>, and <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
    operators</a>.</p>

   </li>

   <li><p>If the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#text-preparation-algorithm" id="drawing-text-to-the-bitmap:text-preparation-algorithm-2">text preparation algorithm</a> used a font that has an <a id="drawing-text-to-the-bitmap:origin-2" href="http://www.w3.org/TR/html/browsers.html#origin-0">origin</a>
   that is not the <a href="http://www.w3.org/TR/html/browsers.html#same-origin" id="drawing-text-to-the-bitmap:same-origin">same</a> as the <a id="drawing-text-to-the-bitmap:origin-2-2" href="http://www.w3.org/TR/html/browsers.html#origin-0">origin</a> specified by
   the <a id="drawing-text-to-the-bitmap:entry-settings-object" href="http://www.w3.org/TR/html/webappapis.html#entry-settings-object">entry settings object</a> (even if "using a font" means just checking if that font
   has a particular glyph in it before falling back to another font), then set the bitmap's <a href="http://www.w3.org/TR/html/scripting-1.html#concept-canvas-origin-clean" id="drawing-text-to-the-bitmap:concept-canvas-origin-clean">origin-clean</a> flag to
   false.</p></li>
  </ol>

<!--v6DVT - this is commented out until CSS can get its act together
enough to actual specify vertical text rendering (how long have we
been waiting now?)

WHEN EDITING THIS, FIX THE PARTS MARKED "&#x0058;&#x0058;&#x0058;" BELOW

ALSO NOTE THAT THIS PROBABLY NEEDS ENTIRELY REVISITING NOW THAT WE
HAVE REJIGGED HOW TEXT WORKS IN v5

  <p>The <dfn
  title="dom-context-2d-fillVerticalText"><code>fillVerticalText()</code></dfn>
  and <dfn
  title="dom-context-2d-strokeVerticalText"><code>strokeVerticalText()</code></dfn>
  methods take three or four arguments, <var>text</var>, <var
  title="">x</var>, <var>y</var>, and optionally <var
  title="">maxHeight</var>, and render the given <var
  title="">text</var> as vertical text at the given (<var
  title="">x</var>, <var>y</var>) coordinates ensuring that
  the text isn't taller than <var>maxHeight</var> if
  specified, using the current <code
  title="dom-context-2d-font">font</code> and <code
  title="dom-context-2d-textAlign">textAlign</code>
  values. Specifically, when the methods are called, the user agent
  must run the following steps:</p>

  <ol>

   <li><p>If <var>maxHeight</var> is present but less than or
   equal to zero, return without doing anything; abort these
   steps.</p></li>

   <li><p>Let <var>font</var> be the current font of the
   context, as given by the <code
   title="dom-context-2d-font">font</code> attribute.</p></li>

   <li><p>Replace all the <span title="space character">space
   characters</span> in <var>text</var> with U+0020 SPACE
   characters.</p></li>

   <li><p>Form a <em class="&#x0058;&#x0058;&#x0058;">whatever CSS ends up calling
   vertical line boxes and inline boxes</em> containing the text <var
   title="">text</var>, with all the properties at their initial
   values except the 'font' property of the inline box set to <var
   title="">font</var> and the 'direction' property of the inline
   box set to <span>the directionality</span> of the <code>canvas</code>
   element.</p></li>

   <!- - if you insert a step here, make sure to adjust the next step's
   final words - ->

   <li><p>If the <var>maxHeight</var> argument was specified
   and the hypothetical height of the <em class="&#x0058;&#x0058;&#x0058;">box</em>
   in the hypothetical line box is greater than <var
   title="">maxHeight</var> CSS pixels, then change <var
   title="">font</var> to have a more condensed font (if one is
   available or if a reasonably readable one can be synthesized by
   applying an appropriate scale factor to the font) or a smaller
   font, and return to the previous step.</p></li>

   <li>

    <p>Let the <var>anchor point</var> be a point on the <em
    class="&#x0058;&#x0058;&#x0058;">inline box</var>, determined by the <code
    title="dom-context-2d-textAlign">textAlign</code>, as follows:</p>

    <p>Vertical position:</p>

    <dl>

     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">start</code></dt>
     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">left</code> and <span>the directionality</span> of the
     <code>canvas</code> element is 'ltr'</dt>
     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">right</code> and <span>the directionality</span> of the
     <code>canvas</code> element is 'rtl'</dt>

     <dd>Let the <var>anchor point</var>'s vertical
     position be the top edge of the <em class="&#x0058;&#x0058;&#x0058;">inline
     box</em>.</dd>

     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">end</code></dt>
     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">right</code> and <span>the directionality</span> of the
     <code>canvas</code> element is 'ltr'</dt>
     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">left</code> and <span>the directionality</span> of the
     <code>canvas</code> element is 'rtl'</dt>

     <dd>Let the <var>anchor point</var>'s vertical
     position be the bottom edge of the <em class="&#x0058;&#x0058;&#x0058;">inline
     box</em>.</dd>


     <dt>If <code
     title="dom-context-2d-textAlign">textAlign</code> is <code
     title="">center</code></dt>

     <dd>Let the <var>anchor point</var>'s vertical position
     be halfway between the top and bottom edges of the <em
     class="&#x0058;&#x0058;&#x0058;">inline box</em>.</dd>


    </dl>

    <p>Let the horizontal position be half way between the left and
    right edges of the em box of the first available font of the <em
    class="&#x0058;&#x0058;&#x0058;">inline box</em>.</p>

   </li>

   <li>

    <p>Paint the hypothetical inline box as the shape given by the
    text's glyphs, as transformed by the <span
    title="dom-context-2d-transformation">current transformation
    matrix</span>, and anchored and sized so that before applying the
    <span title="dom-context-2d-transformation">current transformation
    matrix</span>, the <var>anchor point</var> is at (<var
    title="">x</var>, <var>y</var>) and each CSS pixel is
    mapped to one coordinate space unit.</p>

    <p>For <code
    title="dom-context-2d-fillVerticalText">fillVerticalText()</code>
    <code title="dom-context-2d-fillStyle">fillStyle</code> must be
    applied and <code
    title="dom-context-2d-strokeStyle">strokeStyle</code> must be
    ignored. For <code
    title="dom-context-2d-strokeVerticalText">strokeVerticalText()</code>
    the reverse holds and <code
    title="dom-context-2d-strokeStyle">strokeStyle</code> must be
    applied and <code
    title="dom-context-2d-fillStyle">fillStyle</code> must be
    ignored.</p>

    <p>Text is painted without affecting the current path, and is
    subject to <span title="shadows">shadow effects</span>, <span
    title="dom-context-2d-globalAlpha">global alpha</span>, the <span
    title="clipping region">clipping region</span>, and <span
    title="dom-context-2d-globalCompositeOperation">global composition
    operators</span>.</p>

   </li>

   <li>
       <p>If the text preparation algorithm used a font that has an <span>origin</span> that is not the same
	   as the entry script's <span>origin</span> even if "using a font" means just checking if that font has a particular glyph in it before falling back to another font), then set the <i>origin-clean</i> flag to false.
	   </p>
   </li>
  </ol>

v6DVT (also check for '- -' bits in the part above) -->

  <p><dfn id="dom-context-2d-measuretext" title="dom-context-2d-measureText"><code>measureText()</code></dfn>方法有一个参数<var>text</var>。
  当方法被调用时，客户端会运行一个文本预备算法，将新的TextMetrics对象按照以下列表描述的设置属性。如果途中需要有<span>origin</span>的字体，但和<code>Document</code>中的<code>canvas</code>元素不<span title="same
  origin">相同</span>，那么这个方法会抛出<code>SecurityError</code>异常。否则它会返回一个新的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#textmetrics">TextMetrics</a></code>对象。
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSS">[CSS]</a>

  </p>

  <dl>
  <dt><dfn id="dom-textmetrics-width" title="dom-textmetrics-width"><code>width</code></dfn> attribute</dt>

   <dd>
   <p>inline box的宽度，以CSS像素为单位。（文本的优先宽度）</p>
   </dd>

  </dl>

<!--ADD-TOPIC:Security-->
  If doing these measurements requires using a font that has an
  <span>origin</span> that is not the <span title="same
  origin">same</span> as that of the <code>Document</code> object that
  owns the <code>canvas</code> element (even if "using a font" means
  just checking if that font has a particular glyph in it before
  falling back to another font), then the method must throw a
  <code>SecurityError</code> exception.
<!--REMOVE-TOPIC:Security-->
  Otherwise, it must return the new <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#textmetrics">TextMetrics</a></code> object.
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSS">[CSS]</a>

  <p></p>

  <p>The <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#textmetrics">TextMetrics</a></code> interface is used for the objects
  returned from <code title="dom-context-2d-measureText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext">measureText()</a></code>. It has one
  attribute, <dfn id="dom-textmetrics-width-0" title="dom-textmetrics-width"><code>width</code></dfn>, which is set
  by the <code title="dom-context-2d-measureText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext">measureText()</a></code>
  method.</p>

  <p class="note">Glyphs rendered using <code title="dom-context-2d-fillText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-filltext">fillText()</a></code> and <code title="dom-context-2d-strokeText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroketext">strokeText()</a></code> can spill out
  of the box given by the font size (the em square size) and the width
  returned by <code title="dom-context-2d-measureText"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-measuretext">measureText()</a></code> (the text
  width). This version of the specification does not provide a way to
  obtain the bounding box dimensions of the text. If the text is to be
  rendered and removed, care needs to be taken to replace the entire
  area of the canvas that the clipping region covers, not just the box
  given by the em square height and measured text width.</p>

  </div>

  <p class="note">A future version of the 2D context API may provide a
  way to render fragments of documents, rendered using CSS, straight
  to the canvas. This would be provided in preference to a dedicated
  way of doing multiline layout.</p>



  <h2 id="drawing-paths-to-the-canvas"><span class="secno">11 </span>在canvas上绘制路径</h2>

  <p>每个context都有<dfn id="current-default-path">current default path</dfn>。它不是<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#drawing-state">drawing state</a>的一部分，而是一条当前路径。
   如上所述，当前路径就是一条<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#concept-path" title="concept-path">path</a>。</p>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-beginPath"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-beginpath">beginPath</a></code>()</dt>

   <dd>

    <p>重置当前路径。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-fill"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fill">fill</a></code>()</dt>

   <dd>

    <p>用当前填充样式填充当前路径的子路径或给定路径。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-stroke"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-stroke">stroke</a></code>()</dt>

   <dd>

    <p>用当前描边样式描边当前路径的子路径或给定路径。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-drawFocusIfNeeded"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawfocusifneeded">drawFocusIfNeeded</a></code>(<var>element</var>)</dt>

   <dd>

    <p>根据当前路径告知用户canvas的位置。如果给定元素已经聚焦，则根据客户端规则将当前路径描边。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-clip"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clip">clip</a></code>()</dt>

   <dd>

    <p>进一步限制裁剪
        区到当前路径。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-isPointInPath"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-ispointinpath">isPointInPath</a></code>(<var>x</var>, <var>y</var>)</dt>

   <dd>

    <p>返回给定的点是否在当前路径内。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><dfn id="dom-context-2d-beginpath" title="dom-context-2d-beginPath"><code>beginPath()</code></dfn>方法可以清空当前路径的子路径列表。
  </p>

   <p><dfn id="dom-context-2d-fill" title="dom-context-2d-fill"><code>fill()</code></dfn>方法使用<code title="dom-context-2d-fillStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-fillstyle">fillStyle</a></code>和非零环绕数规则填充当前路径的所有子路径。
  当子路径被填充时，开放的子路径会间接闭合。</p>

  <p class="note">Thus, if two overlapping but otherwise independent
  subpaths have opposite windings, they cancel out and result in no
  fill. If they have the same winding, that area just gets painted
  once.</p>

  <p><dfn id="dom-context-2d-stroke" title="dom-context-2d-stroke"><code>stroke()</code></dfn>方法会用<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象处理线条样式<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#trace-a-path" title="trace a path">trace</a>路径，
  然后用<code title="dom-context-2d-strokeStyle"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-strokestyle">strokeStyle</a></code>属性填充结合描边区域。</p>

  <p class="note">As a result of how the algorithm to <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#trace-a-path">trace a
  path</a> is defined, overlapping parts of the paths in one stroke
  operation are treated as if their union was what was painted.</p>

  <p class="note">The stroke <em>style</em> is affected by the
  transformation during painting, even if the path is the
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#current-default-path">current default path</a>.</p>

  <p>当填充或描边时，路径不会影响当前路径并且会受到<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global
      alpha</a>，<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow
      effects</a>，<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping region">clipping
      region</a>和<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
      operators</a>影响。</p>

  <p>在描边之前，长度为0的直线片段会被裁剪。空子路径会被忽略。</p>

  <hr>

  <p id="dom-context-2d-focusoutline">The <dfn id="dom-context-2d-drawfocusifneeded" title="dom-context-2d-drawFocusIfNeeded"><code>drawFocusIfNeeded(<var>element</var>)</code></dfn> method, when invoked, must run
  the following steps:</p>

  <ol>
   <li>
   <p>
   If the current path has zero subpaths, then abort these steps.
   </p>
   </li>
   <li><p>If <var>element</var> is not focused or is not a
   descendant of the element with whose context the method is
   associated, then abort these steps.</p></li>

   <li>

    <p>If the user has requested the use of particular focus outlines
    (e.g. high-contrast focus outlines), or if the <var>element</var> would have a focus outline drawn around it,
    then draw a focus outline of the appropriate style along the intended
    path, following platform conventions.</p>

    <p class="note">Some platforms only draw focus outlines around
    elements that have been focused from the keyboard, and not those
    focused from the mouse. Other platforms simply don't draw focus
    outlines around some elements at all unless relevant accessibility
    features are enabled. This API is intended to follow these
    conventions. User agents that implement distinctions based on the
    manner in which the element was focused are encouraged to classify
    focus driven by the <code title="dom-focus">focus()</code> method
    based on the kind of user interaction event from which the call
    was triggered (if any).</p>

    <p>The focus outline should not be subject to the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow effects</a>, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, or the
    <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global
    composition operators</a>, but <em>should</em> be subject to
    the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping region">clipping region</a>.
    When the focus area is clipped by the canvas element, only the visual
	representation of the focus outline is clipped to the clipping region.

	</p>

	<p>
    If the focus area is not on the screen, then scroll the focus outline
    into view when it receives focus.
	</p>

   </li>

   <li>

    <p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#inform">Inform the user</a> of the location
	given by the path. The full location
	of the corresponding fallback element is passed to the
	accessibility API, if supported. User agents may wait until the next
	time the <span>event loop</span> reaches its "update the
	rendering" step to inform the user. </p>

   </li>

  </ol>

  <p class="note" id="inform">"Inform the user", as used in this
  section, could mean calling a system accessibility API, which would
  notify assistive technologies such as magnification tools. To
  properly drive magnification based on a focus change, a system
  accessibility API driving a screen magnifier needs the bounds for
  the newly focused object. The methods above are intended to enable
  this by allowing the user agent to report the bounding box of the
  path used to render the focus outline as the bounds of the <var>element</var> element passed as an argument, if that
  element is focused, and the bounding box of the area to which the
  user agent is scrolling as the bounding box of the current
  selection.</p>

  <hr>

  <p><dfn id="dom-context-2d-clip" title="dom-context-2d-clip"><code>clip()</code></dfn>方法会根据给定的路径计算并截取裁剪区域，最后返回一个新建的<dfn id="clipping-region">clipping region</dfn>。
  此时开放的子路径会间接闭合且不会受到其它影响。新的裁剪区域会代替当前的裁剪区域。</p>

  <p>当context被初始化后，裁剪区域会被设置为坐标为(0,0)宽高为坐标空间的矩形。</p>

  <!-- v6
   Jordan OSETE suggests:
    * support ways of extending the clipping region (union instead of intersection)
       - also "add", "subtract", "replace", "intersect" and "xor"
       - maybe just support creating unions, intersections, and other -ions of paths
  -->
  <!-- v5
   Jordan OSETE suggests:
    * support ways of resetting the clipping region without save/restore
  -->

  <hr>

  <p><dfn id="dom-context-2d-ispointinpath" title="dom-context-2d-isPointInPath"><code>isPointInPath()</code></dfn>方法返回关于给定坐标<var>x</var>和<var>y</var>在不经过变换后是否在目的路径内的布尔值。
  路径上的点会被认为在路径内。如果参数是Infinite或者NaN则返回false。</p>

  <hr>

  </div>

  <h2 id="drawing-images-to-the-canvas"><span class="secno">12 </span>在canvas上绘制图像</h2>

  <p>要在canvas上绘制图像，可以使用<dfn id="dom-context-2d-drawimage" title="dom-context-2d-drawImage"><code>drawImage</code></dfn>方法。
  </p>

  <p>该方法通过传入三个参数调用：</p>

  <ul class="brief">
   <li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>)</code>
   </li><li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
   </li><li><code>drawImage(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
  </li></ul>

  <!-- v3: drawImage() of an ImageData object might make sense (when resizing as well as filtering) - ack Charles Pritchard -->

  <p>这三个参数可以是<var>image</var>的<code>HTMLImageElement</code>或者<code>HTMLCanvasElement</code>或者<code>HTMLVideoElement</code>。
  </p>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-drawImage"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage">drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>)</dt>
   <dt><var>context</var> . <code title="dom-context-2d-drawImage"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage">drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</dt>
   <dt><var>context</var> . <code title="dom-context-2d-drawImage"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage">drawImage</a></code>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</dt>

   <dd>

    <p>将给定的图像绘制在canvas上。参数说明如下：</p>

    <p><img alt="The sx and sy parameters give the x and y coordinates of the source rectangle; the sw and sh arguments give the width and height of the source rectangle; the dx and dy give the x and y coordinates of the destination rectangle; and the dw and dh arguments give the width and height of the destination rectangle." height="356" src="https://www.w3.org/TR/2015/REC-2dcontext-20151119/images/drawImage.png" width="356"></p>

    <p>如果第一个参数不是<code>img</code>或者<code>canvas</code>或者<code>video</code>，则<a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a>一个<code>TypeMismatchError</code>异常。
    如果图像没有数据，则<a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a>一个<code>InvalidStateError</code>异常。如果源矩形维度为0，则<a href="http://www.w3.org/TR/WebIDL-1/#dfn-throw">抛出</a>一个<code>IndexSizeError</code>异常。
    </p>

   </dd>

  </dl>

  <div class="impl">

<p>When the <code id="drawing-images:dom-context-2d-drawimage-4"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawimage">drawImage()</a></code> method is invoked, the user
  agent must run the following steps:</p>

  <ol><li><p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#check-the-usability-of-the-image-argument" id="drawing-images:check-the-usability-of-the-image-argument">Check the usability of the <var>image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then abort these steps without drawing anything.
   Otherwise it returns <i>good</i>; continue with these steps.</p></li><li>

    <p>Establish the source and destination rectangles as follows:</p>

    <p>If not specified, the <var>dw</var> and <var>dh</var> arguments must default to the values of
    <var>sw</var> and <var>sh</var>, interpreted such that one CSS pixel in the image is treated as
    one unit in the bitmap's coordinate space. If the <var>sx</var>,
    <var>sy</var>, <var>sw</var>, and <var>sh</var> arguments are not specified, they must default to 0,
    0, the image's intrinsic width in image pixels, and the image's intrinsic height in image
    pixels, respectively. If the image has no intrinsic dimensions, the <i>concrete object size</i>
    must be used instead, as determined using the CSS "<a href="http://www.w3.org/TR/css3-images/#default-sizing">Concrete Object Size Resolution</a>"
    algorithm, with the <i>specified size</i> having neither a definite width nor height, nor any
    additional constraints, the object's intrinsic properties being those of the <var>image</var>
    argument, and the <a id="drawing-images:default-object-size" href="http://www.w3.org/TR/css3-images/#default-object-size">default object size</a> being the size of the bitmap. <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSIMAGES">[CSSIMAGES]</a></p>

    <p>The source rectangle is the rectangle whose corners are the four points (<var>sx</var>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <span><var>sy</var>+<var>sh</var></span>),
    (<var>sx</var>, <span><var>sy</var>+<var>sh</var></span>).</p>

    <p>The destination rectangle is the rectangle whose corners are the four points (<var>dx</var>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <span><var>dy</var>+<var>dh</var></span>),
    (<var>dx</var>, <span><var>dy</var>+<var>dh</var></span>).</p>

    <p>When the source rectangle is outside the source image, the source rectangle must be clipped
    to the source image and the destination rectangle must be clipped in the same proportion.</p>

    <p class="note">When the destination rectangle is outside the destination image (the
    bitmap), the pixels that land outside the bitmap are
    discarded, as if the destination was an infinite canvas whose rendering was clipped to the
    dimensions of the bitmap.</p>

   </li><li><p>If one of the <var>sw</var> or <var>sh</var> arguments is zero, abort
   these steps. Nothing is painted.</p></li><li>

    <p>Paint the region of the <var>image</var> argument specified by the source rectangle
    on the region of the rendering context's bitmap specified by the
    destination rectangle, after applying the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" id="drawing-images:transformations">current
    transformation matrix</a> to the destination rectangle.</p>

    <p>The image data must be processed in the original direction, even if the dimensions given are
    negative. </p>

  <p class="note">本规范没有定义当图像缩放时的算法。</p>

  <p class="note">When a canvas is drawn onto itself, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#drawing-model">drawing
  model</a> requires the source to be copied before the image is drawn
  back onto the canvas, so it is possible to copy parts of a canvas
  onto overlapping parts of itself.</p>

    <p>If the original image data is a bitmap image, the value painted at a point in the destination
    rectangle is computed by filtering the original image data. The user agent may use any filtering
    algorithm (for example bilinear interpolation or nearest-neighbor). When the filtering algorithm
    requires a pixel value from outside the original image data, it must instead use the value from
    the nearest edge pixel. (That is, the filter uses 'clamp-to-edge' behaviour.) When the filtering
    algorithm requires a pixel value from outside the source rectangle but inside the original image
    data, then the value from the original image data must be used.</p>



    <p class="note">Thus, scaling an image in parts or in whole will have the same effect. This does
    mean that when sprites coming from a single sprite sheet are to be scaled, adjacent images in
    the sprite sheet can interfere. This can be avoided by ensuring each sprite in the sheet is
    surrounded by a border of transparent black, or by copying sprites to be scaled into temporary
    <code id="drawing-images:the-canvas-element-3"><a href="http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element">canvas</a></code> elements and drawing the scaled sprites from there.</p>

    <p>Images are painted without affecting the current path, and are subject to <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" id="drawing-images:shadows">shadow effects</a>, <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" id="drawing-images:dom-context-2d-globalalpha">global
    alpha</a>, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" id="drawing-images:clipping-region">clipping region</a>, and <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" id="drawing-images:dom-context-2d-globalcompositeoperation">global composition operators</a>.</p>

   </li><li><p>If <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-image-argument-is-not-origin-clean" id="drawing-images:the-image-argument-is-not-origin-clean">the <var>image argument</var> is not origin-clean</a>, set the
  bitmap's <a href="http://www.w3.org/TR/html/scripting-1.html#concept-canvas-origin-clean" id="drawing-images:concept-canvas-origin-clean">origin-clean</a> flag
   to false.</p></li></ol>

  <p>Images are painted without affecting the current path, and are
  subject to <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow effects</a>, <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping region">clipping region</a>, and <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
  operators</a>.</p>

  </div>

  <h2 id="hit-regions"><span class="secno">13 </span>点击区域</h2>

  <p>每一个<span>primarycontext</span>是<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>对象的<code>canvas</code>元素都有一个<dfn id="hit-region-list">hit region list</dfn>关联着它的位图。
  </p>

  <p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a>描述了<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region" title="hit
  region">hit regions</a>的列表。</p>

  <p>每个<dfn id="hit-region">hit region</dfn>由以下内容组成：</p>

  <ul>

  <li><p>一个在<code>canvas</code>元素的位图上可响应的区域的<dfn id="hit-region&#39;s-path" title="hit region&#39;s path"> path</dfn>。</p></li>

  <li><p>一个在<code>canvas</code>元素的位图被<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-path">hit region's path</a>包围的区域的<dfn id="hit-region&#39;s-bounding-circumference" title="hit region&#39;s bounding circumference">bounding
  circumference</dfn>。</p></li>

  <li><p>一个非空字符串可以代表<dfn id="hit-region&#39;s-id" title="hit region&#39;s ID">ID</dfn>以此来互相区分。</p></li>

   <li>
   <p>一个<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control" title="hit region&#39;s control">control</a>。</p>

   <p>每个<dfn id="hit-region&#39;s-control" title="hit region&#39;s control">control</dfn>引用来一个<code>Element</code>节点。它是客户端用来决定点击区域的状态的。（如果没有后代节点可以被忽略。）</p>

   </li>
  </ul>

  <dl class="domintro">

  <dt><var>context</var> . <code title="dom-context-2d-addHitRegion"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-addhitregion">addHitRegion</a></code>(<var>options</var>)</dt>

  <dd>

   <p>根据当前默认路径将点击区域加入到canvas中。参数是包含以下内容的对象：</p>

   <dl>

    <dt><code title="dom-HitRegionOptions-id">id</code>（默认空字符串）

	</dt><dd>The ID to use for this region. This is used in
     <code>MouseEvent</code> events on the <code>canvas</code> (<code title="dom-MouseEvent-region"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-mouseevent-region">event.region</a></code>) and as a way
     to reference this region in later calls to <code title="dom-context-2d-addHitRegion"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-addhitregion">addHitRegion()</a></code>.</dd>
     <dt><code title="dom-HitRegionOptions-control">control</code> (默认null)

     </dt><dd>一个绑定事件的元素，且可以被访问性工具用来与区域描述或交互。</dd>

    </dl>

   <p>点击区域可以被用作以下用途：</p>

   <ul>
    <li>ID可以使点击检测更简单。</li>

    <li>control可以将事件自动的绑定到元素上。例如点击canvas可以通过<code>button</code>元素自动的提交表单。</li>

    </ul>

    <p class="note">ID和control都是可选内容。当调用addHitRegion时，两者必须提供一个来创建点击区域。 </p>


	</dd>

	<dt><var>context</var> . <code title="dom-context-2d-removeHitRegion"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-removehitregion">
	removeHitRegion</a></code>(<var>id</var>)</dt>

  <dd>

   <p>从canvas位图中去掉点击区域。参数代表点击区域的ID。</p>

  <p>通过这个操作区域覆盖的路径都会被清除，使得区域不能交互。特别的，在清除之前，覆盖该路径的区域会被添加，但不会恢复之前的状态。</p>

   </dd>

   	<dt><var>context</var> . <code title="dom-context-2d-clearHitRegions"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearhitregions">
	clearHitRegions</a></code>()</dt>

  <dd>

   <p>从canvas位图中清除所有点击区域。 </p>

  <p>通过这个操作区域覆盖的路径都会被清除，使得区域不能交互。</p>

   </dd>

   </dl>

   <div class="impl">

   <p><dfn id="the-region-identified-by-the-id">The region identified by the ID</dfn> <var>ID</var> in a bitmap <var>bitmap</var> is the value returned by the following
   algorithm (which can return a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> or
   nothing):</p>

   <ol>

   <li><p>If <var>ID</var> is null, return nothing and abort
   these steps.</p></li>

   <li><p>Let <var>list</var> be the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region
   list</a> associated with <var>bitmap</var>.</p></li>

   <li><p>If there is a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> in <var>list</var> whose <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id" title="hit region&#39;s ID">ID</a>
   is a <span>case-sensitive</span> match for <var>ID</var>,
   then return that <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> and abort these
   steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol>

  <p><dfn id="the-region-representing-the-control">The region representing the control</dfn> <var>control</var> for a bitmap <var>bitmap</var> is the value returned by the following
  algorithm (which can return a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> or
  nothing):</p>

  <ol>

   <li><p>If <var>control</var> is null, return
   nothing and abort these steps.</p></li>

   <li><p>Let <var>list</var> be the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region
   list</a> associated with <var>bitmap</var>.</p></li>

   <li><p>If there is a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> in <var>list</var> whose <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control" title="hit region&#39;s
   control">control</a> is <var>control</var>, then
   return that <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> and abort these
   steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol>

  <p><dfn id="the-control-represented-by-a-region">The control represented by a region</dfn> <var>region</var> for a <code>canvas</code> element <var>ancestor</var> is the value returned by the following
  algorithm (which can return an element or nothing):</p>

  <ol>

   <li><p>If <var>region</var> has no <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control" title="hit
   region&#39;s control">control</a>, return nothing and abort these
   steps.</p></li>

   <li><p>Let <var>control</var> be <var>region</var>'s <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control" title="hit region&#39;s
   control">control</a>.</p></li>

   <li><p>If <var>control</var> is not a descendant of <var>ancestor</var>, then return nothing and abort these
   steps.</p></li>

   <li><p>Otherwise, return <var>control</var>.</p></li>

  </ol>

  <p><dfn id="the-region-for-a-pixel">The region for a pixel</dfn> <var>pixel</var> on a bitmap
  <var>bitmap</var> is the value returned by the following
  algorithm (which can return a
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> or nothing):</p>

  <ol>

   <li><p>Let <var>list</var> be the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region
   list</a> associated with <var>bitmap</var>.</p></li>

   <li><p>If there is a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> in <var>list</var> whose <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-path">path</a> contains <var>pixel</var>,
   then return that <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> and abort these
   steps.</p></li>

   <li><p>Otherwise, return nothing.</p></li>

  </ol>
<!--
  <p>To <dfn>clear regions that cover the pixels</dfn> <var
  title="">pixels</var> on a bitmap <var>bitmap</var>, the user agent must run the following
  steps:</p>

  <ol>

   <li><p>Let <var>list</var> be the <span>hit region
   list</span> associated with <var>bitmap</var>.</p></li>

   <li><p>Remove all pixels in <var>pixels</var> from the
   <span title="hit region's set of pixels">set of pixels</span> of
   each <span>hit region</span> in <var>list</var>.</p></li>



  </ol>
  -->



  <hr>

  <p>When the <dfn id="dom-context-2d-addhitregion" title="dom-context-2d-addHitRegion"><code>addHitRegion()</code></dfn>
  method is invoked, the user agent must run the following steps:</p>

  <ol>

   <li><p>Let <var>arguments</var> be the dictionary object
   provided as the method's argument.</p></li>

   <li><p>Let <var title="dom-HitRegionOptions-path">source path</var> be the <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code>
   object's <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#current-default-path">current default path</a>.</p></li>

   <li><p>Let <var>specified pixels</var> be the pixels
   contained in <var>source path</var>.

   </p></li><li><p>Remove from <var>specified pixels</var> any pixels not contained within the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region">clipping
   region</a>.</p></li>

   <li><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-id">id</code> member is an
   empty string, let it be null instead.</p></li>

   <li><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-id">id</code> member is null and the <var>arguments</var>
   object's <code title="dom-HitRegionOptions-control">control</code> member is null,
   throw a <code>NotSupportedError</code> exception and abort these steps.</p></li>

   <li><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-id">id</code> member is not null, then
   let <var>previous region for this ID</var> be <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-region-identified-by-the-id">the
   region identified by the ID</a> given by the <code title="dom-HitRegionOptions-id">id</code> member's value in this
   <code>canvas</code> element. If the <code title="dom-HitRegionOptions-id">id</code> member is null or no such
   region currently exists, let <var>previous region for this
   ID</var> be null.</p></li>

   <li>
    <p>If the <var>specified pixels</var> has no pixels, throw a
    <code>NotSupportedError</code> exception and abort these
    steps.</p>

   </li>


   <li>

    <p>Let <var>region</var> be a newly created <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit
    region</a>, with its information configured as follows:</p>

    <dl>

     <dt><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-path">Hit region's path</a>

     </dt><dd><p>The <var>specified pixels</var>.


     </p></dd><dt><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-bounding-circumference">Hit region's bounding circumference</a>

     </dt><dd><p>A user-agent-defined shape that wraps the pixels contained
     in <var>source path</var>. (In the simplest case, this
     can just be the bounding rectangle; this specification allows it
     to be any shape in order to allow other interfaces.)

     </p></dd><dt><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id">Hit region's ID</a>

     </dt><dd><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-id">id</code> member is not null: the
     value of the <code title="dom-HitRegionOptions-id">id</code>
     member. Otherwise, <var>region</var> has no <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id" title="hit region&#39;s id">id</a>.

     </p></dd><dt><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control">Hit region's control</a>

     </dt><dd><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-control">control</code> member is not
     null: the value of the <code title="dom-HitRegionOptions-control">control</code> member.
     Otherwise, <var>region</var> has no <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control" title="hit
     region&#39;s control">control</a>.

    </p></dd></dl>

   </li>

   <li><p>If the <var>arguments</var> object's <code title="dom-HitRegionOptions-control">control</code> member is not
   null, then let <var>previous region for the control</var>
   be <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-region-representing-the-control">the region representing the control</a> given by the
   <code title="dom-HitRegionOptions-control">control</code> member's
   value for this <code>canvas</code> element, if any. If the <code title="dom-HitRegionOptions-control">control</code> member is null
   or no such region currently exists, let <var>previous
   region for the control</var> be null.</p></li>


   <li><p>If there is a <var>previous region with this
   control</var>, remove it from the <code>canvas</code> element's
   <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a>.</p></li>

   <li><p>If the arguments object's <code title="dom-HitRegionOptions-control">
   control</code> member is not null, <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#inform">inform the user</a> of the location of the region
   representing the <code title="dom-HitRegionOptions-control">control</code>
   given by the control member's value for this <code>canvas</code> element, if any.
   The full location of the corresponding fallback element, pertaining
   to the <code title="dom-HitRegionOptions-control">control</code>,
   as represented by the region is passed to the  accessibility API, if supported.</p></li>

   <li><p>If there is a <var>previous region with this
   ID</var>, remove it from the <code>canvas</code> element's <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region
   list</a>.</p></li>

   <li><p>Add <var>region</var> to the <code>canvas</code>
   element's <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a>.</p></li>

  </ol>

  <p>When the <dfn id="dom-context-2d-removehitregion" title="dom-context-2d-removeHitRegion"><code>removeHitRegion()</code></dfn>
  method is invoked, the user agent must run the following steps:</p>

  <ol>

   <li><p>Let <var>region</var> be <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-region-identified-by-the-id">the region
   identified by the ID</a> given by the method's argument in this
   <code>canvas</code> element, if any. If no such region currently
   exists, abort these steps.</p>

   <p class="note"> If the method's argument is an empty string, then no region will match.</p>

   </li><li><p>Remove <var>region</var> from the <code>canvas</code> element's
   <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a>.</p></li>



  </ol>

    <p>When the <dfn id="dom-context-2d-clearhitregions" title="dom-context-2d-clearHitRegions"><code>clearHitRegions()</code></dfn>
  method is invoked, the user agent must run the following steps:</p>

  <ol>

   <li><p>Remove all <var>hit regions</var>
   from the <code>canvas</code> element and clear the element's <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a>. If no regions currently
   exist, abort these steps.</p></li>

  </ol>

  <p class="note">Calling <code title="dom-context-2d-clearRect"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-clearrect">clearRect()</a></code> is a way
  to clear all or some hit regions. Calling clearHitRegions()
  removes all hit regions and clears the hit region list. The <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region
  list</a> itself is also reset when the rendering context is reset.
  For example, when a <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> object is
  bound to or unbound from a <code>canvas</code>, or the dimensions of the bitmap are changed.</p>


  </div>

  <hr>

  <p>The <code>MouseEvent</code> interface is extended to support hit
  regions:</p>

  <pre class="idl">partial interface <span>MouseEvent</span> {
  readonly attribute DOMString? <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-mouseevent-region" title="dom-MouseEvent-region">region</a>;
};

partial dictionary <span>MouseEventInit</span> {
  DOMString? region;
};</pre>

  <dl class="domintro">

   <dt><var>event</var> . <code title="dom-MouseEvent-region"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-mouseevent-region">region</a></code></dt>

   <dd>

    <p>如果鼠标位于<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a>之上，那么这将返回存在的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id">hit region's ID</a>。</p>

    <p>若不存在，则返回null。</p>

   </dd>

  </dl>

  <div class="impl">

  <p><code>MouseEvent</code>对象上的<dfn id="dom-mouseevent-region" title="dom-MouseEvent-region"><code>region</code></dfn>属性会是它初始化的值。
  当对象被创建后，这个属性会被设置为null。如果当事件被触发鼠标在该区域上悬停，它代表<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id">hit region's
          ID</a>。</p>

  <p>当<code>MouseEvent</code>在<code>canvas</code>元素上被客户端触发，如果这块区域有点击区域列表，那么客户端会进行以下操作。
  如果这些步骤<i>act as normal</i>，那意味着事件没有操作需求。</p>

  <ol>

   <li><p>If the pointing device is not indicating a pixel on the
   canvas, <i>act as normal</i> and abort these steps.</p></li>

   <li><p>If the canvas element has no hit region list, act as
   normal and abort these steps.</p></li>

   <li><p>Let pixel be the pixel indicated by the pointing device.</p></li>

   <li><p>Let region be the hit region that is the region for the pixel <var>pixel</var> on this canvas element's bitmap, if any.</p></li>

   <li><p>Let <var>id</var> be the <var>region</var>'s <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-id" title="hit region&#39;s ID">ID</a>, if
   any.</p></li>

   <li><p>If there is an <var>id</var>, then initialize the
   event object's <code title="dom-MouseEvent-region"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-mouseevent-region">region</a></code>
   attribute to <var>id</var>.</p></li>

   <li><p>Dispatch the event, but with the updated event object as
   given in the above steps.</p></li>

  </ol>

  <p class="note">This approach simplifies event handling by not
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-mouseevent-region">re-targeting
  the event</a>.  The event is dispatched as normal once the event.region
  attribute is initialized to the active hit region's ID.  The event is
  received by the canvas element allowing the author to define the
  behavior of the event.</p>
  <hr>

  <p>User agents are encouraged to make use of the information present
  in a <code>canvas</code> element's <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region-list">hit region list</a> to
  improve the accessibility of <code>canvas</code> elements.</p>

  <p>Each <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> should be handled in a fashion
  equivalent to a node in a virtual DOM tree rooted at the
  <code>canvas</code> element. The hierarchy of this virtual DOM tree
  must match the hierarchy of the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region" title="hit region">hit
  regions</a>. <!--, as described by the <span title="hit region's
  parent">parent</span> of each region. Regions without a <span
  title="hit region's parent">parent</span> must be treated as
  children of the <code>canvas</code> element for the purpose of this
  virtual DOM tree.--> For each node in such a DOM tree, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-bounding-circumference">hit
  region's bounding circumference</a> gives the region of the
  screen to use when representing the node (if appropriate).</p>

  <p>The semantics of a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region">hit region</a> for the purposes of
  this virtual DOM tree are those of the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#hit-region&#39;s-control">hit region's
  control</a>, if it has one.<!--, or else of a non-interactive element
  whose ARIA role, if any, is that given by the <span>hit region's
  ARIA role</span>, and whose textual representation, if any, is given
  by the <span>hit region's label</span>.--></p>

  <p>For the purposes of accessibility tools, when an element <var>C</var> is a descendant of a <code>canvas</code> element
  and there is <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#the-region-representing-the-control" title="the region representing the control">a
  region representing the control</a> <var>C</var> for that
  <code>canvas</code> element, then the element's position relative to
  the document should be presented as if it was that region in the
  <code>canvas</code> element's virtual DOM tree.</p>

  <hr>



  </div>


  <h2 id="pixel-manipulation"><span class="secno">14 </span><dfn>像素的操作</dfn></h2>

  <dl class="domintro">

   <dt><var>imagedata</var> = <var>context</var> . <code title="dom-context-2d-createImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createimagedata">createImageData</a></code>(<var>sw</var>, <var>sh</var>)</dt>

   <dd>

    <p>返回一个包含CSS像素的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>对象。（不同设备对像素处理方式不同）所有的像素都是透明的黑色。</p>

   </dd>

   <dt><var>imagedata</var> = <var>context</var> . <code title="dom-context-2d-createImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createimagedata">createImageData</a></code>(<var>imagedata</var>)</dt>

   <dd>

    <p>返回与参数相同维度的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>对象。所有的像素都是透明的黑色。
    </p>

   </dd>

   <dt><var>imagedata</var> = <var>context</var> . <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData</a></code>(<var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>)</dt>

   <dd>

    <p>返回包含给定矩形内的图像数据的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>对象。
    </p>

    <p>如果矩形的宽或高为0则抛出<code>IndexSizeError</code>异常。</p>

    <p>数据会以没坐标空间单位内的图像数据的一个像素的形式返回。</p>

   </dd>

   <dt><var>imagedata</var> . <code title="dom-imagedata-width"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-width">width</a></code></dt>
   <dt><var>imagedata</var> . <code title="dom-imagedata-height"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-height">height</a></code></dt>

   <dd>

    <p>返回<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>对象内的数据的实际维度。</p>

   </dd>

   <dt><var>imagedata</var> . <code title="dom-imagedata-data"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-data">data</a></code></dt>

   <dd>

    <p>返回在RGBA排序下的数据的一维数组，即0到255的整数数组。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData</a></code>(<var>imagedata</var>, <var>dx</var>, <var>dy</var> [, <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, <var>dirtyHeight</var> ])</dt>

   <dd>

    <p>通过给定的<code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>对象中的数据在canvas上绘制像素。
    如果提供脏矩形，那么只有来自这个矩形的像素可以被绘制。</p>

    <p><code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code>
    和<code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>
    属性和阴影属性一样，被方法调用时会忽略；canvas内的像素会去掉合成、alpha混合和阴影等。</p>

    <p>如果有参数是无穷的则抛出<code>NotSupportedError</code>异常。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>The <dfn id="dom-context-2d-createimagedata" title="dom-context-2d-createImageData"><code>createImageData()</code></dfn>
  method is used to instantiate new blank <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code>
  objects. When the method is invoked with two arguments <var>sw</var> and <var>sh</var>, it must return an
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object representing a rectangle with a width
  in CSS pixels equal to the absolute magnitude of <var>sw</var> and a height in CSS pixels equal to the absolute
  magnitude of <var>sh</var>. When invoked with a single <var>imagedata</var> argument, it must return an
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object representing a rectangle with the same
  dimensions as the <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object passed as the
  argument. The <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object returned must be filled
  with transparent black.</p>

  <p>The <dfn id="dom-context-2d-getimagedata" title="dom-context-2d-getImageData"><code>getImageData(<var>sx</var>, <var>sy</var>, <var>sw</var>,
  <var>sh</var>)</code></dfn> method must,
<!--ADD-TOPIC:Security-->
  if the bitmap of the <code>canvas</code> element's <i>origin-clean</i> flag is set
  to false, throw a <code>SecurityError</code> exception; otherwise, it
<!--REMOVE-TOPIC:Security-->
  must return an <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object representing the
  underlying pixel data for the area of the canvas denoted by the
  rectangle whose corners are the four points (<var>sx</var>,
  <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <span><var>sy</var>+<var>sh</var></span>),
  (<var>sx</var>, <span><var>sy</var>+<var>sh</var></span>), in canvas coordinate space units. Pixels
  outside the canvas must be returned as transparent black. Pixels
  must be returned as non-premultiplied alpha values.</p>

  <p>If any of the arguments to <code title="dom-context-2d-createImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-createimagedata">createImageData()</a></code> or
  <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code>
  are infinite or NaN, the method must instead throw a
  <code>NotSupportedError</code> exception. If either the <var>sw</var> or <var>sh</var> arguments are zero,
  the method must instead throw an <code>IndexSizeError</code>
  exception.</p>

  <p><code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> objects must be initialized so that their
  <dfn id="dom-imagedata-width" title="dom-imagedata-width"><code>width</code></dfn> attribute
  is set to <var>w</var>, the number of physical device
  pixels per row in the image data, their <dfn id="dom-imagedata-height" title="dom-imagedata-height"><code>height</code></dfn> attribute is
  set to <var>h</var>, the number of rows in the image data,
  and their <dfn id="dom-imagedata-data" title="dom-imagedata-data"><code>data</code></dfn>
  attribute is initialized to a <code>Uint8ClampedArray</code> object.
  The <code>Uint8ClampedArray</code> object must use a <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvas-pixel-arraybuffer">Canvas
  Pixel <code>ArrayBuffer</code></a> for its storage, and must have
  a zero start offset and a length equal to the length of its storage,
  in bytes. The <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#canvas-pixel-arraybuffer">Canvas Pixel <code>ArrayBuffer</code></a>
  must contain the image data. At least one pixel's worth of image
  data must be returned. <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsTYPEDARRAY">[TYPEDARRAY]</a></p>

  <p>A <dfn id="canvas-pixel-arraybuffer">Canvas Pixel <code>ArrayBuffer</code></dfn> is an
  <code>ArrayBuffer</code> that whose data is represented in
  left-to-right order, row by row top to bottom, starting with the top
  left, with each pixel's red, green, blue, and alpha components being
  given in that order for each pixel. Each component of each device
  pixel represented in this array must be in the range 0..255,
  representing the 8 bit value for that component. The components must
  be assigned consecutive indices starting with 0 for the top left
  pixel's red component. <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsTYPEDARRAY">[TYPEDARRAY]</a></p>

  <p>The <dfn id="dom-context-2d-putimagedata" title="dom-context-2d-putImageData"><code>putImageData(<var>imagedata</var>, <var>dx</var>, <var>dy</var>, <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, <var>dirtyHeight</var>)</code></dfn> method writes data from
  <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> structures back to the canvas.</p>

  <p>If any of the arguments to the method are infinite or NaN, the
  method must throw a <code>NotSupportedError</code> exception.</p>

  <p>When the last four arguments are omitted, they must be assumed to
  have the values 0, 0, the <code title="dom-imagedata-width"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-width">width</a></code> member of the <var>imagedata</var> structure, and the <code title="dom-imagedata-height"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-height">height</a></code> member of the <var>imagedata</var> structure, respectively.</p>

  <p>When invoked with arguments that do not, per the last few
  paragraphs, cause an exception to be thrown, the <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData()</a></code> method
  must act as follows:</p>

  <ol>

   <li>

    <p>Let <var>dx<sub>device</sub></var> be the x-coordinate
    of the device pixel in the underlying pixel data of the canvas
    corresponding to the <var>dx</var> coordinate in the
    canvas coordinate space.</p>

    <p>Let <var>dy<sub>device</sub></var> be the y-coordinate
    of the device pixel in the underlying pixel data of the canvas
    corresponding to the <var>dy</var> coordinate in the
    canvas coordinate space.</p>

   </li>

   <li>

    <p>If <var>dirtyWidth</var> is negative, let <var>dirtyX</var> be <span><var>dirtyX</var>+<var>dirtyWidth</var></span>, and let <var>dirtyWidth</var> be equal to the absolute magnitude of
    <var>dirtyWidth</var>.</p>

    <p>If <var>dirtyHeight</var> is negative, let <var>dirtyY</var> be <span><var>dirtyY</var>+<var>dirtyHeight</var></span>, and let <var>dirtyHeight</var> be equal to the absolute magnitude of
    <var>dirtyHeight</var>.</p>

   </li>

   <li>

    <p>If <var>dirtyX</var> is negative, let <var>dirtyWidth</var> be <span><var>dirtyWidth</var>+<var>dirtyX</var></span>, and
    let <var>dirtyX</var> be zero.</p>

    <p>If <var>dirtyY</var> is negative, let <var>dirtyHeight</var> be <span><var>dirtyHeight</var>+<var>dirtyY</var></span>, and
    let <var>dirtyY</var> be zero.</p>

   </li>

   <li>

    <p>If <span><var>dirtyX</var>+<var>dirtyWidth</var></span> is greater than the <code title="dom-imagedata-width"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-width">width</a></code> attribute of the <var>imagedata</var> argument, let <var>dirtyWidth</var> be the value of that <code title="dom-imagedata-width"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-width">width</a></code> attribute, minus the
    value of <var>dirtyX</var>.</p>

    <p>If <span><var>dirtyY</var>+<var>dirtyHeight</var></span> is greater than the <code title="dom-imagedata-height"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-height">height</a></code> attribute of the <var>imagedata</var> argument, let <var>dirtyHeight</var> be the value of that <code title="dom-imagedata-height"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-imagedata-height">height</a></code> attribute, minus the
    value of <var>dirtyY</var>.</p>

   </li>

   <li>

    <p>If, after those changes, either <var>dirtyWidth</var>
    or <var>dirtyHeight</var> is negative or zero, stop these
    steps without affecting the canvas.</p>

   </li>

   <li><p>Otherwise, for all integer values of <var>x</var>
   and <var>y</var> where <span><var>dirtyX</var>&nbsp;≤&nbsp;<var>x</var>&nbsp;&lt;&nbsp;<span><var>dirtyX</var>+<var>dirtyWidth</var></span></span>
   and <span><var>dirtyY</var>&nbsp;≤&nbsp;<var>y</var>&nbsp;&lt;&nbsp;<span><var>dirtyY</var>+<var>dirtyHeight</var></span></span>, copy the four channels of
   the pixel with coordinate (<var>x</var>, <var>y</var>) in the <var>imagedata</var> data
   structure to the pixel with coordinate (<span><var>dx<sub>device</sub></var>+<var>x</var></span>,
   <span><var>dy<sub>device</sub></var>+<var>y</var></span>) in the underlying pixel data of the
   canvas.</p></li>

  </ol>

  <p>The handling of pixel rounding when the specified coordinates do
  not exactly map to the device coordinate space is not defined by
  this specification, except that the following must result in no
  visible changes to the rendering:</p>

  <pre>context.putImageData(context.getImageData(x, y, w, h), p, q);</pre>

  <p>...for any value of <var>x</var>, <var>y</var>,
  <var>w</var>, and <var>h</var> and where <var>p</var> is the smaller of <var>x</var> and the sum
  of <var>x</var> and <var>w</var>, and <var>q</var> is the smaller of <var>y</var> and the sum
  of <var>y</var> and <var>h</var>; and except that
  the following two calls:</p>

  <pre>context.createImageData(w, h);
context.getImageData(0, 0, w, h);</pre>

  <p>...must return <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> objects with the same
  dimensions, for any value of <var>w</var> and <var>h</var>. In other words, while user agents may round the
  arguments of these methods so that they map to device pixel
  boundaries, any rounding performed must be performed consistently
  for all of the <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">createImageData()</a></code>, <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code> and <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData()</a></code>
  operations.</p>

  <p class="note">This implies that the data returned by <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code> is at the
  resolution of the canvas backing store. This is likely to not be one
  device pixel to each CSS pixel if the display used is a high
  resolution display.</p>

  <p class="note">Due to the lossy nature of converting to and from
  premultiplied alpha color values, pixels that have just been set
  using <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData()</a></code> might be
  returned to an equivalent <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code> as
  different values.</p>

  <p>The current path, <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#transformations" title="dom-context-2d-transformation">transformation matrix</a>,
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#shadows" title="shadows">shadow attributes</a>, <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha">global alpha</a>, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region" title="clipping region">clipping region</a>, and <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation">global composition
  operator</a> must not affect the <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code> and <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData()</a></code>
  methods.</p>

  </div>

  <div class="example">

   <p>In the following example, the script generates an
   <code><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#imagedata">ImageData</a></code> object so that it can draw onto it.</p>

   <pre>// canvas is a reference to a &lt;canvas&gt; element
var context = canvas.getContext('2d');

// create a blank slate
var data = context.createImageData(canvas.width, canvas.height);

// create some plasma
FillPlasma(data, 'green'); // green plasma

// add a cloud to the plasma
AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle

// paint the plasma+cloud on the canvas
context.putImageData(data, 0, 0);

// support methods
function FillPlasma(data, color) { ... }
function AddCloud(data, x, y) { ... }</pre>

  </div>

  <div class="example">

   <p>Here is an example of using <code title="dom-context-2d-getImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-getimagedata">getImageData()</a></code> and <code title="dom-context-2d-putImageData"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-putimagedata">putImageData()</a></code> to
   implement an edge detection filter.</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Edge detection demo&lt;/title&gt;
  &lt;script&gt;
   var image = new Image();
   function init() {
     image.onload = demo;
     image.src = "image.jpeg";
   }
   function demo() {
     var canvas = document.getElementsByTagName('canvas')[0];
     var context = canvas.getContext('2d');

     // draw the image onto the canvas
     context.drawImage(image, 0, 0);

     // get the image data to manipulate
     var input = context.getImageData(0, 0, canvas.width, canvas.height);

     // get an empty slate to put the data into
     var output = context.createImageData(canvas.width, canvas.height);

     // alias some variables for convenience
     // notice that we are using input.width and input.height here
     // as they might not be the same as canvas.width and canvas.height
     // (in particular, they might be different on high-res displays)
     var w = input.width, h = input.height;
     var inputData = input.data;
     var outputData = output.data;

     // edge detection
     for (var y = 1; y &lt; h - 1; y += 1) {
       for (var x = 1; x &lt; w - 1; x += 1) {
         for (var c = 0; c &lt; 3; c += 1) {
           var i = (y*w + x)*4 + c;
           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
         }
         outputData[(y*w + x)*4 + 3] = 255; // alpha
       }
     }

     // put the image data back after manipulation
     context.putImageData(output, 0, 0);
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="init()"&gt;
  &lt;canvas&gt;&lt;/canvas&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>




  <h2 id="compositing"><span class="secno">15 </span>合成</h2>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回渲染操作的alpha值。</p>

    <p>可以用来设置alpha值。超出0.0-1.0范围的值会被忽略。</p>

   </dd>


   <dt><var>context</var> . <code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前的合成操作。</p>

    <p>可以用来设置合成操作。未知值会被忽略。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>All drawing operations are affected by the global compositing
  attributes, <code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code> and <code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>.</p>

  <!-- conformance criteria for painting are described in the "drawing
  model" section below -->

  <p>The <dfn id="dom-context-2d-globalalpha" title="dom-context-2d-globalAlpha"><code>globalAlpha</code></dfn>
  attribute gives an alpha value that is applied to shapes and images
  before they are composited onto the canvas. The value must be in the
  range from 0.0 (fully transparent) to 1.0 (no additional
  transparency). If an attempt is made to set the attribute to a value
  outside this range, including Infinity and Not-a-Number (NaN)
  values, the attribute must retain its previous value. When the
  context is created, the <code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code> attribute must
  initially have the value 1.0.</p>

  <p>The <dfn id="dom-context-2d-globalcompositeoperation" title="dom-context-2d-globalCompositeOperation"><code>globalCompositeOperation</code></dfn>
  attribute sets how shapes and images are drawn onto the existing
  bitmap, once they have had <code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code> and the
  current transformation matrix applied. It must be set to a value
  from the following list. In the descriptions below, the source
  image, <var>A</var>, is the shape or image being rendered,
  and the destination image, <var>B</var>, is the current
  state of the bitmap.</p>

  </div>

  <dl>

   <dt><dfn id="gcop-source-atop" title="gcop-source-atop"><code>source-atop</code></dfn></dt>

   <dd><var>A</var> atop <var>B</var>. <span class="note">Display the
   source image wherever both images are opaque. Display the
   destination image wherever the destination image is opaque but the
   source image is transparent. Display transparency elsewhere.</span></dd>

   <dt><dfn id="gcop-source-in" title="gcop-source-in"><code>source-in</code></dfn></dt>

   <dd><var>A</var> in <var>B</var>. <span class="note">Display the
   source image wherever both the source image and destination image
   are opaque. Display transparency elsewhere.</span></dd>

   <dt><dfn id="gcop-source-out" title="gcop-source-out"><code>source-out</code></dfn></dt>

   <dd><var>A</var> out <var>B</var>. <span class="note">Display the
   source image wherever the source image is opaque and the
   destination image is transparent. Display transparency
   elsewhere.</span></dd>

   <dt><dfn id="gcop-source-over" title="gcop-source-over"><code>source-over</code></dfn> (default)</dt>

   <dd><var>A</var> over <var>B</var>. <span class="note">Display the
   source image wherever the source image is opaque. Display the
   destination image elsewhere.</span></dd>


   <dt><dfn id="gcop-destination-atop" title="gcop-destination-atop"><code>destination-atop</code></dfn></dt>

   <dd><var>B</var> atop <var>A</var>. <span class="note">Same as <code title="gcop-source-atop"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#gcop-source-atop">source-atop</a></code> but using the
   destination image instead of the source image and vice versa.</span></dd>

   <dt><dfn id="gcop-destination-in" title="gcop-destination-in"><code>destination-in</code></dfn></dt>

   <dd><var>B</var> in <var>A</var>. <span class="note">Same as <code title="gcop-source-in"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#gcop-source-in">source-in</a></code> but using the destination
   image instead of the source image and vice versa.</span></dd>

   <dt><dfn id="gcop-destination-out" title="gcop-destination-out"><code>destination-out</code></dfn></dt>

   <dd><var>B</var> out <var>A</var>. <span class="note">Same as <code title="gcop-source-out"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#gcop-source-out">source-out</a></code> but using the destination
   image instead of the source image and vice versa.</span></dd>

   <dt><dfn id="gcop-destination-over" title="gcop-destination-over"><code>destination-over</code></dfn></dt>

   <dd><var>B</var> over <var>A</var>. <span class="note">Same as <code title="gcop-source-over"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#gcop-source-over">source-over</a></code> but using the
   destination image instead of the source image and vice versa.</span></dd>


<!-- no clear definition of this operator (doesn't correspond to a PorterDuff operator)
   <dt><dfn title="gcop-darker"><code>darker</code></dfn></dt>

   <dd><span class="note">Display the sum of the source image and destination image,
   with color values approaching 0 as a limit.</span></dd>
-->

   <dt><dfn id="gcop-lighter" title="gcop-lighter"><code>lighter</code></dfn></dt>

   <dd><var>A</var> plus <var>B</var>. <span class="note">Display the
   sum of the source image and destination image, with color values
   approaching 255 (100%) as a limit.</span></dd>


   <dt><dfn id="gcop-copy" title="gcop-copy"><code>copy</code></dfn></dt>

   <dd><var>A</var> (<var>B</var> is
   ignored). <span class="note">Display the source image instead of the destination
   image.</span></dd>


   <dt><dfn id="gcop-xor" title="gcop-xor"><code>xor</code></dfn></dt>

   <dd><var>A</var> xor <var>B</var>. <span class="note">Exclusive OR
   of the source image and destination image.</span></dd>


   <dt class="impl"><code><var>vendorName</var>-<var>operationName</var></code></dt>

   <dd class="impl">Vendor-specific extensions to the list of
   composition operators should use this syntax.</dd>

  </dl>

  <div class="impl">

  <p>The operators in the above list must be treated as described by
  the Porter-Duff operator given at the start of their description
  (e.g. <var>A</var> over <var>B</var>). They are to
  be applied as part of the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#drawing-model">drawing model</a>, at which point the
  <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region">clipping region</a> is also applied. (Without a clipping
  region, these operators act on the whole bitmap with every
  operation.) <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsPORTERDUFF">[PORTERDUFF]</a></p>

  <p>These values are all case-sensitive — they must be used
  exactly as shown. User agents must not recognize values that are not
  a <span>case-sensitive</span> match for one of the values given
  above.</p>

  <p>On setting, if the user agent does not recognize the specified
  value, it must be ignored, leaving the value of <code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>
  unaffected.</p>

  <p>When the context is created, the <code title="dom-context-2d-globalCompositeOperation"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a></code>
  attribute must initially have the value
  <code>source-over</code>.</p>

  </div>




  <h2 id="shadows"><span class="secno">16 </span><dfn>阴影</dfn></h2>

  <p>所有的绘图操作都会受到四个全局阴影变量的影响。</p>

  <dl class="domintro">

   <dt><var>context</var> . <code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前阴影的颜色。</p>

    <p>可以用来设置阴影颜色。不能被CSS颜色解析的值会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-shadowOffsetX"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code> [ = <var>value</var> ]</dt>
   <dt><var>context</var> . <code title="dom-context-2d-shadowOffsetY"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前阴影偏移量。</p>

    <p>可以用来设置阴影偏移量。无穷的值会被忽略。</p>

   </dd>

   <dt><var>context</var> . <code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code> [ = <var>value</var> ]</dt>

   <dd>

    <p>返回当前阴影的模糊等级。</p>

    <p>可以用来设置模糊等级。无穷的大于或等于0的值会被忽略。</p>

   </dd>

  </dl>

  <div class="impl">

  <p>The <dfn id="dom-context-2d-shadowcolor" title="dom-context-2d-shadowColor"><code>shadowColor</code></dfn>
  attribute sets the color of the shadow.</p>

  <p>When the context is created, the <code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code> attribute
  initially must be fully-transparent black.</p>

  <p>On getting, the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#serialization-of-a-color" title="serialization of a
  color">serialization of the color</a> must be returned.</p>

  <p>On setting, the new value must be <span>parsed as a CSS
  &lt;color&gt; value</span> and the color assigned. If the value
  cannot be parsed as a CSS &lt;color&gt; value then it must be
  ignored, and the attribute must retain its previous value. <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#refsCSSCOLOR">[CSSCOLOR]</a></p>

  <p>The <dfn id="dom-context-2d-shadowoffsetx" title="dom-context-2d-shadowOffsetX"><code>shadowOffsetX</code></dfn>
  and <dfn id="dom-context-2d-shadowoffsety" title="dom-context-2d-shadowOffsetY"><code>shadowOffsetY</code></dfn>
  attributes specify the distance that the shadow will be offset in
  the positive horizontal and positive vertical distance
  respectively. Their values are in coordinate space units. They are
  not affected by the current transformation matrix.</p>

  <p>When the context is created, the shadow offset attributes must
  initially have the value <code>0</code>.</p>

  <p>On getting, they must return their current value. On setting, the
  attribute being set must be set to the new value, except if the
  value is infinite or NaN, in which case the new value must be
  ignored.</p>

  <p>The <dfn id="dom-context-2d-shadowblur" title="dom-context-2d-shadowBlur"><code>shadowBlur</code></dfn>
  attribute specifies the level of the blurring effect. (The units do
  not map to coordinate space units, and are not affected by the
  current transformation matrix.)</p>

  <p>When the context is created, the <code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code> attribute must
  initially have the value <code>0</code>.</p>

  <p>On getting, the attribute must return its current value. On
  setting the attribute must be set to the new value, except if the
  value is negative, infinite or NaN, in which case the new value must
  be ignored.</p>

  <p><dfn id="when-shadows-are-drawn" title="when shadows are drawn">Shadows are only drawn
  if</dfn> the opacity component of the alpha component of the color
  of <code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code> is
  non-zero and at leasty one of <code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code>, <code title="dom-context-2d-shadowOffsetX"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code>, or <code title="dom-context-2d-shadowOffsetY"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> is
  non-zero.</p>

  <p class="critical">It is likely that this will change: browser
  vendors have indicated an interest in changing the processing model
  for shadows such that they only draw when the composition operator
  is "source-over" (the default). <a href="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/thread.html#31457">Read
  more...</a></p>

  <p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#when-shadows-are-drawn">When shadows are drawn</a>, they must be rendered as follows:</p>

  <ol>

   <li> <p>Let <var>A</var> be an infinite transparent black
   bitmap on which the source image for which a shadow is being
   created has been rendered.</p> </li>

   <li> <p>Let <var>B</var> be an infinite transparent black
   bitmap, with a coordinate space and an origin identical to <var>A</var>.</p> </li>

   <li> <p>Copy the alpha channel of <var>A</var> to <var>B</var>, offset by <code title="dom-context-2d-shadowOffsetX"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsetx">shadowOffsetX</a></code> in the
   positive <var>x</var> direction, and <code title="dom-context-2d-shadowOffsetY"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowoffsety">shadowOffsetY</a></code> in the
   positive <var>y</var> direction.</p> </li>

   <li> <p>If <code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code> is greater than
   0:</p>

    <ol>

     <li> <p>Let <var>σ</var> be half the value of
     <code title="dom-context-2d-shadowBlur"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowblur">shadowBlur</a></code>.</p></li>

     <li> <p>Perform a 2D Gaussian Blur on <var>B</var>,
     using <var>σ</var> as the standard deviation.</p>
     <!-- wish i could find a reference for this --> </li>

    </ol>

    <p>User agents may limit values of <var>σ</var> to
    an implementation-specific maximum value to avoid exceeding
    hardware limitations during the Gaussian blur operation.</p>

   </li>

   <li> <p>Set the red, green, and blue components of every pixel in
   <var>B</var> to the red, green, and blue components
   (respectively) of the color of <code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code>.</p> </li>

   <li> <p>Multiply the alpha component of every pixel in <var>B</var> by the alpha component of the color of <code title="dom-context-2d-shadowColor"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-shadowcolor">shadowColor</a></code>.</p> </li>

   <li> <p>The shadow is in the bitmap <var>B</var>, and is
   rendered as part of the <a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#drawing-model">drawing model</a> described below.</p> </li>

  </ol>

  </div>

  <p>If the current composition operation is <code title="gcop-copy"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#gcop-copy">copy</a></code>, shadows effectively won't render
  (since the shape will overwrite the shadow).</p>



  <div class="impl">

  <h2 id="drawing-model"><span class="secno">17 </span><dfn>绘制模型</dfn></h2>

  <p>绘制图形或图像时，客户端会进行以下操作：</p>

  <ol>

   <li><p>在底色为透明黑色的不限大小的位图上渲染图像<var>A</var>。而对于图形来说，优先渲染当前的填充、描边和线条样式，而描边也受到变换矩阵影响。</p></li>

   <li><p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#when-shadows-are-drawn">当绘制阴影时</a>，便会用当前阴影样式渲染图像<var>A</var>的阴影并创建图像<var>B</var>。
   </p></li>

   <li><p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#when-shadows-are-drawn">当绘制阴影时</a>，<var>B</var>内的像素的alpha值会根据<code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code>相乘。
   </p></li>

   <li><p><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#when-shadows-are-drawn">当绘制阴影时</a>，根据当前canvas上的位图通过合成操作符将<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region">clipping region</a>内的<var>B</var>合成。
   </p></li>

   <li><p>通过<code title="dom-context-2d-globalAlpha"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-globalalpha">globalAlpha</a></code>将<var>A</var>中的每一个像素的alpha值相乘。</p></li>

   <li><p>通过合成操作符将当前canvas位图上的<a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#clipping-region">clipping
       region</a>内的<var>A</var>合成。</p></li>

  </ol>

  </div>


  <h2 id="best-practices"><span class="secno">18 </span>最佳实践</h2>

  <p><i>This section is non-normative.</i></p>
  <p>When a canvas is interactive, authors should include focusable
  elements in the element's fallback content corresponding to each
  focusable part of the canvas.</p>

  <p>To indicate which focusable part of the canvas is currently
  focused, authors should use the <code title="dom-context-2d-drawFocusIfNeeded"><a href="https://www.w3.org/TR/2015/REC-2dcontext-20151119/#dom-context-2d-drawfocusifneeded">drawFocusIfNeeded()</a></code>
  method, passing it the element for which an outline is being drawn. This
  method only draws the focus outline if the element is focused, so that
  it can simply be called whenever drawing the element, without
  checking whether the element is focused or not first.</p>

  <p>Authors should avoid implementing text editing controls using the
  <code>canvas</code> element. Doing so has a large number of
  disadvantages:</p>

  <ul>

   <li>Mouse placement of the caret has to be reimplemented.</li>

   <li>Keyboard movement of the caret has to be reimplemented (possibly across lines, for multiline text input).</li>

   <li>Scrolling of the text field has to be implemented (horizontally for long lines, vertically for multiline input).</li>

   <li>Native features such as copy-and-paste have to be reimplemented.</li>

   <li>Native features such as spell-checking have to be reimplemented.</li>

   <li>Native features such as drag-and-drop have to be reimplemented.</li>

   <li>Native features such as page-wide text search have to be reimplemented.</li>

   <li>Native features specific to the user, for example custom text
   services, have to be reimplemented. This is close to impossible
   since each user might have different services installed, and there
   is an unbounded set of possible such services.</li>

   <li>Bidirectional text editing has to be reimplemented.</li>

   <li>For multiline text editing, line wrapping has to be implemented for all relevant languages.</li>

   <li>Text selection has to be reimplemented.</li>

   <li>Dragging of bidirectional text selections has to be reimplemented.</li>

   <li>Platform-native keyboard shortcuts have to be reimplemented.</li>

   <li>Platform-native input method editors (IMEs) have to be reimplemented.</li>

   <li>Undo and redo functionality has to be reimplemented.</li>

   <li>Accessibility features such as magnification following the
   caret or selection have to be reimplemented.</li>

  </ul>

  <p>This is a huge amount of work, and authors are most strongly
  encouraged to avoid doing any of it by instead using the
  <code>input</code> element, the <code>textarea</code> element, or
  the <code title="attr-contenteditable">contenteditable</code>
  attribute.</p>


  <h2 id="examples"><span class="secno">19 </span>举例</h2>

  <p><i>This section is non-normative.</i></p>
  <div class="example">

  <p>Here is an example of a script that uses canvas to draw <a href="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIEhUTUw%2BDQo8aHRtbCBsYW5nPSJlbiI%2BDQogPGhlYWQ%2BDQogIDx0aXRsZT5QcmV0dHkgR2xvd2luZyBMaW5lczwvdGl0bGU%2BDQogPC9oZWFkPg0KIDxib2R5Pg0KPGNhbnZhcyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCI%2BPC9jYW52YXM%2BDQo8c2NyaXB0Pg0KDQogdmFyIGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKTsNCg0KIHZhciBsYXN0WCA9IGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKTsNCiB2YXIgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KIHZhciBodWUgPSAwOw0KIGZ1bmN0aW9uIGxpbmUoKSB7DQogICBjb250ZXh0LnNhdmUoKTsNCiAgIGNvbnRleHQudHJhbnNsYXRlKGNvbnRleHQuY2FudmFzLndpZHRoLzIsIGNvbnRleHQuY2FudmFzLmhlaWdodC8yKTsNCiAgIGNvbnRleHQuc2NhbGUoMC45LCAwLjkpOw0KICAgY29udGV4dC50cmFuc2xhdGUoLWNvbnRleHQuY2FudmFzLndpZHRoLzIsIC1jb250ZXh0LmNhbnZhcy5oZWlnaHQvMik7DQogICBjb250ZXh0LmJlZ2luUGF0aCgpOw0KICAgY29udGV4dC5saW5lV2lkdGggPSA1ICsgTWF0aC5yYW5kb20oKSAqIDEwOw0KICAgY29udGV4dC5tb3ZlVG8obGFzdFgsIGxhc3RZKTsNCiAgIGxhc3RYID0gY29udGV4dC5jYW52YXMud2lkdGggKiBNYXRoLnJhbmRvbSgpOw0KICAgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KICAgY29udGV4dC5iZXppZXJDdXJ2ZVRvKGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYLCBsYXN0WSk7DQoNCiAgIGh1ZSA9IGh1ZSArIDEwICogTWF0aC5yYW5kb20oKTsNCiAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnaHNsKCcgKyBodWUgKyAnLCA1MCUsIDUwJSknOw0KICAgY29udGV4dC5zaGFkb3dDb2xvciA9ICd3aGl0ZSc7DQogICBjb250ZXh0LnNoYWRvd0JsdXIgPSAxMDsNCiAgIGNvbnRleHQuc3Ryb2tlKCk7DQogICBjb250ZXh0LnJlc3RvcmUoKTsNCiB9DQogc2V0SW50ZXJ2YWwobGluZSwgNTApOw0KDQogZnVuY3Rpb24gYmxhbmsoKSB7DQogICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2JhKDAsMCwwLDAuMSknOw0KICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjb250ZXh0LmNhbnZhcy53aWR0aCwgY29udGV4dC5jYW52YXMuaGVpZ2h0KTsNCiB9DQogc2V0SW50ZXJ2YWwoYmxhbmssIDQwKTsNCg0KPC9zY3JpcHQ%2BDQogPC9ib2R5Pg0KPC9odG1sPg0K">pretty glowing lines</a>.</p>

  <pre>&lt;canvas width="800" height="450"&gt;&lt;/canvas&gt;
&lt;script&gt;

 var context = document.getElementsByTagName('canvas')[0].getContext('2d');

 var lastX = context.canvas.width * Math.random();
 var lastY = context.canvas.height * Math.random();
 var hue = 0;
 function line() {
   context.save();
   context.translate(context.canvas.width/2, context.canvas.height/2);
   context.scale(0.9, 0.9);
   context.translate(-context.canvas.width/2, -context.canvas.height/2);
   context.beginPath();
   context.lineWidth = 5 + Math.random() * 10;
   context.moveTo(lastX, lastY);
   lastX = context.canvas.width * Math.random();
   lastY = context.canvas.height * Math.random();
   context.bezierCurveTo(context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         lastX, lastY);

   hue = hue + 10 * Math.random();
   context.strokeStyle = 'hsl(' + hue + ', 50%, 50%)';
   context.shadowColor = 'white';
   context.shadowBlur = 10;
   context.stroke();
   context.restore();
 }
 setInterval(line, 50);

 function blank() {
   context.fillStyle = 'rgba(0,0,0,0.1)';
   context.fillRect(0, 0, context.canvas.width, context.canvas.height);
 }
 setInterval(blank, 40);

&lt;/script&gt;</pre>

  </div>


<!--FIXUP 2dcontext -4-->
  <h2 class="no-num" id="references">参考资料</h2><!--REFS-->

  <p>All references are normative unless marked "Non-normative".</p>

  <!-- Dates are only included for standards older than the Web, because the newer ones keep changing. -->

  <dl>
<!--REFERENCES ON-->

   <dt id="refsBEZIER">[BEZIER]</dt>
   <dd><cite>Courbes à poles</cite>, P. de Casteljau. INPI, 1959.</dd>

   <!--
   <dd><cite><a href="http://tools.ietf.org/html/rfc2109">HTTP State Management Mechanism</a></cite>, D. Kristol, L. Montulli. IETF.</dd>
   <dd><cite><a href="http://tools.ietf.org/html/rfc2965">HTTP State Management Mechanism</a></cite>, D. Kristol, L. Montulli. IETF.</dd>
   -->
   <!--
   <dd><cite><a href="http://www.w3.org/TR/cors/">Cross-Origin
   Resource Sharing</a></cite>, A. van Kesteren. W3C.</dd>
   -->
   <!-- really should be "NARUSE, Y." or some
   such, but there's a western bias to these references for
   consistency. sorry. -->

   <!-- really should be "NARUSE, Y." or some
   such, but there's a western bias to these references for
   consistency. sorry. -->

   <dt id="refsCSS">[CSS]</dt>
   <dd><cite><a href="http://www.w3.org/TR/CSS/">Cascading Style Sheets Level 2
   Revision 1</a> (URL: <a href="http://www.w3.org/TR/CSS/">http://www.w3.org/TR/CSS/</a>)</cite>, B. Bos, T. Çelik, I.
   Hickson, H. Lie. W3C.</dd>

   <dt id="refsCSSCOLOR">[CSSCOLOR]</dt>
   <!--
   <dd><cite><a href="http://www.w3.org/TR/css3-color/">CSS Color
   Module Level 3</a></cite>, T. &Ccedil;elik, C. Lilley, L.
   Baron. W3C.</dd>
   -->
   <dd><cite><a href="http://www.w3.org/TR/css3-color/">CSS Color
   Module Level 3</a> (URL: <a href="http://www.w3.org/TR/css3-color/">http://www.w3.org/TR/css3-color/</a>)</cite>, T. Çelik, C. Lilley, L.
   Baron. 7 June 2011. W3C Recommendation.</dd>

   <dt id="refsCSSFONTS">[CSSFONTS]</dt>
   <dd><cite><a href="http://www.w3.org/TR/css3-fonts/">CSS Fonts
   Module Level 3</a> (URL: <a href="http://www.w3.org/TR/css3-fonts/">http://www.w3.org/TR/css3-fonts/</a>)</cite>, J. Daggett. W3C.</dd>

   <dt id="refsCSSIMAGES">[CSSIMAGES]</dt>
   <dd><cite><a href="http://www.w3.org/TR/css3-images/">CSS Image
   Values and Replaced Content Module Level 3</a> (URL: <a href="http://www.w3.org/TR/css3-images/">http://www.w3.org/TR/css3-images/</a>)</cite>, E. Etemad,
   T. Atkins. W3C.</dd>

   <dt id="refsCSSOM">[CSSOM]</dt>
   <dd><cite><a href="http://www.w3.org/TR/cssom/">Cascading Style Sheets
   Object Model (CSSOM)</a> (URL: <a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a>)</cite>, S. Pieters, G. Adams. W3C.</dd>

   <!--
   <dd><cite><a
   href="http://www.w3.org/TR/DOM-Level-3-Events/">Document Object
   Model (DOM) Level 3 Events Specification</a></cite>,
   B. H&ouml;hrmann, P. Le Hegaret, T. Pixley. W3C.</dd>
   -->
   <!--
   <dd><cite><a href="http://www.w3.org/TR/eventsource/">Server-Sent
   Events</a></cite>, I. Hickson. W3C.</dd>
   -->
   <!-- http://www.iana.org/assignments/charset-reg/GBK -->

   <!--
   This book ("Computer Graphics: Principles and Practice in C")
   apparently does not make any references to literature in the
   bibliographic section to define the "even-odd" rule for polygon
   filling and hit testing. In the absence of such a reference, I
   guess that this book is the most authoritative reference.
   -->

   <dt id="refsHTML">[HTML]</dt>
   <dd>Ian Hickson; Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Edward O'Connor; Silvia Pfeiffer. <a href="http://www.w3.org/TR/html5/"><cite>HTML5</cite></a>. 28 October 2014. W3C Recommendation. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a></dd>

   <!--
   <dd>(Non-normative) <cite><a
   href="http://www.w3.org/TR/html5-diff/">HTML5 differences from
   HTML4</a></cite>, A. van Kesteren. W3C.</dd>
   -->
   <!--
   <dd><cite><a href="http://www.w3.org/TR/css3-mediaqueries/">Media
   Queries</a></cite>, H. Lie, T.  &Ccedil;elik, D. Glazman, A. van
   Kesteren. W3C.</dd>
   -->
   <dt id="refsPORTERDUFF">[PORTERDUFF]</dt>
   <dd><cite><a href="http://keithp.com/~keithp/porterduff/p253-porter.pdf">Compositing
   Digital Images</a> (URL: <a href="http://keithp.com/~keithp/porterduff/p253-porter.pdf">http://keithp.com/~keithp/porterduff/p253-porter.pdf</a>)</cite>, T. Porter, T. Duff. In <cite>Computer
   graphics</cite>, volume 18, number 3, pp. 253-259. ACM Press, July
   1984.</dd>

   <!-- for text/plain and
   "Internet Media type"; not for definition of "valid MIME type". -->

   <dt id="refsTYPEDARRAY">[TYPEDARRAY]</dt>
   <dd><cite><a href="https://www.khronos.org/registry/typedarray/specs/latest/">Typed Array Specification</a> (URL: <a href="https://www.khronos.org/registry/typedarray/specs/latest/">https://www.khronos.org/registry/typedarray/specs/latest/</a>)</cite>, D. Herman, K. Russell. Khronos.</dd>

   <dt id="refsWEBIDL">[WEBIDL]</dt>
   <dd><a href="http://www.w3.org/TR/WebIDL-1/"><cite>Web IDL</cite></a> (URL: <a href="http://www.w3.org/TR/WebIDL-1/">http://www.w3.org/TR/WebIDL-1/</a>), Cameron McCormack, Boris Zbarsky, Yves Lafon, Travis Leithead. W3C.

   <!--
   <dd><cite><a href="http://www.w3.org/TR/XMLHttpRequest/">The XMLHttpRequest
   Object</a></cite>, A. van Kesteren. W3C.</dd>
   -->
   <!--(once XSLTProcessor is defined somewhere, update this and the place that references this)
   <dt id="refsXSLTP">[XSLTP]</dt>
   <dd>(Non-normative) <cite><a href=""></a></cite>, . .</dd>
-->


   <!--REFERENCES OFF-->
  </dd></dl>

  <p><i>本文档中文翻译由罗甘完成。</i></p>
  <p><i>This document is translated by Gan Luo.</i></p>

<script src="./HTML Canvas 2D Context_files/fixup.js"></script>
</body></html>
